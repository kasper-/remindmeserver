function war(){
    $res = mysql_query("SELECT * FROM `send_army` WHERE `last_time` <= '".time()."' and (`type_attack` = '1' or `type_attack` = '2') ORDER BY `last_time` ASC");
    while($row = mysql_fetch_array($res)) {
        if ($row['colony_id_deff'] != '11' and $row['colony_id_deff'] != '12' and $row['colony_id_deff'] != '13' and $row['colony_id_deff'] != '14' and $row['colony_id_deff'] != '15') {
            if (time() >= $row['last_time']) {
                $army_attaker =  mysql_fetch_assoc(mysql_query("SELECT * FROM `send_army` WHERE `rand_attack` = '".$row['rand_attack']."' AND `id` = '".$row['id']."' LIMIT 1"));
                $yes_or_no =  mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `colony_id` = '".$row['colony_id_deff']."' LIMIT 1"));
                if ($row['colony_id_deff'] == $yes_or_no['colony_id']) {
 
 
                    $army_level =  mysql_fetch_assoc(mysql_query("SELECT * FROM `kyznja_oruzhiya_research` WHERE 
                     `colony_id` = '".$row['colony_id']."' LIMIT 1")); 
                    mysql_query("DELETE FROM `send_army` WHERE `id` = '".$row['id']."' ");
 
                    $summ_attak = 0;
                    $summ_attak_pihota = 0;
                    $summ_attak_koni = 0;
                    $summ_deff_solder = 0;
                    $summ_deff_hors = 0;
                    $max_size = 0;
                    $count_attak_army = 0;
                    $count_deff_army = 0;
                    $plemy_attaker =  mysql_fetch_assoc(mysql_query("SELECT * FROM `map` WHERE 
                     `colony_id` = '".$row['colony_id']."' LIMIT 1")); 
 
                    //бонус функцыя атаки 10%
                    $user_army_bonus = mysql_fetch_assoc(mysql_query("SELECT * FROM `bonus_army` WHERE `login` = '".$army_attaker['login']."' LIMIT 1"));
 
 
                    if ($plemy_attaker['plemy'] == 1 ) {   
                        for ($i = 1; $i<=10; $i++ ) {  
                            if (($i == 4) || ($i == 10)) { continue; }
                        $units_ru = mysql_fetch_assoc(mysql_query("SELECT * FROM `units_rus` WHERE `id` = '".$i."' LIMIT 1"));  
                            if ($army_attaker['soldier'.$i] > 0) {
                                if ($army_level['soldier'.$i] > 0) {
                                    $summ_attak += $army_attaker['soldier'.$i] * $units_ru['attak'] * ($army_level['soldier'.$i] * 0.015 + 1 );
                                    $count_attak_army = $count_attak_army + $army_attaker['soldier'.$i];
                                }else{
                                    $summ_attak += $army_attaker['soldier'.$i] * $units_ru['attak'];
                                    $count_attak_army = $count_attak_army + $army_attaker['soldier'.$i];
                                }
                            }
                        }
                        $chek_bonus_polkan = mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$plemy_attaker['login']."' LIMIT 1"));     
                         if($chek_bonus_polkan['attk_polkan'] > 0 ) {
                                $summ_attak += $summ_attak *  ($chek_bonus_polkan['attk_polkan'] / 100);
                             }
 
                        if ($user_army_bonus['bonus_10_ataka'] == '+') {
                            $summ_attak += $summ_attak * 0.05;
                        }
                        for ($i = 1; $i<=10; $i++ ) {
                            if ($i == 1 || $i == 2 || $i == 3 || $i == 7 || $i == 8 || $i == 9) {
                                $units_ru = mysql_fetch_assoc(mysql_query("SELECT * FROM `units_rus` WHERE `id` = '".$i."' LIMIT 1"));  
                                if ($army_attaker['soldier'.$i] > 0) {
                                    if ($army_level['soldier'.$i] > 0) {
                                        $summ_attak_pihota += $army_attaker['soldier'.$i] * $units_ru['attak'] * ($army_level['soldier'.$i] * 0.015 + 1 );
                                    }else{
                                        $summ_attak_pihota += $army_attaker['soldier'.$i] * $units_ru['attak'];
                                    }
                                }
                            }else{
                                if ($i == 4 || $i == 5 || $i == 6) {
                                $units_ru = mysql_fetch_assoc(mysql_query("SELECT * FROM `units_rus` WHERE `id` = '".$i."' LIMIT 1"));  
                                    if ($army_attaker['soldier'.$i] > 0) {
                                        if ($army_level['soldier'.$i] > 0) {
                                         $summ_attak_koni += $army_attaker['soldier'.$i] * $units_ru['attak'] * ($army_level['soldier'.$i] * 0.015 + 1 );
                                        }else{
                                            $summ_attak_koni += $army_attaker['soldier'.$i] * $units_ru['attak'];
                                        }
                                    }
                                }
                            }       
                        }
                        if ($summ_attak_pihota > 0) {
                            $kof_pihota_attak = $summ_attak_pihota / $summ_attak;
                        }else{
                            $kof_pihota_attak = 0;
                        }
 
                        if ($summ_attak_koni > 0) {
                            $kof_koni_attak = $summ_attak_koni / $summ_attak;
                        }else{
                            $kof_koni_attak = 0;
                        }
 
 
                    }
                    if ($plemy_attaker['plemy'] == 2 ) {   
                        for ($i = 1; $i<=10; $i++ ) {  
                            if (($i == 4) || ($i == 10)) { continue; }
                        $units_ru = mysql_fetch_assoc(mysql_query("SELECT * FROM `units_ua` WHERE `id` = '".$i."' LIMIT 1"));  
                            if ($army_attaker['soldier'.$i] > 0) {
                                if ($army_level['soldier'.$i] > 0) {
                                    $summ_attak += $army_attaker['soldier'.$i] * $units_ru['attak'] * ($army_level['soldier'.$i] * 0.015 + 1 );
                                    $count_attak_army = $count_attak_army + $army_attaker['soldier'.$i];
                                }else{
                                    $summ_attak += $army_attaker['soldier'.$i] * $units_ru['attak'];
                                    $count_attak_army = $count_attak_army + $army_attaker['soldier'.$i];
                                }
                            }
                        }
 
                        $chek_bonus_polkan = mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$plemy_attaker['login']."' LIMIT 1")); 
                         if($chek_bonus_polkan['attk_polkan'] > 0 ) {
                                $summ_attak += $summ_attak *  ($chek_bonus_polkan['attk_polkan'] / 100);
                             }
 
                        if ($user_army_bonus['bonus_10_ataka'] == '+') {
                            $summ_attak += $summ_attak * 0.05;
                        }
                        for ($i = 1; $i<=10; $i++ ) {
                            if ($i == 1 || $i == 2 || $i == 3 || $i == 4 || $i == 7 || $i == 8 || $i == 9) {
                                $units_ru = mysql_fetch_assoc(mysql_query("SELECT * FROM `units_ua` WHERE `id` = '".$i."' LIMIT 1"));  
                                if ($army_attaker['soldier'.$i] > 0) {
                                    if ($army_level['soldier'.$i] > 0) {
                                        $summ_attak_pihota += $army_attaker['soldier'.$i] * $units_ru['attak'] * ($army_level['soldier'.$i] * 0.015 + 1 );
                                    }else{
                                        $summ_attak_pihota += $army_attaker['soldier'.$i] * $units_ru['attak'];
                                    }
                                }
                            }else{
                                if ($i == 5 || $i == 6) {
                                $units_ru = mysql_fetch_assoc(mysql_query("SELECT * FROM `units_ua` WHERE `id` = '".$i."' LIMIT 1"));  
                                    if ($army_attaker['soldier'.$i] > 0) {
                                        if ($army_level['soldier'.$i] > 0) {
                                         $summ_attak_koni += $army_attaker['soldier'.$i] * $units_ru['attak'] * ($army_level['soldier'.$i] * 0.015 + 1 );
                                        }else{
                                            $summ_attak_koni += $army_attaker['soldier'.$i] * $units_ru['attak'];
                                        }
                                    }
                                }
                            }       
                        }
                        if ($summ_attak_pihota > 0) {
                            $kof_pihota_attak = $summ_attak_pihota / $summ_attak;
                        }else{
                            $kof_pihota_attak = 0;
                        }
 
                        if ($summ_attak_koni > 0) {
                            $kof_koni_attak = $summ_attak_koni / $summ_attak;
                        }else{
                            $kof_koni_attak = 0;
                        }
                    }
                    if ($plemy_attaker['plemy'] == 3 ) {   
                        for ($i = 1; $i<=10; $i++ ) {  
                            if (($i == 3) || ($i == 10)) { continue; } 
                        $units_ru = mysql_fetch_assoc(mysql_query("SELECT * FROM `units_pl` WHERE `id` = '".$i."' LIMIT 1"));  
                            if ($army_attaker['soldier'.$i] > 0) {
                                if ($army_level['soldier'.$i] > 0) {
                                    $summ_attak += $army_attaker['soldier'.$i] * $units_ru['attak'] * ($army_level['soldier'.$i] * 0.015 + 1 );
                                    $count_attak_army = $count_attak_army + $army_attaker['soldier'.$i];
                                }else{
                                    $summ_attak += $army_attaker['soldier'.$i] * $units_ru['attak'];
                                    $count_attak_army = $count_attak_army + $army_attaker['soldier'.$i];
                                }
                            }
                        }
                        $chek_bonus_polkan = mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$plemy_attaker['login']."' LIMIT 1")); 
                             if($chek_bonus_polkan['attk_polkan'] > 0 ) {
                                $summ_attak += $summ_attak *  ($chek_bonus_polkan['attk_polkan'] / 100);
                             }
 
                        if ($user_army_bonus['bonus_10_ataka'] == '+') {
                            $summ_attak += $summ_attak * 0.05;
                        }
                        for ($i = 1; $i<=10; $i++ ) {
                            if ($i == 1 || $i == 2 || $i == 7 || $i == 8 || $i == 9) {
                                $units_ru = mysql_fetch_assoc(mysql_query("SELECT * FROM `units_pl` WHERE `id` = '".$i."' LIMIT 1"));  
                                if ($army_attaker['soldier'.$i] > 0) {
                                    if ($army_level['soldier'.$i] > 0) {
                                        $summ_attak_pihota += $army_attaker['soldier'.$i] * $units_ru['attak'] * ($army_level['soldier'.$i] * 0.015 + 1 );
                                    }else{
                                        $summ_attak_pihota += $army_attaker['soldier'.$i] * $units_ru['attak'];
                                    }
                                }
                            }else{
                                if ($i == 3 || $i == 4 || $i == 5 || $i == 6) {
                                $units_ru = mysql_fetch_assoc(mysql_query("SELECT * FROM `units_pl` WHERE `id` = '".$i."' LIMIT 1"));  
                                    if ($army_attaker['soldier'.$i] > 0) {
                                        if ($army_level['soldier'.$i] > 0) {
                                         $summ_attak_koni += $army_attaker['soldier'.$i] * $units_ru['attak'] * ($army_level['soldier'.$i] * 0.015 + 1 );
                                        }else{
                                            $summ_attak_koni += $army_attaker['soldier'.$i] * $units_ru['attak'];
                                        }
                                    }
                                }
                            }       
                        }
                        if ($summ_attak_pihota > 0) {
                            $kof_pihota_attak = $summ_attak_pihota / $summ_attak;
                        }else{
                            $kof_pihota_attak = 0;
                        }
 
                        if ($summ_attak_koni > 0) {
                            $kof_koni_attak = $summ_attak_koni / $summ_attak;
                        }else{
                            $kof_koni_attak = 0;
                        }
 
                    }
 
 
 
                    //Podkrep_deffffffff
                    $res1 = mysql_query("SELECT * FROM `podkrep` WHERE `colony_id_deff` = '".$army_attaker['colony_id_deff']."' ");                       
                    while($row = mysql_fetch_array($res1)) {    
                        $army_level_deff =  mysql_fetch_assoc(mysql_query("SELECT * FROM `kyznja_dospehov_research` WHERE `colony_id` = '".$row['colony_id_send']."' LIMIT 1")); 
 
 
                        if ($row['plemy'] == 1 ) $deff_podkrep = 'units_rus';  
                        if ($row['plemy'] == 2 ) $deff_podkrep = 'units_ua';  
                        if ($row['plemy'] == 3 ) $deff_podkrep = 'units_pl';  
 
                        for ($i = 1; $i <= 10; $i++) {
                            $army =  mysql_fetch_assoc(mysql_query("SELECT * FROM `".$deff_podkrep."` WHERE 
                            `id` = '".$i."' LIMIT 1"));
                            if ($row['soldier'.$i]>0) {
                                if($army_level_deff['soldier'.$i]>0){
                                    $summ_deff_solder += $row['soldier'.$i]*($army_level_deff['soldier'.$i] * 0.015 + 1 ) * $army['deffpihota']; 
                                    $summ_deff_hors += $row['soldier'.$i]*($army_level_deff['soldier'.$i] * 0.015 + 1 ) * $army['deffkoni'];
                                    $count_deff_army = $count_deff_army + $row['soldier'.$i];
                                }else{
                                    $summ_deff_solder += $row['soldier'.$i] * $army['deffpihota']; 
                                    $summ_deff_hors += $row['soldier'.$i]* $army['deffkoni'];
                                    $count_deff_army = $count_deff_army + $row['soldier'.$i];
                                }
                            }
                        }
                    } 
 
                    //Deff_kolonyyyy
                    $colony_id_defence = mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `colony_id` = '".$army_attaker['colony_id_deff']."' LIMIT 1"));
                    $lvl_kuznya = mysql_fetch_assoc(mysql_query("SELECT * FROM `kyznja_dospehov_research` WHERE `colony_id` = '".$army_attaker['colony_id_deff']."' LIMIT 1"));
                    $plemy_defender = mysql_fetch_assoc(mysql_query("SELECT * FROM `map` WHERE `colony_id` = '".$army_attaker['colony_id_deff']."' LIMIT 1"));
                    $user_army_bonus_deff = mysql_fetch_assoc(mysql_query("SELECT * FROM `bonus_army` WHERE `login` = '".$colony_id_defence['login']."' LIMIT 1"));
 
 
                    $uppdate_resource = time() - $colony_id_defence[`time_derevo`];
                    if ($uppdate_resource > 60) {
                        ressurs_attak($army_attaker['colony_id_deff']);
                        $colony_id_defence = mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `colony_id` = '".$army_attaker['colony_id_deff']."' LIMIT 1"));
                    }
 
 
                    if($plemy_defender['plemy'] == 1 ) {
                        $plemy_army = 'units_rus';
                    }
                    if($plemy_defender['plemy'] == 2 ) {
                        $plemy_army = 'units_ua';
                    }
                    if($plemy_defender['plemy'] == 3 ) {
                        $plemy_army = 'units_pl';
                    }
 
 
                    $tainik = 0;
                    for ($i = 1; $i <= 18; $i++) { 
                        if ($i == 1) {
                            if ($colony_id_defence['tainik'] > 0) {
                                $tainik1 = mysql_fetch_assoc(mysql_query("SELECT * FROM `tainik` WHERE `id` = '".$colony_id_defence['tainik']."' LIMIT 1"));
                                $tainik = $tainik1['hide'];
                            }
                        }else{
                            if ($colony_id_defence['tainik'.$i] > 0) {
                                $tainik1 = mysql_fetch_assoc(mysql_query("SELECT * FROM `tainik` WHERE `id` = '".$colony_id_defence['tainik'.$i]."' LIMIT 1"));
                                $tainik =  $tainik + $tainik1['hide'];
                            }
                        }
                    }
 
 
                    if ($tainik > 0) {
                        if ($plemy_defender['plemy'] == 3 ) {
                            $tainik = $tainik * 2;
                        }
                    }
 
 
                    for ($i=1; $i <=10 ; $i++) { 
                        $army_city =  mysql_fetch_assoc(mysql_query("SELECT * FROM `".$plemy_army."` WHERE `id` = '".$i."' LIMIT 1"));
                        if ($colony_id_defence['soldier'.$i] > 0 ) {
                            if($lvl_kuznya['soldier'.$i]>0){
                                $summ_deff_solder += $colony_id_defence['soldier'.$i]*($lvl_kuznya['soldier'.$i] * 0.015 + 1 ) * $army_city['deffpihota']; 
                                $summ_deff_hors += $colony_id_defence['soldier'.$i]*($lvl_kuznya['soldier'.$i] * 0.015 + 1 ) * $army_city['deffkoni'];
                                $count_deff_army = $count_deff_army + $colony_id_defence['soldier'.$i];
                            }else{
                                $summ_deff_solder += $colony_id_defence['soldier'.$i] * $army_city['deffpihota']; 
                                $summ_deff_hors += $colony_id_defence['soldier'.$i]* $army_city['deffkoni'];
                                $count_deff_army = $count_deff_army + $colony_id_defence['soldier'.$i];
                            }                           
                        }
                    }
 
 
                    //сума дефу
                    $summ_deff = ($summ_deff_solder * $kof_pihota_attak) + ($summ_deff_hors * $kof_koni_attak);
 
                    $all_count = $count_attak_army + $count_deff_army;
                    if ($all_count >= 1000) {
                        $k = 2 * (1.8592 - pow($all_count, 0.015));
                        if ($k < 1.2578) {
                            $k = 1.2578;
                        }
                    }else{
                        $k = 1.5;
                    }
 
                    $snos_stena_riven = 0;
                    $snos_stena_ostatok = 0;
                    //Stena def
                    if ($colony_id_defence['stena'] > 0 ) {
                        if($plemy_defender['plemy'] == 1 ) $wall_army = 'stena_rus';
                        if($plemy_defender['plemy'] == 2 ) $wall_army = 'stena_ua';
                        if($plemy_defender['plemy'] == 3 ) $wall_army = 'stena_pl';
 
                        if ($army_attaker['type_attack'] == '2') {
                            if ($army_attaker['soldier7'] > 0) {
 
 
 
                                $oa = $summ_attak;
                                if ($summ_deff > 0) {
                                    $oz = $summ_deff;
                                }else{
                                    $oz = 1;
                                }
 
 
 
                                $x1 = pow(($oa/$oz), 1.5);
 
 
 
                                if ($x1 >= 1) {
                                    $x1 = floor((1-(0.5/$x1)) * 100);
                                }else{
                                    $x1 = floor(($x1 / 2) * 100);
                                }
 
 
 
                                $taran = $army_attaker['soldier7'];
 
 
                                $taran = floor(($taran * $x1) / 100); 
 
                                if ($taran > 0) {
 
                                    if ($plemy_defender['plemy'] == 1) {
                                        $lvl_build_destroi_kat = [1,2,3,4,5,6,8,10,12,14,17,20,23,27,31,35,39,43,48,53];
                                    }
                                    if ($plemy_defender['plemy'] == 2 ) {
                                        $lvl_build_destroi_kat = [1,4,8,13,19,27,36,46,57,69,83,98,114,132,151,171,192,214,238,263];
                                    }
                                    if ($plemy_defender['plemy'] == 3 ) {
                                        $lvl_build_destroi_kat = [1,2,4,6,8,11,15,19,23,28,34,40,46,53,61,69,77,86,96,106];
                                    }
 
                                    if ($colony_id_defence['kamenetes'] > 0) {
                                        $lvl_kamenetes = mysql_fetch_assoc(mysql_query("SELECT * FROM `kamenetes` WHERE `id` = '".$colony_id_defence['kamenetes']."' LIMIT 1"));
                                        foreach ($lvl_build_destroi_kat as &$value) {
                                            $value = round($value * $lvl_kamenetes['lvl_deff']);
                                        }
                                    }
 
                                    $lvl_build = $colony_id_defence['stena'];
 
                                    $id = $lvl_build - 1;
                                    $test = $lvl_build_destroi_kat[$id] - $taran;
 
 
                                    $kol_snosy = 0;
 
                                    if ($taran >= $lvl_build_destroi_kat[$id]){
                                        $kol_snosy = 0;
                                    }else{
                                        if ($taran >= $lvl_build_destroi_kat[19]){ 
                                            $kol_snosy = 0;
                                        }else{
                                            for ($i = 0; $i <= $id; $i++) { 
                                                if ($lvl_build_destroi_kat[$i] >= $test) {
                                                    $kol_snosy = $i+1;
                                                    break;
                                                }
                                            }
                                        }
                                    } 
 
                                    $snos_stena_riven = $colony_id_defence['stena'];
                                    $snos_stena_ostatok = $kol_snosy;
 
 
                                    $taran = $taran/4;
 
 
                                    $lvl_build = $colony_id_defence['stena'];
 
                                    $id = $lvl_build - 1;
                                    $test = $lvl_build_destroi_kat[$id] - $taran;
 
                                    $kol_snosy = 0;
 
                                    if ($taran >= $lvl_build_destroi_kat[$id]){
                                        $kol_snosy = 0;
                                    }else{
                                        if ($taran >= $lvl_build_destroi_kat[19]){ 
                                            $kol_snosy = 0;
                                        }else{
                                            for ($i = 0; $i <= $id; $i++) { 
                                                if ($lvl_build_destroi_kat[$i] >= $test) {
                                                    $kol_snosy = $i+1;
                                                    break;
                                                }
                                            }
                                        }
                                    }
                                    $snos = $snos_stena_riven - $snos_stena_ostatok;
                                    if ($snos > 0) {
                                        $lvl_city = 0;
                                        $table_snos = mysql_query("SELECT * FROM `".$wall_army."` ORDER BY `id` DESC");
                                        while($row1 = mysql_fetch_array($table_snos)){
                                            if ($row1['id'] >= $snos_stena_ostatok & $row1['id'] <= $colony_id_defence['stena']) {
                                                $lvl_city += $row1['city_people'];
                                            }
                                        }
                                        $people_stena = $colony_id_defence['city_people'] - $lvl_city;
 
                                        mysql_query("UPDATE `colony` SET `stena` = '".$snos_stena_ostatok."', `city_people` = '".$people_stena."' WHERE `colony_id` = '".$colony_id_defence['colony_id']."' ");
                                    } 
                                }   
                            }
                        }
 
                        if ($kol_snosy > 0) {
                            $wall_lvl =  mysql_fetch_assoc(mysql_query("SELECT * FROM `".$wall_army."` WHERE `id` = '".$colony_id_defence['stena']."' LIMIT 1"));
                            $summ_deff *= $wall_lvl['deff'];
                        }else{
                            if ($colony_id_defence['stena'] > 0) {
                                $wall_lvl =  mysql_fetch_assoc(mysql_query("SELECT * FROM `".$wall_army."` WHERE `id` = '".$colony_id_defence['stena']."' LIMIT 1"));
                                $summ_deff *= $wall_lvl['deff'];
                            }
                        }
                    }
 
                    //провірка прокачки полководця на захист
                        $chek_bonus_polkan = mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$plemy_attaker['login']."' LIMIT 1")); 
 
                      if($chek_bonus_polkan['zah_polkan'] > 0 ) {
                                $summ_deff += $summ_deff *  ($chek_bonus_polkan['zah_polkan'] / 100);
                             }
 
                    if ($user_army_bonus_deff['bonus_10_deff'] == '+' and $summ_deff != 0) {
                        $summ_deff += $summ_deff * 0.05;
                    }
                    $dead_army_attaker = 0;
                    $kill_army_stats_week = 0;
                    // Набег
                    if ($army_attaker['type_attack'] == '1') {
                        //winner atack
                        if ($summ_attak > $summ_deff) {
                            $x = 100 * pow(($summ_deff / $summ_attak),$k);
                            $attack = $x / (100 + $x);
                            $deff = $attack * 100;
                            $deff = (100 - $deff) / 100;
 
                            if ($summ_deff == 0) {
                                for ($i=1; $i <= 10; $i++) { 
                                    //$alive_soldier_attak = round($army_attaker['soldier'.$i]);
 
                                    //$alive_soldier_attak.''.$i = $army_attaker['soldier'.$i];
                                    //$dead_soldier_attack.''.$i = 0;
                                    if ($i == 1) {
                                        $alive_soldier_attak1 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack1 = 0;
                                    }
                                    if ($i == 2) {
                                        $alive_soldier_attak2 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack2 = 0;
                                    }
                                    if ($i == 3) {
                                        $alive_soldier_attak3 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack3 = 0;
                                    }
                                    if ($i == 4) {
                                        $alive_soldier_attak4 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack4 = 0;
                                    }
                                    if ($i == 5) {
                                        $alive_soldier_attak5 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack5 = 0;
                                    }
                                    if ($i == 6) {
                                        $alive_soldier_attak6 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack6 = 0;
                                    }
                                    if ($i == 7) {
                                        $alive_soldier_attak7 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack7 = 0;
                                    }
                                    if ($i == 8) {
                                        $alive_soldier_attak8 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack8 = 0;
                                    }
                                    if ($i == 9) {
                                        $alive_soldier_attak9 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack9 = 0;
                                    }
                                    if ($i == 10) {
                                        $alive_soldier_attak10 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack10 = 0;
                                    }
                                }
                            }else{
                                for ($i=1; $i <= 10; $i++) { 
 
                                    $alive_soldier_attak = round($attack*$army_attaker['soldier'.$i]);
                                    if ($i == 1) {
                                        $alive_soldier_attak1 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack1 = $alive_soldier_attak;
                                        $dead_army_attaker += $alive_soldier_attak;
 
                                    }
                                    if ($i == 2) {
                                        $alive_soldier_attak2 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack2 = $alive_soldier_attak;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 3) {
                                        $alive_soldier_attak3 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack3 = $alive_soldier_attak;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 4) {
                                        $alive_soldier_attak4 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack4 = $alive_soldier_attak;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 5) {
                                        $alive_soldier_attak5 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack5 = $alive_soldier_attak;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 6) {
                                        $alive_soldier_attak6 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack6 = $alive_soldier_attak;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 7) {
                                        $alive_soldier_attak7 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack7 = $alive_soldier_attak;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 8) {
                                        $alive_soldier_attak8 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack8 = $alive_soldier_attak;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 9) {
                                        $alive_soldier_attak9 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack9 = $alive_soldier_attak;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 10) {
                                        $alive_soldier_attak10 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack10 = $alive_soldier_attak;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                }
                            }
                            if ($plemy_attaker['plemy'] == 1) {
                                $units_type = 'units_rus';
                            }
                            if ($plemy_attaker['plemy'] == 2) {
                                $units_type = 'units_ua';
                            }
                            if ($plemy_attaker['plemy'] == 3) {
                                $units_type = 'units_pl';
                            }
                            $units_speed = 50;
                            if ($alive_soldier_attak1 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '1' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak1 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak2 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '2' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak2 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak3 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '3' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak3 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak4 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '4' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak4 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak5 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '5' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak5 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak6 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '6' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak6 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak7 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '7' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak7 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak8 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '8' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak8 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak9 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '9' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak9 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak10 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '10' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak10 * $units['can_get_ressours'];
                            }
 
                            $arena_colony = mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `colony_id` = '".$army_attaker['colony_id']."' LIMIT 1"));
                            //$arena = mysql_fetch_assoc(mysql_query("SELECT * FROM `arena` WHERE `id` = '".$arena_colony['arena']."' LIMIT 1"));
                                //if ($arena['hz'] > 0) {
                                    //$units_speed = $units_speed * $arena['hz'];
                                //}
                           $chek_bonus_polkan = mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$plemy_attaker['login']."' LIMIT 1")); 
                            if($chek_bonus_polkan['speed_polkan'] > 0 ) {
                                    $units_speed += $units_speed *  ($chek_bonus_polkan['speed_polkan'] / 100);
                             }
                            if ($user_army_bonus['bonus_10_speed'] == '+') {
                                $units_speed += $units_speed * 0.1;
                            }
                            $time_m = time_move($plemy_attaker['x'],$plemy_attaker['y'],$plemy_defender['x'],$plemy_defender['y'],$units_speed);
 
 
                            ///////////////////////////////////////////////
                            //Вираховування скільки зміг награбувати
                            ///////////////////////////////////////////////
                            //максимально може нести
                            $all_vizme = $max_size;
 
                            //рахувати тайник
                            if ($colony_id_defence['derevo'] > $tainik) {
                                $d = $colony_id_defence['derevo'] - $tainik;
                            }else{
                                if ($tainik >= $colony_id_defence['derevo']) {
                                    $d = 0;
                                }
                            }
                            if ($colony_id_defence['glina'] > $tainik) {
                                $g = $colony_id_defence['glina'] - $tainik;
                            }else{
                                if ($tainik >= $colony_id_defence['glina']) {
                                    $g = 0;
                                }
                            }
                            if ($colony_id_defence['jelezo'] > $tainik) {
                                $j = $colony_id_defence['jelezo'] - $tainik;
                            }else{
                                if ($tainik >= $colony_id_defence['jelezo']) {
                                    $j = 0;
                                }
                            }
                            if ($colony_id_defence['zerno'] > $tainik) {
                                $z = $colony_id_defence['zerno'] - $tainik;
                            }else{
                                if ($tainik >= $colony_id_defence['zerno']) {
                                    $z = 0;
                                }
                            }
 
                            $all_ress_user = $d + $g + $j + $z;
                            if ($all_vizme >= $all_ress_user) {
 
                                $vzjav_derevo = $d;
                                $vzjav_glina = $g;
                                $vzjav_jelezo = $j;
                                $vzjav_zerno = $z;
                                $robberies_stats_week = $vzjav_derevo + $vzjav_glina + $vzjav_jelezo + $vzjav_zerno;
                                $ostatok_derevo = $colony_id_defence['derevo'] - $d;
                                $ostatok_glina = $colony_id_defence['glina'] - $g;
                                $ostatok_jeleza = $colony_id_defence['jelezo'] - $j;
                                $ostatok_zerno = $colony_id_defence['zerno'] - $z;
                                //$d = 0;
                                //$g = 0;
                                //$j = 0;
                                //$z = 0;
                                //занести в mysql атаки ресурси що вкрав
                                //Добавити в повернення атаки дерево глиу ресурси
                                //update ressours user in table colony
                            }else{
                                if ($all_vizme < $all_ress_user) {
                                    $derevo_i[0] = $d;
                                    $glina_i[1] = $g;
                                    $jelezo_i[2] = $j;
                                    $zerno_i[3] = $z;
 
                                    $one_unit_ress_vizme = floor($all_vizme / 4);
 
                                    $min1 = min($derevo_i[0],$glina_i[1],$jelezo_i[2],$zerno_i[3]);
 
                                    $i = 0;
                                    while($i < 1){
                                        if ($d == $min1) {
                                            //echo 'Дерево '.$d;
                                            if ($one_unit_ress_vizme <= $d) {
                                                $vzjav_derevo = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $d;
                                                $vzjav_derevo = $d;
                                                $vzjav = $d;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 3);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            $min2 = min($glina_i[1],$jelezo_i[2],$zerno_i[3]);
                                        }
                                        if ($g == $min1) {
                                            //echo 'Глина '.$g;
                                            if ($one_unit_ress_vizme <= $g) {
                                                $vzjav_glina = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $g;
                                                $vzjav_glina = $g;
                                                $vzjav = $g;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 3);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            $min2 = min($derevo_i[0],$jelezo_i[2],$zerno_i[3]);
                                        }
                                        if ($j == $min1) {
                                            //echo 'Железо '.$j;
                                            if ($one_unit_ress_vizme <= $j) {
                                                $vzjav_jelezo = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $j;
                                                $vzjav_jelezo = $j;
                                                $vzjav = $j;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 3);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            $min2 = min($derevo_i[0],$glina_i[1],$zerno_i[3]);
                                        }
                                        if ($z == $min1) {
                                            //echo 'Зерно '.$z;
                                            if ($one_unit_ress_vizme <= $z) {
                                                $vzjav_zerno = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $z;
                                                $vzjav_zerno = $z;
                                                $vzjav = $z;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 3);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            $min2 = min($derevo_i[0],$glina_i[1],$jelezo_i[2]);
                                        }
                                        $i++;
                                    }
 
                                    $i = 0;
                                    while($i < 1){
                                        if ($d == $min2) {
                                            //echo 'Дерево '.$d;
                                            if ($one_unit_ress_vizme <= $d) {
                                                $vzjav_derevo = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $d;
                                                $vzjav_derevo = $d;
                                                $vzjav2 = $d;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 2);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($g == $min1) {
                                                $min3 = min($jelezo_i[2],$zerno_i[3]);
                                            }
                                            if ($j == $min1) {
                                                $min3 = min($glina_i[1],$zerno_i[3]);
                                            }
                                            if ($z == $min1) {
                                                $min3 = min($glina_i[1],$jelezo_i[2]);
                                            }
                                        }
                                        if ($g == $min2) {
                                            //echo 'Глина '.$g;
                                            if ($one_unit_ress_vizme <= $g) {
                                                $vzjav_glina = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $g;
                                                $vzjav_glina = $g;
                                                $vzjav2 = $g;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 2);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($d == $min1) {
                                                $min3 = min($jelezo_i[2],$zerno_i[3]);
                                            }
                                            if ($j == $min1) {
                                                $min3 = min($derevo_i[0],$zerno_i[3]);
                                            }
                                            if ($z == $min1) {
                                                $min3 = min($derevo_i[0],$jelezo_i[2]);
                                            }
 
                                        }
                                        if ($j == $min2) {
                                            //echo 'Железо '.$j;
                                            if ($one_unit_ress_vizme <= $j) {
                                                $vzjav_jelezo = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $j;
                                                $vzjav_jelezo = $j;
                                                $vzjav2 = $j;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 2);
                                            }
                                            if ($d == $min1) {
                                                $min3 = min($glina_i[1],$zerno_i[3]);
                                            }
                                            if ($g == $min1) {
                                                $min3 = min($derevo_i[0],$zerno_i[3]);
                                            }
                                            if ($z == $min1) {
                                                $min3 = min($derevo_i[0],$glina_i[1]);
                                            }
                                        }
                                        if ($z == $min2) {
                                            //echo 'Зерно '.$z;
                                            if ($one_unit_ress_vizme <= $z) {
                                                $vzjav_zerno = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $z;
                                                $vzjav_zerno = $z;
                                                $vzjav2 = $z;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 2);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($d == $min1) {
                                                $min3 = min($glina_i[1],$jelezo_i[2]);
                                            }
                                            if ($g == $min1) {
                                                $min3 = min($derevo_i[0],$jelezo_i[2]);
                                            }
                                            if ($j == $min1) {
                                                $min3 = min($derevo_i[0],$glina_i[1]);
                                            }
                                        }
                                        $i++;
                                    }
 
                                    $i = 0;
                                    while($i < 1){
                                        if ($d == $min3) {
                                            //echo 'Дерево '.$d;
                                            if ($one_unit_ress_vizme <= $d) {
                                                $vzjav_derevo = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $d;
                                                $vzjav_derevo = $d;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $vzjav2 - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($g == $min1) {
                                                $min4 = max($jelezo_i[2],$zerno_i[3]);
                                            }
                                            if ($j == $min1) {
                                                $min4 = max($glina_i[1],$zerno_i[3]);
                                            }
                                            if ($z == $min1) {
                                                $min4 = max($glina_i[1],$jelezo_i[2]);
                                            }
                                        }
                                        if ($g == $min3) {
                                            //echo 'Глина '.$g;
                                            if ($one_unit_ress_vizme <= $g) {
                                                $vzjav_glina = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $g;
                                                $vzjav_glina = $g;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $vzjav2 - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($d == $min1) {
                                                $min4 = max($jelezo_i[2],$zerno_i[3]);
                                            }
                                            if ($j == $min1) {
                                                $min4 = max($derevo_i[0],$zerno_i[3]);
                                            }
                                            if ($z == $min1) {
                                                $min4 = max($derevo_i[0],$jelezo_i[2]);
                                            }
 
                                        }
                                        if ($j == $min3) {
                                            //echo 'Железо '.$j;
                                            if ($one_unit_ress_vizme <= $j) {
                                                $vzjav_jelezo = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $j;
                                                $vzjav_jelezo = $j;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $vzjav2 - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($d == $min1) {
                                                $min4 = max($glina_i[1],$zerno_i[3]);
                                            }
                                            if ($g == $min1) {
                                                $min4 = max($derevo_i[0],$zerno_i[3]);
                                            }
                                            if ($z == $min1) {
                                                $min4 = max($derevo_i[0],$glina_i[1]);
                                            }
                                        }
                                        if ($z == $min3) {
                                            //echo 'Зерно '.$z;
                                            if ($one_unit_ress_vizme <= $z) {
                                                $vzjav_zerno = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $z;
                                                $vzjav_zerno = $z;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $vzjav2 - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($d == $min1) {
                                                $min4 = max($glina_i[1],$jelezo_i[2]);
                                            }
                                            if ($g == $min1) {
                                                $min4 = max($derevo_i[0],$jelezo_i[2]);
                                            }
                                            if ($j == $min1) {
                                                $min4 = max($derevo_i[0],$glina_i[1]);
                                            }
                                        }
                                        $i++;
                                    }
 
                                    $i = 0;
                                    while($i < 1){
                                        if ($d == $min4) {
                                            //echo 'Дерево '.$d;
                                            if ($one_unit_ress_vizme <= $d) {
                                                $vzjav_derevo = $one_unit_ress_vizme;
                                            }else{
                                                //$ostatok_one_unit_vizme = $one_unit_ress_vizme - $d;
                                                $vzjav_derevo = $d;
                                                //$one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                        }
                                        if ($g == $min4) {
                                            //echo 'Глина '.$g;
                                            if ($one_unit_ress_vizme <= $g) {
                                                $vzjav_glina = $one_unit_ress_vizme;
                                            }else{
                                                //$ostatok_one_unit_vizme = $one_unit_ress_vizme - $g;
                                                $vzjav_glina = $g;
                                                //$one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                        }
                                        if ($j == $min4) {
                                            //echo 'Железо '.$j;
                                            if ($one_unit_ress_vizme <= $j) {
                                                $vzjav_jelezo = $one_unit_ress_vizme;
                                            }else{
                                                //$ostatok_one_unit_vizme = $one_unit_ress_vizme - $j;
                                                $vzjav_jelezo = $j;
                                                //$one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) );
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                        }
                                        if ($z == $min4) {
                                            //echo 'Зерно '.$z;
                                            if ($one_unit_ress_vizme <= $z) {
                                                $vzjav_zerno = $one_unit_ress_vizme;
                                            }else{
                                                //$ostatok_one_unit_vizme = $one_unit_ress_vizme - $z;
                                                $vzjav_zerno = $z;
                                                //$one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                        }
                                        $i++;
                                    }
                                    $ostatok_derevo = $d - $vzjav_derevo;
                                    $ostatok_glina = $g - $vzjav_glina;
                                    $ostatok_jeleza = $j - $vzjav_jelezo;
                                    $ostatok_zerno = $z - $vzjav_zerno;
                                    $robberies_stats_week = $vzjav_derevo + $vzjav_glina + $vzjav_jelezo + $vzjav_zerno;
                                }
                            }
 
 
                            mysql_query("INSERT INTO `send_army`(`login`, `type_attack`, `last_time`, `x`,`y`, `colony_id`, `colony_id_deff`, `soldier1`, `soldier2`, `soldier3`, `soldier4`, `soldier5`, `soldier6`, `soldier7`, `soldier8`, `soldier9`, `soldier10`,`derevo`,`glina`,`jelezo`,`zerno`) VALUES ('".$army_attaker['login']."', '4', '".$time_m."', '".$plemy_defender['x']."', '".$plemy_defender['y']."', '".$army_attaker['colony_id']."', '".$army_attaker['colony_id_deff']."', '".$alive_soldier_attak1."', '".$alive_soldier_attak2."', '".$alive_soldier_attak3."', '".$alive_soldier_attak4."', '".$alive_soldier_attak5."', '".$alive_soldier_attak6."', '".$alive_soldier_attak7."', '".$alive_soldier_attak8."', '".$alive_soldier_attak9."', '".$alive_soldier_attak10."','".$vzjav_derevo."','".$vzjav_glina."','".$vzjav_jelezo."','".$vzjav_zerno."') ");
 
                            //$rand_id_attack = rand(111,9999999);
                            do {
                              $rand_id_attack = rand(111,9999999);
                              $result = mysql_query("SELECT * FROM `reports` WHERE `attack_id` = '".$rand_id_attack."' LIMIT 1");
                              $rand_atk = mysql_fetch_assoc($result);
                              if ($rand_atk['attack_id'] == $rand_id_attack) {
                                continue; // якщо знайдено збіг, продовжуйте цикл
                              } else {
                                break; // якщо збіг не знайдено, припиніть цикл
                              }
                            } while (true); // безмежний цикл, який треба припинити за допомогою break
                            mysql_query("INSERT INTO `reports`(`attack_id`,`user_attack`,`user_deff`,`colony_id_attack`,`colony_id_deff`,`plemy_attack`,`plemy_deff`,`off_1_unit`,`off_2_unit`,`off_3_unit`,`off_4_unit`,`off_5_unit`,`off_6_unit`,`off_7_unit`,`off_8_unit`,`off_9_unit`,`off_10_unit`,`off_1_result`,`off_2_result`,`off_3_result`,`off_4_result`,`off_5_result`,`off_6_result`,`off_7_result`,`off_8_result`,`off_9_result`,`off_10_result`,`time_attack`,`type_attack`,`max_size`,`derevo`,`glina`,`jelezo`,`zerno`) VALUES ('".$rand_id_attack."', '".$army_attaker['login']."', '".$colony_id_defence['login']."','".$army_attaker['colony_id']."','".$army_attaker['colony_id_deff']."','".$plemy_attaker['plemy']."','".$plemy_defender['plemy']."','".$army_attaker['soldier1']."','".$army_attaker['soldier2']."','".$army_attaker['soldier3']."','".$army_attaker['soldier4']."','".$army_attaker['soldier5']."','".$army_attaker['soldier6']."','".$army_attaker['soldier7']."','".$army_attaker['soldier8']."','".$army_attaker['soldier9']."','".$army_attaker['soldier10']."','".$dead_soldier_attack1."','".$dead_soldier_attack2."','".$dead_soldier_attack3."','".$dead_soldier_attack4."','".$dead_soldier_attack5."','".$dead_soldier_attack6."','".$dead_soldier_attack7."','".$dead_soldier_attack8."','".$dead_soldier_attack9."','".$dead_soldier_attack10."','".$army_attaker['last_time']."','".$army_attaker['type_attack']."','".$max_size."','".$vzjav_derevo."','".$vzjav_glina."','".$vzjav_jelezo."','".$vzjav_zerno."') ");
 
 
                            if ($alive_soldier_attak1 >= 11 or $alive_soldier_attak2 >= 11 or $alive_soldier_attak3 >= 11 or $alive_soldier_attak4 >= 11 or $alive_soldier_attak5 >= 11 or $alive_soldier_attak6 >= 11 or $alive_soldier_attak7 >= 11 or $alive_soldier_attak8 >= 11 or $alive_soldier_attak9 >= 11 or $alive_soldier_attak10 >= 11) {
                                $us_polkovodec =  mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$army_attaker['login']."' LIMIT 1"));
                                $robberies = $us_polkovodec['robberies'] + 1;
                                mysql_query("UPDATE `users` SET `robberies` = '".$robberies."' WHERE `login` = '".$army_attaker['login']."' ");
                            }
 
 
 
 
 
 
                            $type_plemy = mysql_fetch_assoc(mysql_query("SELECT * FROM `map` WHERE `colony_id` = '".$army_attaker['colony_id_deff']."' LIMIT 1"));
                            if($type_plemy['plemy'] == 1 ) $type_plemy_atk = 'units_rus';
                            if($type_plemy['plemy'] == 2 ) $type_plemy_atk = 'units_ua';
                            if($type_plemy['plemy'] == 3 ) $type_plemy_atk = 'units_pl';
 
                            for ($i=1; $i <= 10; $i++) { 
                                $alive_soldier_deff = round($deff*$colony_id_defence['soldier'.$i]);
                                if ($i == 1) {
                                    $alive_soldier_deff1 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_1 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 2) {
                                    $alive_soldier_deff2 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_2 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 3) {
                                    $alive_soldier_deff3 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_3 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 4) {
                                    $alive_soldier_deff4 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_4 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 5) {
                                    $alive_soldier_deff5 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_5 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 6) {
                                    $alive_soldier_deff6 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_6 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 7) {
                                    $alive_soldier_deff7 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_7 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 8) {
                                    $alive_soldier_deff8 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_8 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 9) {
                                    $alive_soldier_deff9 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_9 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 10) {
                                    $alive_soldier_deff10 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_10 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
 
                            }
                             mysql_query("UPDATE `colony` SET 
                                        `soldier1` = '".$alive_soldier_deff1."', 
                                        `soldier2` = '".$alive_soldier_deff2."', 
                                        `soldier3` = '".$alive_soldier_deff3."', 
                                        `soldier4` = '".$alive_soldier_deff4."', 
                                        `soldier5` = '".$alive_soldier_deff5."', 
                                        `soldier6` = '".$alive_soldier_deff6."', 
                                        `soldier7` = '".$alive_soldier_deff7."', 
                                        `soldier8` = '".$alive_soldier_deff8."', 
                                        `soldier9` = '".$alive_soldier_deff9."', 
                                        `soldier10` = '".$alive_soldier_deff10."',
                                        `derevo` = '".$ostatok_derevo."',
                                        `glina` = '".$ostatok_glina."',
                                        `jelezo` = '".$ostatok_jeleza."',
                                        `zerno` = '".$ostatok_zerno."'
                                        WHERE 
                                        `colony_id` = '".$army_attaker['colony_id_deff']."' ");
 
                             if ($type_plemy['plemy'] == 1) {
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_ru_1` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_ru_2` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_ru_3` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_ru_4` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_ru_5` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_ru_6` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_ru_7` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_ru_8` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_ru_9` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_ru_10` = '".$colony_id_defence['soldier10']."',
                                        `deff_unit_podkrep_ru_1_res` = '".$dead_soldier_def_1."', 
                                        `deff_unit_podkrep_ru_2_res` = '".$dead_soldier_def_2."', 
                                        `deff_unit_podkrep_ru_3_res` = '".$dead_soldier_def_3."', 
                                        `deff_unit_podkrep_ru_4_res` = '".$dead_soldier_def_4."', 
                                        `deff_unit_podkrep_ru_5_res` = '".$dead_soldier_def_5."', 
                                        `deff_unit_podkrep_ru_6_res` = '".$dead_soldier_def_6."', 
                                        `deff_unit_podkrep_ru_7_res` = '".$dead_soldier_def_7."', 
                                        `deff_unit_podkrep_ru_8_res` = '".$dead_soldier_def_8."', 
                                        `deff_unit_podkrep_ru_9_res` = '".$dead_soldier_def_9."', 
                                        `deff_unit_podkrep_ru_10_res` = '".$dead_soldier_def_10."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                             }
                             if ($type_plemy['plemy'] == 2) {
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_ua_1` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_ua_2` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_ua_3` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_ua_4` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_ua_5` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_ua_6` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_ua_7` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_ua_8` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_ua_9` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_ua_10` = '".$colony_id_defence['soldier10']."',
                                        `deff_unit_podkrep_ua_1_res` = '".$dead_soldier_def_1."', 
                                        `deff_unit_podkrep_ua_2_res` = '".$dead_soldier_def_2."', 
                                        `deff_unit_podkrep_ua_3_res` = '".$dead_soldier_def_3."', 
                                        `deff_unit_podkrep_ua_4_res` = '".$dead_soldier_def_4."', 
                                        `deff_unit_podkrep_ua_5_res` = '".$dead_soldier_def_5."', 
                                        `deff_unit_podkrep_ua_6_res` = '".$dead_soldier_def_6."', 
                                        `deff_unit_podkrep_ua_7_res` = '".$dead_soldier_def_7."', 
                                        `deff_unit_podkrep_ua_8_res` = '".$dead_soldier_def_8."', 
                                        `deff_unit_podkrep_ua_9_res` = '".$dead_soldier_def_9."', 
                                        `deff_unit_podkrep_ua_10_res` = '".$dead_soldier_def_10."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                             }
                             if ($type_plemy['plemy'] == 3) {
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_pl_1` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_pl_2` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_pl_3` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_pl_4` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_pl_5` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_pl_6` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_pl_7` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_pl_8` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_pl_9` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_pl_10` = '".$colony_id_defence['soldier10']."',
                                        `deff_unit_podkrep_pl_1_res` = '".$dead_soldier_def_1."', 
                                        `deff_unit_podkrep_pl_2_res` = '".$dead_soldier_def_2."', 
                                        `deff_unit_podkrep_pl_3_res` = '".$dead_soldier_def_3."', 
                                        `deff_unit_podkrep_pl_4_res` = '".$dead_soldier_def_4."', 
                                        `deff_unit_podkrep_pl_5_res` = '".$dead_soldier_def_5."', 
                                        `deff_unit_podkrep_pl_6_res` = '".$dead_soldier_def_6."', 
                                        `deff_unit_podkrep_pl_7_res` = '".$dead_soldier_def_7."', 
                                        `deff_unit_podkrep_pl_8_res` = '".$dead_soldier_def_8."', 
                                        `deff_unit_podkrep_pl_9_res` = '".$dead_soldier_def_9."', 
                                        `deff_unit_podkrep_pl_10_res` = '".$dead_soldier_def_10."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                             }
 
 
                            $res1 = mysql_query("SELECT * FROM `podkrep` WHERE `colony_id_deff` = '".$army_attaker['colony_id_deff']."' ");                       
                            while($row = mysql_fetch_array($res1)) {
                                for ($i = 1; $i <= 10; $i++) {
                                    $alive_soldier_deff_podkrep = round($deff*$row['soldier'.$i]);
 
                                    if ($i == 1) {
                                        $alive_soldier_deff_podkrep1 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep1 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 2) {
                                        $alive_soldier_deff_podkrep2 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep2 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 3) {
                                        $alive_soldier_deff_podkrep3 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep3 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 4) {
                                        $alive_soldier_deff_podkrep4 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep4 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 5) {
                                        $alive_soldier_deff_podkrep5 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep5 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 6) {
                                        $alive_soldier_deff_podkrep6 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep6 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 7) {
                                        $alive_soldier_deff_podkrep7 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep7 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 8) {
                                        $alive_soldier_deff_podkrep8 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep8 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 9) {
                                        $alive_soldier_deff_podkrep9 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep9 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 10) {
                                        $alive_soldier_deff_podkrep10 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep10 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                }
                                $podkrep_all = mysql_fetch_assoc(mysql_query("SELECT * FROM `reports` WHERE `attack_id` = '".$rand_id_attack."' LIMIT 1"));
 
 
                                do {
                                  $rand_id_attack22 = rand(111,9999999);
                                  $result22 = mysql_query("SELECT * FROM `reports` WHERE `attack_id` = '".$rand_id_attack22."' LIMIT 1");
                                  $rand_atk22 = mysql_fetch_assoc($result22);
                                  if ($rand_atk22['attack_id'] == $rand_id_attack22) {
                                    continue; // якщо знайдено збіг, продовжуйте цикл
                                  } else {
                                    break; // якщо збіг не знайдено, припиніть цикл
                                  }
                                } while (true);
 
                                podkrep_out($rand_id_attack22,$type_plemy['login'],$row['colony_id_send'],$row['colony_id_deff'],time(),$row['soldier1'],$row['soldier2'],$row['soldier3'],$row['soldier4'],$row['soldier5'],$row['soldier6'],$row['soldier7'],$row['soldier8'],$row['soldier9'],$row['soldier10'],$dead_podkrep1,$dead_podkrep2,$dead_podkrep3,$dead_podkrep4,$dead_podkrep5,$dead_podkrep6,$dead_podkrep7,$dead_podkrep8,$dead_podkrep9,$dead_podkrep10,$row['login']);
 
 
 
 
                                    mysql_query("UPDATE `podkrep` SET 
                                            `soldier1` = '".$alive_soldier_deff_podkrep1."', 
                                            `soldier2` = '".$alive_soldier_deff_podkrep2."', 
                                            `soldier3` = '".$alive_soldier_deff_podkrep3."', 
                                            `soldier4` = '".$alive_soldier_deff_podkrep4."', 
                                            `soldier5` = '".$alive_soldier_deff_podkrep5."', 
                                            `soldier6` = '".$alive_soldier_deff_podkrep6."', 
                                            `soldier7` = '".$alive_soldier_deff_podkrep7."', 
                                            `soldier8` = '".$alive_soldier_deff_podkrep8."', 
                                            `soldier9` = '".$alive_soldier_deff_podkrep9."', 
                                            `soldier10` = '".$alive_soldier_deff_podkrep10."' 
                                            WHERE 
                                            `id` = '".$row['id']."' ");
 
                                    if ($row['plemy'] == 1) {
                                        $deff_ru_1 = $podkrep_all['deff_unit_podkrep_ru_1'] + $row['soldier1'];
                                        $deff_ru_2 = $podkrep_all['deff_unit_podkrep_ru_2'] + $row['soldier2'];
                                        $deff_ru_3 = $podkrep_all['deff_unit_podkrep_ru_3'] + $row['soldier3'];
                                        $deff_ru_4 = $podkrep_all['deff_unit_podkrep_ru_4'] + $row['soldier4'];
                                        $deff_ru_5 = $podkrep_all['deff_unit_podkrep_ru_5'] + $row['soldier5'];
                                        $deff_ru_6 = $podkrep_all['deff_unit_podkrep_ru_6'] + $row['soldier6'];
                                        $deff_ru_7 = $podkrep_all['deff_unit_podkrep_ru_7'] + $row['soldier7'];
                                        $deff_ru_8 = $podkrep_all['deff_unit_podkrep_ru_8'] + $row['soldier8'];
                                        $deff_ru_9 = $podkrep_all['deff_unit_podkrep_ru_9'] + $row['soldier9'];
                                        $deff_ru_10 = $podkrep_all['deff_unit_podkrep_ru_10'] + $row['soldier10'];
                                        $dead_podkrep1 = $podkrep_all['deff_unit_podkrep_ru_1_res'] + $dead_podkrep1;
                                        $dead_podkrep2 = $podkrep_all['deff_unit_podkrep_ru_2_res'] + $dead_podkrep2;
                                        $dead_podkrep3 = $podkrep_all['deff_unit_podkrep_ru_3_res'] + $dead_podkrep3;
                                        $dead_podkrep4 = $podkrep_all['deff_unit_podkrep_ru_4_res'] + $dead_podkrep4;
                                        $dead_podkrep5 = $podkrep_all['deff_unit_podkrep_ru_5_res'] + $dead_podkrep5;
                                        $dead_podkrep6 = $podkrep_all['deff_unit_podkrep_ru_6_res'] + $dead_podkrep6;
                                        $dead_podkrep7 = $podkrep_all['deff_unit_podkrep_ru_7_res'] + $dead_podkrep7;
                                        $dead_podkrep8 = $podkrep_all['deff_unit_podkrep_ru_8_res'] + $dead_podkrep8;
                                        $dead_podkrep9 = $podkrep_all['deff_unit_podkrep_ru_9_res'] + $dead_podkrep9;
                                        $dead_podkrep10 = $podkrep_all['deff_unit_podkrep_ru_10_res'] + $dead_podkrep10;
                                     mysql_query("UPDATE `reports` SET 
                                            `deff_unit_podkrep_ru_1` = '".$deff_ru_1."', 
                                            `deff_unit_podkrep_ru_2` = '".$deff_ru_2."', 
                                            `deff_unit_podkrep_ru_3` = '".$deff_ru_3."', 
                                            `deff_unit_podkrep_ru_4` = '".$deff_ru_4."', 
                                            `deff_unit_podkrep_ru_5` = '".$deff_ru_5."', 
                                            `deff_unit_podkrep_ru_6` = '".$deff_ru_6."', 
                                            `deff_unit_podkrep_ru_7` = '".$deff_ru_7."', 
                                            `deff_unit_podkrep_ru_8` = '".$deff_ru_8."', 
                                            `deff_unit_podkrep_ru_9` = '".$deff_ru_9."', 
                                            `deff_unit_podkrep_ru_10` = '".$deff_ru_10."',
                                            `deff_unit_podkrep_ru_1_res` = '".$dead_podkrep1."', 
                                            `deff_unit_podkrep_ru_2_res` = '".$dead_podkrep2."', 
                                            `deff_unit_podkrep_ru_3_res` = '".$dead_podkrep3."', 
                                            `deff_unit_podkrep_ru_4_res` = '".$dead_podkrep4."', 
                                            `deff_unit_podkrep_ru_5_res` = '".$dead_podkrep5."', 
                                            `deff_unit_podkrep_ru_6_res` = '".$dead_podkrep6."', 
                                            `deff_unit_podkrep_ru_7_res` = '".$dead_podkrep7."', 
                                            `deff_unit_podkrep_ru_8_res` = '".$dead_podkrep8."', 
                                            `deff_unit_podkrep_ru_9_res` = '".$dead_podkrep9."', 
                                            `deff_unit_podkrep_ru_10_res` = '".$dead_podkrep10."'  
                                            WHERE 
                                            `attack_id` = '".$rand_id_attack."' ");
                                    }
                                    if ($row['plemy'] == 2) {
                                        $deff_ua_1 = $podkrep_all['deff_unit_podkrep_ua_1'] + $row['soldier1'];
                                        $deff_ua_2 = $podkrep_all['deff_unit_podkrep_ua_2'] + $row['soldier2'];
                                        $deff_ua_3 = $podkrep_all['deff_unit_podkrep_ua_3'] + $row['soldier3'];
                                        $deff_ua_4 = $podkrep_all['deff_unit_podkrep_ua_4'] + $row['soldier4'];
                                        $deff_ua_5 = $podkrep_all['deff_unit_podkrep_ua_5'] + $row['soldier5'];
                                        $deff_ua_6 = $podkrep_all['deff_unit_podkrep_ua_6'] + $row['soldier6'];
                                        $deff_ua_7 = $podkrep_all['deff_unit_podkrep_ua_7'] + $row['soldier7'];
                                        $deff_ua_8 = $podkrep_all['deff_unit_podkrep_ua_8'] + $row['soldier8'];
                                        $deff_ua_9 = $podkrep_all['deff_unit_podkrep_ua_9'] + $row['soldier9'];
                                        $deff_ua_10 = $podkrep_all['deff_unit_podkrep_ua_10'] + $row['soldier10'];
                                        $dead_podkrep1 = $podkrep_all['deff_unit_podkrep_ua_1_res'] + $dead_podkrep1;
                                        $dead_podkrep2 = $podkrep_all['deff_unit_podkrep_ua_2_res'] + $dead_podkrep2;
                                        $dead_podkrep3 = $podkrep_all['deff_unit_podkrep_ua_3_res'] + $dead_podkrep3;
                                        $dead_podkrep4 = $podkrep_all['deff_unit_podkrep_ua_4_res'] + $dead_podkrep4;
                                        $dead_podkrep5 = $podkrep_all['deff_unit_podkrep_ua_5_res'] + $dead_podkrep5;
                                        $dead_podkrep6 = $podkrep_all['deff_unit_podkrep_ua_6_res'] + $dead_podkrep6;
                                        $dead_podkrep7 = $podkrep_all['deff_unit_podkrep_ua_7_res'] + $dead_podkrep7;
                                        $dead_podkrep8 = $podkrep_all['deff_unit_podkrep_ua_8_res'] + $dead_podkrep8;
                                        $dead_podkrep9 = $podkrep_all['deff_unit_podkrep_ua_9_res'] + $dead_podkrep9;
                                        $dead_podkrep10 = $podkrep_all['deff_unit_podkrep_ua_10_res'] + $dead_podkrep10;
                                     mysql_query("UPDATE `reports` SET 
                                            `deff_unit_podkrep_ua_1` = '".$deff_ua_1."', 
                                            `deff_unit_podkrep_ua_2` = '".$deff_ua_2."', 
                                            `deff_unit_podkrep_ua_3` = '".$deff_ua_3."', 
                                            `deff_unit_podkrep_ua_4` = '".$deff_ua_4."', 
                                            `deff_unit_podkrep_ua_5` = '".$deff_ua_5."', 
                                            `deff_unit_podkrep_ua_6` = '".$deff_ua_6."', 
                                            `deff_unit_podkrep_ua_7` = '".$deff_ua_7."', 
                                            `deff_unit_podkrep_ua_8` = '".$deff_ua_8."', 
                                            `deff_unit_podkrep_ua_9` = '".$deff_ua_9."', 
                                            `deff_unit_podkrep_ua_10` = '".$deff_ua_10."',
                                            `deff_unit_podkrep_ua_1_res` = '".$dead_podkrep1."', 
                                            `deff_unit_podkrep_ua_2_res` = '".$dead_podkrep2."', 
                                            `deff_unit_podkrep_ua_3_res` = '".$dead_podkrep3."', 
                                            `deff_unit_podkrep_ua_4_res` = '".$dead_podkrep4."', 
                                            `deff_unit_podkrep_ua_5_res` = '".$dead_podkrep5."', 
                                            `deff_unit_podkrep_ua_6_res` = '".$dead_podkrep6."', 
                                            `deff_unit_podkrep_ua_7_res` = '".$dead_podkrep7."', 
                                            `deff_unit_podkrep_ua_8_res` = '".$dead_podkrep8."', 
                                            `deff_unit_podkrep_ua_9_res` = '".$dead_podkrep9."', 
                                            `deff_unit_podkrep_ua_10_res` = '".$dead_podkrep10."'  
                                            WHERE 
                                            `attack_id` = '".$rand_id_attack."' ");
                                    }
                                    if ($row['plemy'] == 3) {
                                        $deff_pl_1 = $podkrep_all['deff_unit_podkrep_pl_1'] + $row['soldier1'];
                                        $deff_pl_2 = $podkrep_all['deff_unit_podkrep_pl_2'] + $row['soldier2'];
                                        $deff_pl_3 = $podkrep_all['deff_unit_podkrep_pl_3'] + $row['soldier3'];
                                        $deff_pl_4 = $podkrep_all['deff_unit_podkrep_pl_4'] + $row['soldier4'];
                                        $deff_pl_5 = $podkrep_all['deff_unit_podkrep_pl_5'] + $row['soldier5'];
                                        $deff_pl_6 = $podkrep_all['deff_unit_podkrep_pl_6'] + $row['soldier6'];
                                        $deff_pl_7 = $podkrep_all['deff_unit_podkrep_pl_7'] + $row['soldier7'];
                                        $deff_pl_8 = $podkrep_all['deff_unit_podkrep_pl_8'] + $row['soldier8'];
                                        $deff_pl_9 = $podkrep_all['deff_unit_podkrep_pl_9'] + $row['soldier9'];
                                        $deff_pl_10 = $podkrep_all['deff_unit_podkrep_pl_10'] + $row['soldier10'];
                                        $dead_podkrep1 = $podkrep_all['deff_unit_podkrep_pl_1_res'] + $dead_podkrep1;
                                        $dead_podkrep2 = $podkrep_all['deff_unit_podkrep_pl_2_res'] + $dead_podkrep2;
                                        $dead_podkrep3 = $podkrep_all['deff_unit_podkrep_pl_3_res'] + $dead_podkrep3;
                                        $dead_podkrep4 = $podkrep_all['deff_unit_podkrep_pl_4_res'] + $dead_podkrep4;
                                        $dead_podkrep5 = $podkrep_all['deff_unit_podkrep_pl_5_res'] + $dead_podkrep5;
                                        $dead_podkrep6 = $podkrep_all['deff_unit_podkrep_pl_6_res'] + $dead_podkrep6;
                                        $dead_podkrep7 = $podkrep_all['deff_unit_podkrep_pl_7_res'] + $dead_podkrep7;
                                        $dead_podkrep8 = $podkrep_all['deff_unit_podkrep_pl_8_res'] + $dead_podkrep8;
                                        $dead_podkrep9 = $podkrep_all['deff_unit_podkrep_pl_9_res'] + $dead_podkrep9;
                                        $dead_podkrep10 = $podkrep_all['deff_unit_podkrep_pl_10_res'] + $dead_podkrep10;
                                     mysql_query("UPDATE `reports` SET 
                                            `deff_unit_podkrep_pl_1` = '".$deff_pl_1."', 
                                            `deff_unit_podkrep_pl_2` = '".$deff_pl_2."', 
                                            `deff_unit_podkrep_pl_3` = '".$deff_pl_3."', 
                                            `deff_unit_podkrep_pl_4` = '".$deff_pl_4."', 
                                            `deff_unit_podkrep_pl_5` = '".$deff_pl_5."', 
                                            `deff_unit_podkrep_pl_6` = '".$deff_pl_6."', 
                                            `deff_unit_podkrep_pl_7` = '".$deff_pl_7."', 
                                            `deff_unit_podkrep_pl_8` = '".$deff_pl_8."', 
                                            `deff_unit_podkrep_pl_9` = '".$deff_pl_9."', 
                                            `deff_unit_podkrep_pl_10` = '".$deff_pl_10."',
                                            `deff_unit_podkrep_pl_1_res` = '".$dead_podkrep1."', 
                                            `deff_unit_podkrep_pl_2_res` = '".$dead_podkrep2."', 
                                            `deff_unit_podkrep_pl_3_res` = '".$dead_podkrep3."', 
                                            `deff_unit_podkrep_pl_4_res` = '".$dead_podkrep4."', 
                                            `deff_unit_podkrep_pl_5_res` = '".$dead_podkrep5."', 
                                            `deff_unit_podkrep_pl_6_res` = '".$dead_podkrep6."', 
                                            `deff_unit_podkrep_pl_7_res` = '".$dead_podkrep7."', 
                                            `deff_unit_podkrep_pl_8_res` = '".$dead_podkrep8."', 
                                            `deff_unit_podkrep_pl_9_res` = '".$dead_podkrep9."', 
                                            `deff_unit_podkrep_pl_10_res` = '".$dead_podkrep10."'  
                                            WHERE 
                                            `attack_id` = '".$rand_id_attack."' ");
                                    }
 
 
 
                                if ($alive_soldier_deff_podkrep1 > 0 || $alive_soldier_deff_podkrep2 > 0 || $alive_soldier_deff_podkrep3 > 0 || $alive_soldier_deff_podkrep4 > 0 || $alive_soldier_deff_podkrep5 > 0 || $alive_soldier_deff_podkrep6 > 0 || $alive_soldier_deff_podkrep7 > 0 || $alive_soldier_deff_podkrep8 > 0 || $alive_soldier_deff_podkrep9 > 0 || $alive_soldier_deff_podkrep10 > 0) {
                                }else{
                                    mysql_query("DELETE FROM `podkrep` WHERE `id` = '".$row['id']."' ");
                                }
                            } 
 
 
 
                            if ($dead_army_attaker > 0) {
                                dead_army_attaker($colony_id_defence['login'], $dead_army_attaker);
                            }
 
 
                            if ($kill_army_stats_week > 0) {
                                dead_army_deffer($army_attaker['login'], $kill_army_stats_week);
                            }
 
 
                            if ($robberies_stats_week > 0) {
                                robberies_attaker($army_attaker['login'],$colony_id_defence['login'], $robberies_stats_week);
                            }
 
 
 
                        }else{
                            //winner deff
                            if ($summ_attak > 0) {
                                $x = 100 * pow(($summ_attak / $summ_deff),$k);
                                $deff = $x / (100 + $x);
                                $attack = $deff * 100;
                                $attack = (100 - $attack) / 100; 
                            }
 
                            for ($i=1; $i <= 10; $i++) { 
                                $alive_soldier_attak = round($attack*$army_attaker['soldier'.$i]);
                                if ($i == 1) {
                                    $alive_soldier_attak1 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack1 = $alive_soldier_attak;
                                    $dead_army_attaker += $alive_soldier_attak;
                                }
                                if ($i == 2) {
                                    $alive_soldier_attak2 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack2 = $alive_soldier_attak;
                                    $dead_army_attaker += $alive_soldier_attak;
                                }
                                if ($i == 3) {
                                    $alive_soldier_attak3 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack3 = $alive_soldier_attak;
                                    $dead_army_attaker += $alive_soldier_attak;
                                }
                                if ($i == 4) {
                                    $alive_soldier_attak4 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack4 = $alive_soldier_attak;
                                    $dead_army_attaker += $alive_soldier_attak;
                                }
                                if ($i == 5) {
                                    $alive_soldier_attak5 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack5 = $alive_soldier_attak;
                                    $dead_army_attaker += $alive_soldier_attak;
                                }
                                if ($i == 6) {
                                    $alive_soldier_attak6 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack6 = $alive_soldier_attak;
                                    $dead_army_attaker += $alive_soldier_attak;
                                }
                                if ($i == 7) {
                                    $alive_soldier_attak7 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack7 = $alive_soldier_attak;
                                    $dead_army_attaker += $alive_soldier_attak;
                                }
                                if ($i == 8) {
                                    $alive_soldier_attak8 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack8 = $alive_soldier_attak;
                                    $dead_army_attaker += $alive_soldier_attak;
                                }
                                if ($i == 9) {
                                    $alive_soldier_attak9 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack9 = $alive_soldier_attak;
                                    $dead_army_attaker += $alive_soldier_attak;
                                }
                                if ($i == 10) {
                                    $alive_soldier_attak10 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack10 = $alive_soldier_attak;
                                    $dead_army_attaker += $alive_soldier_attak;
                                }
                            }
 
                            if ($plemy_attaker['plemy'] == 1) {
                                $units_type = 'units_rus';
                            }
                            if ($plemy_attaker['plemy'] == 2) {
                                $units_type = 'units_ua';
                            }
                            if ($plemy_attaker['plemy'] == 3) {
                                $units_type = 'units_pl';
                            }
                            $units_speed = 50;
                            if ($alive_soldier_attak1 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '1' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak1 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak2 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '2' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak2 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak3 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '3' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak3 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak4 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '4' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak4 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak5 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '5' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak5 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak6 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '6' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak6 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak7 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '7' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak7 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak8 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '8' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak8 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak9 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '9' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak9 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak10 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '10' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak10 * $units['can_get_ressours'];
                            }
 
 
                            $arena_colony = mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `colony_id` = '".$army_attaker['colony_id']."' LIMIT 1"));
                            //$arena = mysql_fetch_assoc(mysql_query("SELECT * FROM `arena` WHERE `id` = '".$arena_colony['arena']."' LIMIT 1"));
                                //if ($arena['hz'] > 0) {
                                    //$units_speed = $units_speed * $arena['hz'];
                                //}
                            $chek_bonus_polkan = mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$plemy_attaker['login']."' LIMIT 1")); 
                            if($chek_bonus_polkan['speed_polkan'] > 0 ) {
                                    $units_speed += $units_speed *  ($chek_bonus_polkan['speed_polkan'] / 100);
                             }
                            if ($user_army_bonus['bonus_10_speed'] == '+') {
                                $units_speed += $units_speed * 0.1;
                            }
 
                            $time_m = time_move($plemy_attaker['x'],$plemy_attaker['y'],$plemy_defender['x'],$plemy_defender['y'],$units_speed);
 
                            if ($alive_soldier_attak1 > 0 || $alive_soldier_attak2 > 0 || $alive_soldier_attak3 > 0 || $alive_soldier_attak4 > 0 || $alive_soldier_attak5 > 0 || $alive_soldier_attak6 > 0 || $alive_soldier_attak7 > 0 || $alive_soldier_attak8 > 0 || $alive_soldier_attak9 > 0 || $alive_soldier_attak10 > 0 ) {
 
 
                                     ///////////////////////////////////////////////
                                    //Вираховування скільки зміг награбувати
                                    ///////////////////////////////////////////////
                                    //максимально може нести
                                    $all_vizme = $max_size;
                                if ($max_size > 5) {
 
 
                                    //рахувати тайник
                                    if ($colony_id_defence['derevo'] > $tainik) {
                                        $d = $colony_id_defence['derevo'] - $tainik;
                                    }else{
                                        if ($tainik >= $colony_id_defence['derevo']) {
                                            $d = 0;
                                        }
                                    }
                                    if ($colony_id_defence['glina'] > $tainik) {
                                        $g = $colony_id_defence['glina'] - $tainik;
                                    }else{
                                        if ($tainik >= $colony_id_defence['glina']) {
                                            $g = 0;
                                        }
                                    }
                                    if ($colony_id_defence['jelezo'] > $tainik) {
                                        $j = $colony_id_defence['jelezo'] - $tainik;
                                    }else{
                                        if ($tainik >= $colony_id_defence['jelezo']) {
                                            $j = 0;
                                        }
                                    }
                                    if ($colony_id_defence['zerno'] > $tainik) {
                                        $z = $colony_id_defence['zerno'] - $tainik;
                                    }else{
                                        if ($tainik >= $colony_id_defence['zerno']) {
                                            $z = 0;
                                        }
                                    }
 
                                    $all_ress_user = $d + $g + $j + $z;
                                    if ($all_vizme >= $all_ress_user) {
 
                                        $vzjav_derevo = $d;
                                        $vzjav_glina = $g;
                                        $vzjav_jelezo = $j;
                                        $vzjav_zerno = $z;
                                        $robberies_stats_week = $vzjav_derevo + $vzjav_glina + $vzjav_jelezo + $vzjav_zerno;
                                        $ostatok_derevo = $colony_id_defence['derevo'] - $d;
                                        $ostatok_glina = $colony_id_defence['glina'] - $g;
                                        $ostatok_jeleza = $colony_id_defence['jelezo'] - $j;
                                        $ostatok_zerno = $colony_id_defence['zerno'] - $z;
                                        $d = 0;
                                        $g = 0;
                                        $j = 0;
                                        $z = 0;
                                        //занести в mysql атаки ресурси що вкрав
                                        //Добавити в повернення атаки дерево глиу ресурси
                                        //update ressours user in table colony
                                    }else{
                                        if ($all_vizme < $all_ress_user) {
                                            $derevo_i[0] = $d;
                                            $glina_i[1] = $g;
                                            $jelezo_i[2] = $j;
                                            $zerno_i[3] = $z;
 
                                            $one_unit_ress_vizme = floor($all_vizme / 4);
 
                                            $min1 = min($derevo_i[0],$glina_i[1],$jelezo_i[2],$zerno_i[3]);
 
                                            $i = 0;
                                            while($i < 1){
                                                if ($d == $min1) {
                                                    //echo 'Дерево '.$d;
                                                    if ($one_unit_ress_vizme <= $d) {
                                                        $vzjav_derevo = $one_unit_ress_vizme;
                                                    }else{
                                                        $ostatok_one_unit_vizme = $one_unit_ress_vizme - $d;
                                                        $vzjav_derevo = $d;
                                                        $vzjav = $d;
                                                        $one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 3);
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                    $min2 = min($glina_i[1],$jelezo_i[2],$zerno_i[3]);
                                                }
                                                if ($g == $min1) {
                                                    //echo 'Глина '.$g;
                                                    if ($one_unit_ress_vizme <= $g) {
                                                        $vzjav_glina = $one_unit_ress_vizme;
                                                    }else{
                                                        $ostatok_one_unit_vizme = $one_unit_ress_vizme - $g;
                                                        $vzjav_glina = $g;
                                                        $vzjav = $g;
                                                        $one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 3);
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                    $min2 = min($derevo_i[0],$jelezo_i[2],$zerno_i[3]);
                                                }
                                                if ($j == $min1) {
                                                    //echo 'Железо '.$j;
                                                    if ($one_unit_ress_vizme <= $j) {
                                                        $vzjav_jelezo = $one_unit_ress_vizme;
                                                    }else{
                                                        $ostatok_one_unit_vizme = $one_unit_ress_vizme - $j;
                                                        $vzjav_jelezo = $j;
                                                        $vzjav = $j;
                                                        $one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 3);
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                    $min2 = min($derevo_i[0],$glina_i[1],$zerno_i[3]);
                                                }
                                                if ($z == $min1) {
                                                    //echo 'Зерно '.$z;
                                                    if ($one_unit_ress_vizme <= $z) {
                                                        $vzjav_zerno = $one_unit_ress_vizme;
                                                    }else{
                                                        $ostatok_one_unit_vizme = $one_unit_ress_vizme - $z;
                                                        $vzjav_zerno = $z;
                                                        $vzjav = $z;
                                                        $one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 3);
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                    $min2 = min($derevo_i[0],$glina_i[1],$jelezo_i[2]);
                                                }
                                                $i++;
                                            }
 
                                            $i = 0;
                                            while($i < 1){
                                                if ($d == $min2) {
                                                    //echo 'Дерево '.$d;
                                                    if ($one_unit_ress_vizme <= $d) {
                                                        $vzjav_derevo = $one_unit_ress_vizme;
                                                    }else{
                                                        $ostatok_one_unit_vizme = $one_unit_ress_vizme - $d;
                                                        $vzjav_derevo = $d;
                                                        $vzjav2 = $d;
                                                        $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 2);
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                    if ($g == $min1) {
                                                        $min3 = min($jelezo_i[2],$zerno_i[3]);
                                                    }
                                                    if ($j == $min1) {
                                                        $min3 = min($glina_i[1],$zerno_i[3]);
                                                    }
                                                    if ($z == $min1) {
                                                        $min3 = min($glina_i[1],$jelezo_i[2]);
                                                    }
                                                }
                                                if ($g == $min2) {
                                                    //echo 'Глина '.$g;
                                                    if ($one_unit_ress_vizme <= $g) {
                                                        $vzjav_glina = $one_unit_ress_vizme;
                                                    }else{
                                                        $ostatok_one_unit_vizme = $one_unit_ress_vizme - $g;
                                                        $vzjav_glina = $g;
                                                        $vzjav2 = $g;
                                                        $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 2);
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                    if ($d == $min1) {
                                                        $min3 = min($jelezo_i[2],$zerno_i[3]);
                                                    }
                                                    if ($j == $min1) {
                                                        $min3 = min($derevo_i[0],$zerno_i[3]);
                                                    }
                                                    if ($z == $min1) {
                                                        $min3 = min($derevo_i[0],$jelezo_i[2]);
                                                    }
 
                                                }
                                                if ($j == $min2) {
                                                    //echo 'Железо '.$j;
                                                    if ($one_unit_ress_vizme <= $j) {
                                                        $vzjav_jelezo = $one_unit_ress_vizme;
                                                    }else{
                                                        $ostatok_one_unit_vizme = $one_unit_ress_vizme - $j;
                                                        $vzjav_jelezo = $j;
                                                        $vzjav2 = $j;
                                                        $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 2);
                                                    }
                                                    if ($d == $min1) {
                                                        $min3 = min($glina_i[1],$zerno_i[3]);
                                                    }
                                                    if ($g == $min1) {
                                                        $min3 = min($derevo_i[0],$zerno_i[3]);
                                                    }
                                                    if ($z == $min1) {
                                                        $min3 = min($derevo_i[0],$glina_i[1]);
                                                    }
                                                }
                                                if ($z == $min2) {
                                                    //echo 'Зерно '.$z;
                                                    if ($one_unit_ress_vizme <= $z) {
                                                        $vzjav_zerno = $one_unit_ress_vizme;
                                                    }else{
                                                        $ostatok_one_unit_vizme = $one_unit_ress_vizme - $z;
                                                        $vzjav_zerno = $z;
                                                        $vzjav2 = $z;
                                                        $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 2);
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                    if ($d == $min1) {
                                                        $min3 = min($glina_i[1],$jelezo_i[2]);
                                                    }
                                                    if ($g == $min1) {
                                                        $min3 = min($derevo_i[0],$jelezo_i[2]);
                                                    }
                                                    if ($j == $min1) {
                                                        $min3 = min($derevo_i[0],$glina_i[1]);
                                                    }
                                                }
                                                $i++;
                                            }
 
                                            $i = 0;
                                            while($i < 1){
                                                if ($d == $min3) {
                                                    //echo 'Дерево '.$d;
                                                    if ($one_unit_ress_vizme <= $d) {
                                                        $vzjav_derevo = $one_unit_ress_vizme;
                                                    }else{
                                                        $ostatok_one_unit_vizme = $one_unit_ress_vizme - $d;
                                                        $vzjav_derevo = $d;
                                                        $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $vzjav2 - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                    if ($g == $min1) {
                                                        $min4 = max($jelezo_i[2],$zerno_i[3]);
                                                    }
                                                    if ($j == $min1) {
                                                        $min4 = max($glina_i[1],$zerno_i[3]);
                                                    }
                                                    if ($z == $min1) {
                                                        $min4 = max($glina_i[1],$jelezo_i[2]);
                                                    }
                                                }
                                                if ($g == $min3) {
                                                    //echo 'Глина '.$g;
                                                    if ($one_unit_ress_vizme <= $g) {
                                                        $vzjav_glina = $one_unit_ress_vizme;
                                                    }else{
                                                        $ostatok_one_unit_vizme = $one_unit_ress_vizme - $g;
                                                        $vzjav_glina = $g;
                                                        $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $vzjav2 - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                    if ($d == $min1) {
                                                        $min4 = max($jelezo_i[2],$zerno_i[3]);
                                                    }
                                                    if ($j == $min1) {
                                                        $min4 = max($derevo_i[0],$zerno_i[3]);
                                                    }
                                                    if ($z == $min1) {
                                                        $min4 = max($derevo_i[0],$jelezo_i[2]);
                                                    }
 
                                                }
                                                if ($j == $min3) {
                                                    //echo 'Железо '.$j;
                                                    if ($one_unit_ress_vizme <= $j) {
                                                        $vzjav_jelezo = $one_unit_ress_vizme;
                                                    }else{
                                                        $ostatok_one_unit_vizme = $one_unit_ress_vizme - $j;
                                                        $vzjav_jelezo = $j;
                                                        $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $vzjav2 - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                    if ($d == $min1) {
                                                        $min4 = max($glina_i[1],$zerno_i[3]);
                                                    }
                                                    if ($g == $min1) {
                                                        $min4 = max($derevo_i[0],$zerno_i[3]);
                                                    }
                                                    if ($z == $min1) {
                                                        $min4 = max($derevo_i[0],$glina_i[1]);
                                                    }
                                                }
                                                if ($z == $min3) {
                                                    //echo 'Зерно '.$z;
                                                    if ($one_unit_ress_vizme <= $z) {
                                                        $vzjav_zerno = $one_unit_ress_vizme;
                                                    }else{
                                                        $ostatok_one_unit_vizme = $one_unit_ress_vizme - $z;
                                                        $vzjav_zerno = $z;
                                                        $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $vzjav2 - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                    if ($d == $min1) {
                                                        $min4 = max($glina_i[1],$jelezo_i[2]);
                                                    }
                                                    if ($g == $min1) {
                                                        $min4 = max($derevo_i[0],$jelezo_i[2]);
                                                    }
                                                    if ($j == $min1) {
                                                        $min4 = max($derevo_i[0],$glina_i[1]);
                                                    }
                                                }
                                                $i++;
                                            }
 
                                            $i = 0;
                                            while($i < 1){
                                                if ($d == $min4) {
                                                    //echo 'Дерево '.$d;
                                                    if ($one_unit_ress_vizme <= $d) {
                                                        $vzjav_derevo = $one_unit_ress_vizme;
                                                    }else{
                                                        //$ostatok_one_unit_vizme = $one_unit_ress_vizme - $d;
                                                        $vzjav_derevo = $d;
                                                        //$one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                }
                                                if ($g == $min4) {
                                                    //echo 'Глина '.$g;
                                                    if ($one_unit_ress_vizme <= $g) {
                                                        $vzjav_glina = $one_unit_ress_vizme;
                                                    }else{
                                                        //$ostatok_one_unit_vizme = $one_unit_ress_vizme - $g;
                                                        $vzjav_glina = $g;
                                                        //$one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                }
                                                if ($j == $min4) {
                                                    //echo 'Железо '.$j;
                                                    if ($one_unit_ress_vizme <= $j) {
                                                        $vzjav_jelezo = $one_unit_ress_vizme;
                                                    }else{
                                                        //$ostatok_one_unit_vizme = $one_unit_ress_vizme - $j;
                                                        $vzjav_jelezo = $j;
                                                        //$one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) );
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                }
                                                if ($z == $min4) {
                                                    //echo 'Зерно '.$z;
                                                    if ($one_unit_ress_vizme <= $z) {
                                                        $vzjav_zerno = $one_unit_ress_vizme;
                                                    }else{
                                                        //$ostatok_one_unit_vizme = $one_unit_ress_vizme - $z;
                                                        $vzjav_zerno = $z;
                                                        //$one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                        //echo 'zzzz '.$one_unit_ress_vizme;
                                                    }
                                                }
                                                $i++;
                                            }
                                            $ostatok_derevo = $d - $vzjav_derevo;
                                            $ostatok_glina = $g - $vzjav_glina;
                                            $ostatok_jeleza = $j - $vzjav_jelezo;
                                            $ostatok_zerno = $z - $vzjav_zerno;
                                            $robberies_stats_week = $vzjav_derevo + $vzjav_glina + $vzjav_jelezo + $vzjav_zerno;
                                        }
                                    }                       
                                }else{
                                    $vzjav_derevo = 0;
                                    $vzjav_glina = 0;
                                    $vzjav_jelezo = 0;
                                    $vzjav_zerno = 0;
                                    $ostatok_derevo = $colony_id_defence['derevo'];
                                    $ostatok_glina = $colony_id_defence['glina'];
                                    $ostatok_jeleza = $colony_id_defence['jelezo'];
                                    $ostatok_zerno = $colony_id_defence['zerno'];
                                }
 
 
                                    mysql_query("INSERT INTO `send_army`(`login`, `type_attack`, `last_time`, `x`,`y`, `colony_id`, `colony_id_deff`, `soldier1`, `soldier2`, `soldier3`, `soldier4`, `soldier5`, `soldier6`, `soldier7`, `soldier8`, `soldier9`, `soldier10`,`derevo`,`glina`,`jelezo`,`zerno`) VALUES ('".$army_attaker['login']."', '4', '".$time_m."', '".$plemy_defender['x']."', '".$plemy_defender['y']."', '".$army_attaker['colony_id']."', '".$army_attaker['colony_id_deff']."', '".$alive_soldier_attak1."', '".$alive_soldier_attak2."', '".$alive_soldier_attak3."', '".$alive_soldier_attak4."', '".$alive_soldier_attak5."', '".$alive_soldier_attak6."', '".$alive_soldier_attak7."', '".$alive_soldier_attak8."', '".$alive_soldier_attak9."', '".$alive_soldier_attak10."','".$vzjav_derevo."','".$vzjav_glina."','".$vzjav_jelezo."','".$vzjav_zerno."') ");
                            }else{
                                $ostatok_derevo = $colony_id_defence['derevo'];
                                $ostatok_glina = $colony_id_defence['glina'];
                                $ostatok_jeleza = $colony_id_defence['jelezo'];
                                $ostatok_zerno = $colony_id_defence['zerno'];
                            }
 
                                //$rand_id_attack = rand(111,999999);
                                do {
                                  $rand_id_attack = rand(111,9999999);
                                  $result = mysql_query("SELECT * FROM `reports` WHERE `attack_id` = '".$rand_id_attack."' LIMIT 1");
                                  $rand_atk = mysql_fetch_assoc($result);
                                  if ($rand_atk['attack_id'] == $rand_id_attack) {
                                    continue; // якщо знайдено збіг, продовжуйте цикл
                                  } else {
                                    break; // якщо збіг не знайдено, припиніть цикл
                                  }
                                } while (true); // безмежний цикл, який треба припинити за допомогою break
                                mysql_query("INSERT INTO `reports`(`attack_id`,`user_attack`,`user_deff`,`colony_id_attack`,`colony_id_deff`,`plemy_attack`,`plemy_deff`,`off_1_unit`,`off_2_unit`,`off_3_unit`,`off_4_unit`,`off_5_unit`,`off_6_unit`,`off_7_unit`,`off_8_unit`,`off_9_unit`,`off_10_unit`,`off_1_result`,`off_2_result`,`off_3_result`,`off_4_result`,`off_5_result`,`off_6_result`,`off_7_result`,`off_8_result`,`off_9_result`,`off_10_result`,`time_attack`,`type_attack`,`max_size`,`derevo`,`glina`,`jelezo`,`zerno`) VALUES ('".$rand_id_attack."', '".$army_attaker['login']."', '".$colony_id_defence['login']."','".$army_attaker['colony_id']."','".$army_attaker['colony_id_deff']."','".$plemy_attaker['plemy']."','".$plemy_defender['plemy']."','".$army_attaker['soldier1']."','".$army_attaker['soldier2']."','".$army_attaker['soldier3']."','".$army_attaker['soldier4']."','".$army_attaker['soldier5']."','".$army_attaker['soldier6']."','".$army_attaker['soldier7']."','".$army_attaker['soldier8']."','".$army_attaker['soldier9']."','".$army_attaker['soldier10']."','".$dead_soldier_attack1."','".$dead_soldier_attack2."','".$dead_soldier_attack3."','".$dead_soldier_attack4."','".$dead_soldier_attack5."','".$dead_soldier_attack6."','".$dead_soldier_attack7."','".$dead_soldier_attack8."','".$dead_soldier_attack9."','".$dead_soldier_attack10."','".$army_attaker['last_time']."','".$army_attaker['type_attack']."','".$max_size."','".$vzjav_derevo."','".$vzjav_glina."','".$vzjav_jelezo."','".$vzjav_zerno."') ");
 
 
 
                            $type_plemy = mysql_fetch_assoc(mysql_query("SELECT * FROM `map` WHERE `colony_id` = '".$army_attaker['colony_id_deff']."' LIMIT 1"));
                            if($type_plemy['plemy'] == 1 ) $type_plemy_atk = 'units_rus';
                            if($type_plemy['plemy'] == 2 ) $type_plemy_atk = 'units_ua';
                            if($type_plemy['plemy'] == 3 ) $type_plemy_atk = 'units_pl';
 
                            for ($i=1; $i <= 10; $i++) { 
                                $alive_soldier_deff = round($deff*$colony_id_defence['soldier'.$i]);
                                if ($i == 1) {
                                    $alive_soldier_deff1 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_1 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 2) {
                                    $alive_soldier_deff2 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_2 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 3) {
                                    $alive_soldier_deff3 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_3 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 4) {
                                    $alive_soldier_deff4 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_4 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 5) {
                                    $alive_soldier_deff5 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_5 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 6) {
                                    $alive_soldier_deff6 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_6 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 7) {
                                    $alive_soldier_deff7 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_7 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 8) {
                                    $alive_soldier_deff8 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_8 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 9) {
                                    $alive_soldier_deff9 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_9 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 10) {
                                    $alive_soldier_deff10 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_10 = $alive_soldier_deff;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
 
                            }
                             mysql_query("UPDATE `colony` SET 
                                        `soldier1` = '".$alive_soldier_deff1."', 
                                        `soldier2` = '".$alive_soldier_deff2."', 
                                        `soldier3` = '".$alive_soldier_deff3."', 
                                        `soldier4` = '".$alive_soldier_deff4."', 
                                        `soldier5` = '".$alive_soldier_deff5."', 
                                        `soldier6` = '".$alive_soldier_deff6."', 
                                        `soldier7` = '".$alive_soldier_deff7."', 
                                        `soldier8` = '".$alive_soldier_deff8."', 
                                        `soldier9` = '".$alive_soldier_deff9."', 
                                        `soldier10` = '".$alive_soldier_deff10."',
                                        `derevo` = '".$ostatok_derevo."',
                                        `glina` = '".$ostatok_glina."',
                                        `jelezo` = '".$ostatok_jeleza."',
                                        `zerno` = '".$ostatok_zerno."'
                                        WHERE 
                                        `colony_id` = '".$army_attaker['colony_id_deff']."' ");
 
                             if ($type_plemy['plemy'] == 1) {
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_ru_1` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_ru_2` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_ru_3` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_ru_4` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_ru_5` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_ru_6` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_ru_7` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_ru_8` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_ru_9` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_ru_10` = '".$colony_id_defence['soldier10']."',
                                        `deff_unit_podkrep_ru_1_res` = '".$dead_soldier_def_1."', 
                                        `deff_unit_podkrep_ru_2_res` = '".$dead_soldier_def_2."', 
                                        `deff_unit_podkrep_ru_3_res` = '".$dead_soldier_def_3."', 
                                        `deff_unit_podkrep_ru_4_res` = '".$dead_soldier_def_4."', 
                                        `deff_unit_podkrep_ru_5_res` = '".$dead_soldier_def_5."', 
                                        `deff_unit_podkrep_ru_6_res` = '".$dead_soldier_def_6."', 
                                        `deff_unit_podkrep_ru_7_res` = '".$dead_soldier_def_7."', 
                                        `deff_unit_podkrep_ru_8_res` = '".$dead_soldier_def_8."', 
                                        `deff_unit_podkrep_ru_9_res` = '".$dead_soldier_def_9."', 
                                        `deff_unit_podkrep_ru_10_res` = '".$dead_soldier_def_10."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                             }
                             if ($type_plemy['plemy'] == 2) {
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_ua_1` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_ua_2` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_ua_3` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_ua_4` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_ua_5` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_ua_6` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_ua_7` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_ua_8` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_ua_9` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_ua_10` = '".$colony_id_defence['soldier10']."',
                                        `deff_unit_podkrep_ua_1_res` = '".$dead_soldier_def_1."', 
                                        `deff_unit_podkrep_ua_2_res` = '".$dead_soldier_def_2."', 
                                        `deff_unit_podkrep_ua_3_res` = '".$dead_soldier_def_3."', 
                                        `deff_unit_podkrep_ua_4_res` = '".$dead_soldier_def_4."', 
                                        `deff_unit_podkrep_ua_5_res` = '".$dead_soldier_def_5."', 
                                        `deff_unit_podkrep_ua_6_res` = '".$dead_soldier_def_6."', 
                                        `deff_unit_podkrep_ua_7_res` = '".$dead_soldier_def_7."', 
                                        `deff_unit_podkrep_ua_8_res` = '".$dead_soldier_def_8."', 
                                        `deff_unit_podkrep_ua_9_res` = '".$dead_soldier_def_9."', 
                                        `deff_unit_podkrep_ua_10_res` = '".$dead_soldier_def_10."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                             }
                             if ($type_plemy['plemy'] == 3) {
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_pl_1` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_pl_2` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_pl_3` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_pl_4` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_pl_5` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_pl_6` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_pl_7` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_pl_8` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_pl_9` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_pl_10` = '".$colony_id_defence['soldier10']."',
                                        `deff_unit_podkrep_pl_1_res` = '".$dead_soldier_def_1."', 
                                        `deff_unit_podkrep_pl_2_res` = '".$dead_soldier_def_2."', 
                                        `deff_unit_podkrep_pl_3_res` = '".$dead_soldier_def_3."', 
                                        `deff_unit_podkrep_pl_4_res` = '".$dead_soldier_def_4."', 
                                        `deff_unit_podkrep_pl_5_res` = '".$dead_soldier_def_5."', 
                                        `deff_unit_podkrep_pl_6_res` = '".$dead_soldier_def_6."', 
                                        `deff_unit_podkrep_pl_7_res` = '".$dead_soldier_def_7."', 
                                        `deff_unit_podkrep_pl_8_res` = '".$dead_soldier_def_8."', 
                                        `deff_unit_podkrep_pl_9_res` = '".$dead_soldier_def_9."', 
                                        `deff_unit_podkrep_pl_10_res` = '".$dead_soldier_def_10."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                             }
 
 
                            $res1 = mysql_query("SELECT * FROM `podkrep` WHERE `colony_id_deff` = '".$army_attaker['colony_id_deff']."' ");                       
                            while($row = mysql_fetch_array($res1)) {
                                for ($i = 1; $i <= 10; $i++) {
                                    $alive_soldier_deff_podkrep = round($deff*$row['soldier'.$i]);
 
                                    if ($i == 1) {
                                        $alive_soldier_deff_podkrep1 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep1 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 2) {
                                        $alive_soldier_deff_podkrep2 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep2 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 3) {
                                        $alive_soldier_deff_podkrep3 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep3 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 4) {
                                        $alive_soldier_deff_podkrep4 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep4 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 5) {
                                        $alive_soldier_deff_podkrep5 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep5 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 6) {
                                        $alive_soldier_deff_podkrep6 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep6 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 7) {
                                        $alive_soldier_deff_podkrep7 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep7 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 8) {
                                        $alive_soldier_deff_podkrep8 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep8 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 9) {
                                        $alive_soldier_deff_podkrep9 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep9 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 10) {
                                        $alive_soldier_deff_podkrep10 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep10 = $alive_soldier_deff_podkrep;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                }
                                $podkrep_all = mysql_fetch_assoc(mysql_query("SELECT * FROM `reports` WHERE `attack_id` = '".$rand_id_attack."' LIMIT 1"));
 
 
                                do {
                                  $rand_id_attack22 = rand(111,9999999);
                                  $result22 = mysql_query("SELECT * FROM `reports` WHERE `attack_id` = '".$rand_id_attack22."' LIMIT 1");
                                  $rand_atk22 = mysql_fetch_assoc($result22);
                                  if ($rand_atk22['attack_id'] == $rand_id_attack22) {
                                    continue; // якщо знайдено збіг, продовжуйте цикл
                                  } else {
                                    break; // якщо збіг не знайдено, припиніть цикл
                                  }
                                } while (true);
 
                                podkrep_out($rand_id_attack22,$type_plemy['login'],$row['colony_id_send'],$row['colony_id_deff'],time(),$row['soldier1'],$row['soldier2'],$row['soldier3'],$row['soldier4'],$row['soldier5'],$row['soldier6'],$row['soldier7'],$row['soldier8'],$row['soldier9'],$row['soldier10'],$dead_podkrep1,$dead_podkrep2,$dead_podkrep3,$dead_podkrep4,$dead_podkrep5,$dead_podkrep6,$dead_podkrep7,$dead_podkrep8,$dead_podkrep9,$dead_podkrep10,$row['login']);
 
 
                                    mysql_query("UPDATE `podkrep` SET 
                                            `soldier1` = '".$alive_soldier_deff_podkrep1."', 
                                            `soldier2` = '".$alive_soldier_deff_podkrep2."', 
                                            `soldier3` = '".$alive_soldier_deff_podkrep3."', 
                                            `soldier4` = '".$alive_soldier_deff_podkrep4."', 
                                            `soldier5` = '".$alive_soldier_deff_podkrep5."', 
                                            `soldier6` = '".$alive_soldier_deff_podkrep6."', 
                                            `soldier7` = '".$alive_soldier_deff_podkrep7."', 
                                            `soldier8` = '".$alive_soldier_deff_podkrep8."', 
                                            `soldier9` = '".$alive_soldier_deff_podkrep9."', 
                                            `soldier10` = '".$alive_soldier_deff_podkrep10."' 
                                            WHERE 
                                            `id` = '".$row['id']."' ");
 
                                    if ($row['plemy'] == 1) {
                                        $deff_ru_1 = $podkrep_all['deff_unit_podkrep_ru_1'] + $row['soldier1'];
                                        $deff_ru_2 = $podkrep_all['deff_unit_podkrep_ru_2'] + $row['soldier2'];
                                        $deff_ru_3 = $podkrep_all['deff_unit_podkrep_ru_3'] + $row['soldier3'];
                                        $deff_ru_4 = $podkrep_all['deff_unit_podkrep_ru_4'] + $row['soldier4'];
                                        $deff_ru_5 = $podkrep_all['deff_unit_podkrep_ru_5'] + $row['soldier5'];
                                        $deff_ru_6 = $podkrep_all['deff_unit_podkrep_ru_6'] + $row['soldier6'];
                                        $deff_ru_7 = $podkrep_all['deff_unit_podkrep_ru_7'] + $row['soldier7'];
                                        $deff_ru_8 = $podkrep_all['deff_unit_podkrep_ru_8'] + $row['soldier8'];
                                        $deff_ru_9 = $podkrep_all['deff_unit_podkrep_ru_9'] + $row['soldier9'];
                                        $deff_ru_10 = $podkrep_all['deff_unit_podkrep_ru_10'] + $row['soldier10'];
                                        $dead_podkrep1 = $podkrep_all['deff_unit_podkrep_ru_1_res'] + $dead_podkrep1;
                                        $dead_podkrep2 = $podkrep_all['deff_unit_podkrep_ru_2_res'] + $dead_podkrep2;
                                        $dead_podkrep3 = $podkrep_all['deff_unit_podkrep_ru_3_res'] + $dead_podkrep3;
                                        $dead_podkrep4 = $podkrep_all['deff_unit_podkrep_ru_4_res'] + $dead_podkrep4;
                                        $dead_podkrep5 = $podkrep_all['deff_unit_podkrep_ru_5_res'] + $dead_podkrep5;
                                        $dead_podkrep6 = $podkrep_all['deff_unit_podkrep_ru_6_res'] + $dead_podkrep6;
                                        $dead_podkrep7 = $podkrep_all['deff_unit_podkrep_ru_7_res'] + $dead_podkrep7;
                                        $dead_podkrep8 = $podkrep_all['deff_unit_podkrep_ru_8_res'] + $dead_podkrep8;
                                        $dead_podkrep9 = $podkrep_all['deff_unit_podkrep_ru_9_res'] + $dead_podkrep9;
                                        $dead_podkrep10 = $podkrep_all['deff_unit_podkrep_ru_10_res'] + $dead_podkrep10;
                                     mysql_query("UPDATE `reports` SET 
                                            `deff_unit_podkrep_ru_1` = '".$deff_ru_1."', 
                                            `deff_unit_podkrep_ru_2` = '".$deff_ru_2."', 
                                            `deff_unit_podkrep_ru_3` = '".$deff_ru_3."', 
                                            `deff_unit_podkrep_ru_4` = '".$deff_ru_4."', 
                                            `deff_unit_podkrep_ru_5` = '".$deff_ru_5."', 
                                            `deff_unit_podkrep_ru_6` = '".$deff_ru_6."', 
                                            `deff_unit_podkrep_ru_7` = '".$deff_ru_7."', 
                                            `deff_unit_podkrep_ru_8` = '".$deff_ru_8."', 
                                            `deff_unit_podkrep_ru_9` = '".$deff_ru_9."', 
                                            `deff_unit_podkrep_ru_10` = '".$deff_ru_10."',
                                            `deff_unit_podkrep_ru_1_res` = '".$dead_podkrep1."', 
                                            `deff_unit_podkrep_ru_2_res` = '".$dead_podkrep2."', 
                                            `deff_unit_podkrep_ru_3_res` = '".$dead_podkrep3."', 
                                            `deff_unit_podkrep_ru_4_res` = '".$dead_podkrep4."', 
                                            `deff_unit_podkrep_ru_5_res` = '".$dead_podkrep5."', 
                                            `deff_unit_podkrep_ru_6_res` = '".$dead_podkrep6."', 
                                            `deff_unit_podkrep_ru_7_res` = '".$dead_podkrep7."', 
                                            `deff_unit_podkrep_ru_8_res` = '".$dead_podkrep8."', 
                                            `deff_unit_podkrep_ru_9_res` = '".$dead_podkrep9."', 
                                            `deff_unit_podkrep_ru_10_res` = '".$dead_podkrep10."'  
                                            WHERE 
                                            `attack_id` = '".$rand_id_attack."' ");
                                    }
                                    if ($row['plemy'] == 2) {
                                        $deff_ua_1 = $podkrep_all['deff_unit_podkrep_ua_1'] + $row['soldier1'];
                                        $deff_ua_2 = $podkrep_all['deff_unit_podkrep_ua_2'] + $row['soldier2'];
                                        $deff_ua_3 = $podkrep_all['deff_unit_podkrep_ua_3'] + $row['soldier3'];
                                        $deff_ua_4 = $podkrep_all['deff_unit_podkrep_ua_4'] + $row['soldier4'];
                                        $deff_ua_5 = $podkrep_all['deff_unit_podkrep_ua_5'] + $row['soldier5'];
                                        $deff_ua_6 = $podkrep_all['deff_unit_podkrep_ua_6'] + $row['soldier6'];
                                        $deff_ua_7 = $podkrep_all['deff_unit_podkrep_ua_7'] + $row['soldier7'];
                                        $deff_ua_8 = $podkrep_all['deff_unit_podkrep_ua_8'] + $row['soldier8'];
                                        $deff_ua_9 = $podkrep_all['deff_unit_podkrep_ua_9'] + $row['soldier9'];
                                        $deff_ua_10 = $podkrep_all['deff_unit_podkrep_ua_10'] + $row['soldier10'];
                                        $dead_podkrep1 = $podkrep_all['deff_unit_podkrep_ua_1_res'] + $dead_podkrep1;
                                        $dead_podkrep2 = $podkrep_all['deff_unit_podkrep_ua_2_res'] + $dead_podkrep2;
                                        $dead_podkrep3 = $podkrep_all['deff_unit_podkrep_ua_3_res'] + $dead_podkrep3;
                                        $dead_podkrep4 = $podkrep_all['deff_unit_podkrep_ua_4_res'] + $dead_podkrep4;
                                        $dead_podkrep5 = $podkrep_all['deff_unit_podkrep_ua_5_res'] + $dead_podkrep5;
                                        $dead_podkrep6 = $podkrep_all['deff_unit_podkrep_ua_6_res'] + $dead_podkrep6;
                                        $dead_podkrep7 = $podkrep_all['deff_unit_podkrep_ua_7_res'] + $dead_podkrep7;
                                        $dead_podkrep8 = $podkrep_all['deff_unit_podkrep_ua_8_res'] + $dead_podkrep8;
                                        $dead_podkrep9 = $podkrep_all['deff_unit_podkrep_ua_9_res'] + $dead_podkrep9;
                                        $dead_podkrep10 = $podkrep_all['deff_unit_podkrep_ua_10_res'] + $dead_podkrep10;
                                     mysql_query("UPDATE `reports` SET 
                                            `deff_unit_podkrep_ua_1` = '".$deff_ua_1."', 
                                            `deff_unit_podkrep_ua_2` = '".$deff_ua_2."', 
                                            `deff_unit_podkrep_ua_3` = '".$deff_ua_3."', 
                                            `deff_unit_podkrep_ua_4` = '".$deff_ua_4."', 
                                            `deff_unit_podkrep_ua_5` = '".$deff_ua_5."', 
                                            `deff_unit_podkrep_ua_6` = '".$deff_ua_6."', 
                                            `deff_unit_podkrep_ua_7` = '".$deff_ua_7."', 
                                            `deff_unit_podkrep_ua_8` = '".$deff_ua_8."', 
                                            `deff_unit_podkrep_ua_9` = '".$deff_ua_9."', 
                                            `deff_unit_podkrep_ua_10` = '".$deff_ua_10."',
                                            `deff_unit_podkrep_ua_1_res` = '".$dead_podkrep1."', 
                                            `deff_unit_podkrep_ua_2_res` = '".$dead_podkrep2."', 
                                            `deff_unit_podkrep_ua_3_res` = '".$dead_podkrep3."', 
                                            `deff_unit_podkrep_ua_4_res` = '".$dead_podkrep4."', 
                                            `deff_unit_podkrep_ua_5_res` = '".$dead_podkrep5."', 
                                            `deff_unit_podkrep_ua_6_res` = '".$dead_podkrep6."', 
                                            `deff_unit_podkrep_ua_7_res` = '".$dead_podkrep7."', 
                                            `deff_unit_podkrep_ua_8_res` = '".$dead_podkrep8."', 
                                            `deff_unit_podkrep_ua_9_res` = '".$dead_podkrep9."', 
                                            `deff_unit_podkrep_ua_10_res` = '".$dead_podkrep10."'  
                                            WHERE 
                                            `attack_id` = '".$rand_id_attack."' ");
                                    }
                                    if ($row['plemy'] == 3) {
                                        $deff_pl_1 = $podkrep_all['deff_unit_podkrep_pl_1'] + $row['soldier1'];
                                        $deff_pl_2 = $podkrep_all['deff_unit_podkrep_pl_2'] + $row['soldier2'];
                                        $deff_pl_3 = $podkrep_all['deff_unit_podkrep_pl_3'] + $row['soldier3'];
                                        $deff_pl_4 = $podkrep_all['deff_unit_podkrep_pl_4'] + $row['soldier4'];
                                        $deff_pl_5 = $podkrep_all['deff_unit_podkrep_pl_5'] + $row['soldier5'];
                                        $deff_pl_6 = $podkrep_all['deff_unit_podkrep_pl_6'] + $row['soldier6'];
                                        $deff_pl_7 = $podkrep_all['deff_unit_podkrep_pl_7'] + $row['soldier7'];
                                        $deff_pl_8 = $podkrep_all['deff_unit_podkrep_pl_8'] + $row['soldier8'];
                                        $deff_pl_9 = $podkrep_all['deff_unit_podkrep_pl_9'] + $row['soldier9'];
                                        $deff_pl_10 = $podkrep_all['deff_unit_podkrep_pl_10'] + $row['soldier10'];
                                        $dead_podkrep1 = $podkrep_all['deff_unit_podkrep_pl_1_res'] + $dead_podkrep1;
                                        $dead_podkrep2 = $podkrep_all['deff_unit_podkrep_pl_2_res'] + $dead_podkrep2;
                                        $dead_podkrep3 = $podkrep_all['deff_unit_podkrep_pl_3_res'] + $dead_podkrep3;
                                        $dead_podkrep4 = $podkrep_all['deff_unit_podkrep_pl_4_res'] + $dead_podkrep4;
                                        $dead_podkrep5 = $podkrep_all['deff_unit_podkrep_pl_5_res'] + $dead_podkrep5;
                                        $dead_podkrep6 = $podkrep_all['deff_unit_podkrep_pl_6_res'] + $dead_podkrep6;
                                        $dead_podkrep7 = $podkrep_all['deff_unit_podkrep_pl_7_res'] + $dead_podkrep7;
                                        $dead_podkrep8 = $podkrep_all['deff_unit_podkrep_pl_8_res'] + $dead_podkrep8;
                                        $dead_podkrep9 = $podkrep_all['deff_unit_podkrep_pl_9_res'] + $dead_podkrep9;
                                        $dead_podkrep10 = $podkrep_all['deff_unit_podkrep_pl_10_res'] + $dead_podkrep10;
                                     mysql_query("UPDATE `reports` SET 
                                            `deff_unit_podkrep_pl_1` = '".$deff_pl_1."', 
                                            `deff_unit_podkrep_pl_2` = '".$deff_pl_2."', 
                                            `deff_unit_podkrep_pl_3` = '".$deff_pl_3."', 
                                            `deff_unit_podkrep_pl_4` = '".$deff_pl_4."', 
                                            `deff_unit_podkrep_pl_5` = '".$deff_pl_5."', 
                                            `deff_unit_podkrep_pl_6` = '".$deff_pl_6."', 
                                            `deff_unit_podkrep_pl_7` = '".$deff_pl_7."', 
                                            `deff_unit_podkrep_pl_8` = '".$deff_pl_8."', 
                                            `deff_unit_podkrep_pl_9` = '".$deff_pl_9."', 
                                            `deff_unit_podkrep_pl_10` = '".$deff_pl_10."',
                                            `deff_unit_podkrep_pl_1_res` = '".$dead_podkrep1."', 
                                            `deff_unit_podkrep_pl_2_res` = '".$dead_podkrep2."', 
                                            `deff_unit_podkrep_pl_3_res` = '".$dead_podkrep3."', 
                                            `deff_unit_podkrep_pl_4_res` = '".$dead_podkrep4."', 
                                            `deff_unit_podkrep_pl_5_res` = '".$dead_podkrep5."', 
                                            `deff_unit_podkrep_pl_6_res` = '".$dead_podkrep6."', 
                                            `deff_unit_podkrep_pl_7_res` = '".$dead_podkrep7."', 
                                            `deff_unit_podkrep_pl_8_res` = '".$dead_podkrep8."', 
                                            `deff_unit_podkrep_pl_9_res` = '".$dead_podkrep9."', 
                                            `deff_unit_podkrep_pl_10_res` = '".$dead_podkrep10."'  
                                            WHERE 
                                            `attack_id` = '".$rand_id_attack."' ");
                                    }
 
 
 
                                if ($alive_soldier_deff_podkrep1 > 0 || $alive_soldier_deff_podkrep2 > 0 || $alive_soldier_deff_podkrep3 > 0 || $alive_soldier_deff_podkrep4 > 0 || $alive_soldier_deff_podkrep5 > 0 || $alive_soldier_deff_podkrep6 > 0 || $alive_soldier_deff_podkrep7 > 0 || $alive_soldier_deff_podkrep8 > 0 || $alive_soldier_deff_podkrep9 > 0 || $alive_soldier_deff_podkrep10 > 0) {
                                }else{
                                    mysql_query("DELETE FROM `podkrep` WHERE `id` = '".$row['id']."' ");
                                }
                            }
 
 
                            if ($dead_army_attaker > 0) {
                                dead_army_attaker($colony_id_defence['login'], $dead_army_attaker);
                            }
 
 
                            if ($kill_army_stats_week > 0) {
                                dead_army_deffer($army_attaker['login'], $kill_army_stats_week);
                            }
 
 
                            if ($robberies_stats_week > 0) {
                                robberies_attaker($army_attaker['login'],$colony_id_defence['login'], $robberies_stats_week);
                            }
 
                        }
                    }
 
                    // Атака
                    if ($army_attaker['type_attack'] == '2') {
                        //winner atack
                        if ($summ_attak > $summ_deff) {
                            $x = 100 * pow(($summ_deff / $summ_attak),$k);
                            //$attack = $x / (100 + $x);
                            $attack = $x / 100;
                            $deff = 0;
 
 
                            if ($summ_deff == 0) {
                                for ($i=1; $i <= 10; $i++) { 
                                    //$alive_soldier_attak = round($army_attaker['soldier'.$i]);
                                    if ($i == 1) {
                                        $alive_soldier_attak1 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack1 = 0;
                                    }
                                    if ($i == 2) {
                                        $alive_soldier_attak2 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack2 = 0;
                                    }
                                    if ($i == 3) {
                                        $alive_soldier_attak3 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack3 = 0;
                                    }
                                    if ($i == 4) {
                                        $alive_soldier_attak4 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack4 = 0;
                                    }
                                    if ($i == 5) {
                                        $alive_soldier_attak5 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack5 = 0;
                                    }
                                    if ($i == 6) {
                                        $alive_soldier_attak6 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack6 = 0;
                                    }
                                    if ($i == 7) {
                                        $alive_soldier_attak7 = $army_attaker['soldier'.$i];
                                        $dead_soldier_attack7 = 0;
                                    }
                                    if ($i == 8) {
                                        if ($army_attaker['soldier8'] > 0) {
                                            // вибір першої атаки
                                            if ($army_attaker['type_build_snos'] != 'no_build') {
 
 
                                                if ($army_attaker['type_build_snos'] == 'random') {
                                                    $random_build_snos = random_build($colony_id_defence['colony_id']);
                                                }else{
                                                    $random_build_snos = $army_attaker['type_build_snos'];
                                                    if ($colony_id_defence[$random_build_snos] == 0) {
                                                        $random_build_snos = random_build($colony_id_defence['colony_id']);
                                                    }
                                                }
 
 
                                                if ($random_build_snos != 'no_build') {
 
 
                                                    $oa = $summ_attak;
                                                    $oz = 1;
                                                    $x1 = pow(($oa/$oz), 1.5);
                                                    if ($x1 >= 1) {
                                                        $x1 = floor((1-(0.5/$x1)) * 100);
                                                    }else{
                                                        $x1 = floor(($x1 / 2) * 100);
                                                    }
 
                                                    $kat = $army_attaker['soldier8'];
 
                                                    $kat = floor(($kat * $x1) / 100); 
 
                                                    if ($army_attaker['type_build_snos'] != 'no_build' and $army_attaker['type_build_snos2'] != 'no_build') {
                                                        $kat = floor($kat / 2);
                                                    }
 
                                                    $lvl_build_destroi_kat = [2,2,2,3,4,6,8,10,12,14,17,20,23,27,31,35,39,43,48,53];
 
                                                    if ($colony_id_defence['kamenetes'] > 0) {
                                                        $lvl_kamenetes = mysql_fetch_assoc(mysql_query("SELECT * FROM `kamenetes` WHERE `id` = '".$colony_id_defence['kamenetes']."' LIMIT 1"));
                                                        foreach ($lvl_build_destroi_kat as &$value) {
                                                            $value = round($value * $lvl_kamenetes['lvl_deff']);
                                                        }
                                                    }
 
                                                    $lvl_build = $colony_id_defence[$random_build_snos];
 
                                                    $id = $lvl_build - 1;
                                                    $test = $lvl_build_destroi_kat[$id] - $kat;
 
 
                                                    $kol_snosy = 0;
 
                                                    if ($kat >= $lvl_build_destroi_kat[$id]){
                                                        $kol_snosy = 0;
                                                    }else{
                                                        if ($kat >= $lvl_build_destroi_kat[$id]){ 
                                                            $kol_snosy = 0;
                                                        }else{
                                                            for ($l = 0; $l <= $id; $l++) { 
                                                                if ($lvl_build_destroi_kat[$l] >= $test) {
                                                                    $kol_snosy = $l+1;
                                                                    break;
                                                                }
                                                            }
                                                        }
                                                    } 
 
 
                                                    $snos_build_riven = $lvl_build - $kol_snosy;
 
                                                    if ($snos_build_riven == $lvl_build) {
                                                        $snos_build_riven = $lvl_build;
                                                        $snos_build_ostatok = 0;
                                                    }else{
                                                        $snos_build_ostatok = $kol_snosy;
                                                    }
 
                                                    $ostatok_lvl = $colony_id_defence[$random_build_snos] - $snos_build_riven;
                                                    if ($snos_build_riven > 0) {
                                                        if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma5' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15' || $random_build_snos == 'ferma16' || $random_build_snos == 'ferma17' || $random_build_snos == 'ferma18') {
                                                                if($plemy_defender['type'] == 1 ) {
                                                                    if ($random_build_snos == 'ferma5' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 2 ) {
                                                                    if ($random_build_snos == 'ferma6' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma2' || $random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma5' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15' || $random_build_snos == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 3 ) {
                                                                    if ($random_build_snos == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma5' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 4 ) {
                                                                    if ($random_build_snos == 'ferma5' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16' || $random_build_snos == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 5 ) {
                                                                    if ($random_build_snos == 'ferma5' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma6' || $random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 6 ) {
                                                                    if ($random_build_snos == 'ferma5' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                            }else{
                                                                if ($random_build_snos == 'sklad2' || $random_build_snos == 'sklad4' || $random_build_snos == 'sklad5' || $random_build_snos == 'sklad6' || $random_build_snos == 'sklad6' || $random_build_snos == 'sklad7' || $random_build_snos == 'sklad8' || $random_build_snos == 'sklad9' || $random_build_snos == 'sklad10') {
                                                                    $table_snos = mysql_query("SELECT * FROM `sklad` ORDER BY `id` DESC");
                                                                }else{
                                                                    if ($random_build_snos == 'ambar2' || $random_build_snos == 'ambar3' || $random_build_snos == 'ambar4' || $random_build_snos == 'ambar5' || $random_build_snos == 'ambar6' || $random_build_snos == 'ambar7' || $random_build_snos == 'ambar8' || $random_build_snos == 'ambar9' || $random_build_snos == 'ambar10') {
                                                                        $table_snos = mysql_query("SELECT * FROM `ambar` ORDER BY `id` DESC");
                                                                    }else{
                                                                        if ($random_build_snos == 'tainik2' || $random_build_snos == 'tainik3' || $random_build_snos == 'tainik4' || $random_build_snos == 'tainik5' || $random_build_snos == 'tainik6' || $random_build_snos == 'tainik7' || $random_build_snos == 'tainik8' || $random_build_snos == 'tainik9' || $random_build_snos == 'tainik10' || $random_build_snos == 'tainik11' || $random_build_snos == 'tainik12' || $random_build_snos == 'tainik13' || $random_build_snos == 'tainik14' || $random_build_snos == 'tainik15' || $random_build_snos == 'tainik16' || $random_build_snos == 'tainik17' || $random_build_snos == 'tainik18') {
                                                                            $table_snos = mysql_query("SELECT * FROM `tainik` ORDER BY `id` DESC");
                                                                        }else{
                                                                            $table_snos = mysql_query("SELECT * FROM `".$random_build_snos."` ORDER BY `id` DESC");
                                                                        }
                                                                    }
                                                                }
 
                                                            }
 
                                                        $lvl_city = 0;
                                                        while($row1 = mysql_fetch_array($table_snos)){
                                                            if ($row1['id'] >= $ostatok_lvl & $row1['id'] <= $colony_id_defence[$random_build_snos]) {
                                                                $lvl_city += $row1['city_people'];
                                                            }
                                                        }
                                                        $people = $colony_id_defence['city_people'] - $lvl_city;
                                                        mysql_query("UPDATE `colony` SET `".$random_build_snos."` = '".$snos_build_ostatok."', `city_people` = '".$people."' WHERE `colony_id` = '".$colony_id_defence['colony_id']."' ");
 
                                                        $town_colony_deffence =  mysql_fetch_assoc(mysql_query("SELECT * FROM `town` WHERE `colony_id` = '".$colony_id_defence['colony_id']."' LIMIT 1"));
                                                        if ($snos_build_ostatok == 0 & $random_build_snos != 'ferma1' & $random_build_snos != 'ferma2' & $random_build_snos != 'ferma3' & $random_build_snos != 'ferma4' & $random_build_snos != 'ferma5' & $random_build_snos != 'ferma6' & $random_build_snos != 'ferma7'  & $random_build_snos != 'ferma8' & $random_build_snos != 'ferma9' & $random_build_snos != 'ferma10' & $random_build_snos != 'ferma11' & $random_build_snos != 'ferma12' & $random_build_snos != 'ferma13' & $random_build_snos != 'ferma14' & $random_build_snos != 'ferma15' & $random_build_snos != 'ferma16' & $random_build_snos != 'ferma17' & $random_build_snos != 'ferma18') {
                                                            for ($g = 1; $g <= 21; $g++) {  
                                                                $grid = 'grid'.$g;
                                                                if ($town_colony_deffence[$grid] == $random_build_snos) {
                                                                    mysql_query("UPDATE `town` SET `".$grid."` = 'null' WHERE `colony_id` = '".$colony_id_defence['colony_id']."' ");
                                                                    mysql_query("DELETE FROM `build` WHERE `build_id` = '".$random_build_snos."' and `colony_id` = '".$colony_id_defence['colony_id']."' ");
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
 
                                            $colony_id_defence = mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `colony_id` = '".$army_attaker['colony_id_deff']."' LIMIT 1"));
 
                                            //вибір другої атаки
                                            if ($army_attaker['type_build_snos2'] != 'no_build' and $army_attaker['soldier8'] >= 20) {
 
 
                                                if ($army_attaker['type_build_snos2'] == 'random') {
                                                    $random_build_snos2 = random_build($colony_id_defence['colony_id']);
                                                }else{
                                                    $random_build_snos2 = $army_attaker['type_build_snos2'];
                                                    if ($colony_id_defence[$random_build_snos2] == 0) {
                                                        $random_build_snos2 = random_build($colony_id_defence['colony_id']);
                                                    }
                                                }
 
 
 
                                                if ($random_build_snos2 != 'no_build') {
                                                    $oa = $summ_attak;
                                                    $oz = 1;
 
                                                    $x1 = pow(($oa/$oz), 1.5);
 
                                                    if ($x1 >= 1) {
                                                        $x1 = floor((1-(0.5/$x1)) * 100);
                                                    }else{
                                                        $x1 = floor(($x1 / 2) * 100);
                                                    }                                            
 
                                                    $kat1 = $army_attaker['soldier8'];
 
                                                    $kat1 = floor(($kat1 * $x1) / 100); 
 
                                                    if ($army_attaker['type_build_snos'] != 'no_build' and $army_attaker['type_build_snos2'] != 'no_build') {
                                                        $kat1 = floor($kat1 / 2);
                                                    }
 
                                                    $lvl_build_destroi_kat = [2,2,2,3,4,6,8,10,12,14,17,20,23,27,31,35,39,43,48,53];
 
                                                    if ($colony_id_defence['kamenetes'] > 0) {
                                                        $lvl_kamenetes = mysql_fetch_assoc(mysql_query("SELECT * FROM `kamenetes` WHERE `id` = '".$colony_id_defence['kamenetes']."' LIMIT 1"));
                                                        foreach ($lvl_build_destroi_kat as &$value) {
                                                            $value = round($value * $lvl_kamenetes['lvl_deff']);
                                                        }
                                                    }
 
                                                    $lvl_build1 = $colony_id_defence[$random_build_snos2];
 
                                                    $id1 = $lvl_build1 - 1;
                                                    $test1 = $lvl_build_destroi_kat[$id1] - $kat1;
 
                                                    $kol_snosy1 = 0;
 
                                                    if ($kat1 >= $lvl_build_destroi_kat[$id1]){
                                                        $kol_snosy1 = 0;
                                                    }else{
                                                        if ($kat1 >= $lvl_build_destroi_kat[$id1]){ 
                                                            $kol_snosy1 = 0;
                                                        }else{
                                                            for ($l1 = 0; $l1 <= $id1; $l1++) { 
                                                                if ($lvl_build_destroi_kat[$l1] >= $test1) {
                                                                    $kol_snosy1 = $l1+1;
                                                                    break;
                                                                }
                                                            }
                                                        }
                                                    } 
 
                                                    $snos_build_riven2 = $lvl_build1 - $kol_snosy1;
 
                                                    if ($snos_build_riven2 == $lvl_build1) {
                                                        $snos_build_riven2 = $lvl_build1;
                                                        $snos_build_ostatok2 = 0;
                                                    }else{
                                                        $snos_build_ostatok2 = $kol_snosy1;
                                                    }
 
                                                    $ostatok_lvl1 = $colony_id_defence[$random_build_snos2] - $snos_build_riven2;
                                                    if ($snos_build_riven2 > 0) {
                                                        if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15' || $random_build_snos2 == 'ferma16' || $random_build_snos2 == 'ferma17' || $random_build_snos2 == 'ferma18') {
                                                                if($plemy_defender['type'] == 1 ) {
                                                                    if ($random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 2 ) {
                                                                    if ($random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15' || $random_build_snos2 == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 3 ) {
                                                                    if ($random_build_snos2 == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 4 ) {
                                                                    if ($random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16' || $random_build_snos2 == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 5 ) {
                                                                    if ($random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 6 ) {
                                                                    if ($random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                            }else{
                                                                if ($random_build_snos2 == 'sklad2' || $random_build_snos2 == 'sklad4' || $random_build_snos2 == 'sklad5' || $random_build_snos2 == 'sklad6' || $random_build_snos2 == 'sklad6' || $random_build_snos2 == 'sklad7' || $random_build_snos2 == 'sklad8' || $random_build_snos2 == 'sklad9' || $random_build_snos2 == 'sklad10') {
                                                                    $table_snos = mysql_query("SELECT * FROM `sklad` ORDER BY `id` DESC");
                                                                }else{
                                                                    if ($random_build_snos2 == 'ambar2' || $random_build_snos2 == 'ambar3' || $random_build_snos2 == 'ambar4' || $random_build_snos2 == 'ambar5' || $random_build_snos2 == 'ambar6' || $random_build_snos2 == 'ambar7' || $random_build_snos2 == 'ambar8' || $random_build_snos2 == 'ambar9' || $random_build_snos2 == 'ambar10') {
                                                                        $table_snos = mysql_query("SELECT * FROM `ambar` ORDER BY `id` DESC");
                                                                    }else{
                                                                        if ($random_build_snos2 == 'tainik2' || $random_build_snos2 == 'tainik3' || $random_build_snos2 == 'tainik4' || $random_build_snos2 == 'tainik5' || $random_build_snos2 == 'tainik6' || $random_build_snos2 == 'tainik7' || $random_build_snos2 == 'tainik8' || $random_build_snos2 == 'tainik9' || $random_build_snos2 == 'tainik10' || $random_build_snos2 == 'tainik11' || $random_build_snos2 == 'tainik12' || $random_build_snos2 == 'tainik13' || $random_build_snos2 == 'tainik14' || $random_build_snos2 == 'tainik15' || $random_build_snos2 == 'tainik16' || $random_build_snos2 == 'tainik17' || $random_build_snos2 == 'tainik18') {
                                                                            $table_snos = mysql_query("SELECT * FROM `tainik` ORDER BY `id` DESC");
                                                                        }else{
                                                                            $table_snos = mysql_query("SELECT * FROM `".$random_build_snos2."` ORDER BY `id` DESC");
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        $lvl_city1 = 0;
                                                        while($row1 = mysql_fetch_array($table_snos)){
                                                            if ($row1['id'] >= $ostatok_lvl1 & $row1['id'] <= $colony_id_defence[$random_build_snos2]) {
                                                                $lvl_city1 += $row1['city_people'];
                                                            }
                                                        }
                                                        $people = $colony_id_defence['city_people'] - $lvl_city1;
                                                        mysql_query("UPDATE `colony` SET `".$random_build_snos2."` = '".$snos_build_ostatok2."', `city_people` = '".$people."' WHERE `colony_id` = '".$colony_id_defence['colony_id']."' ");
 
                                                        $town_colony_deffence =  mysql_fetch_assoc(mysql_query("SELECT * FROM `town` WHERE `colony_id` = '".$colony_id_defence['colony_id']."' LIMIT 1"));
                                                        if ($snos_build_ostatok1 == 0 & $random_build_snos2 != 'ferma1' & $random_build_snos2 != 'ferma2' & $random_build_snos2 != 'ferma3' & $random_build_snos2 != 'ferma4' & $random_build_snos2 != 'ferma5' & $random_build_snos2 != 'ferma6' & $random_build_snos2 != 'ferma7'  & $random_build_snos2 != 'ferma8' & $random_build_snos2 != 'ferma9' & $random_build_snos2 != 'ferma10' & $random_build_snos2 != 'ferma11' & $random_build_snos2 != 'ferma12' & $random_build_snos2 != 'ferma13' & $random_build_snos2 != 'ferma14' & $random_build_snos2 != 'ferma15' & $random_build_snos2 != 'ferma16' & $random_build_snos2 != 'ferma17' & $random_build_snos2 != 'ferma18') {
                                                            for ($g = 1; $g <= 21; $g++) {  
                                                                $grid = 'grid'.$g;
                                                                if ($town_colony_deffence[$grid] == $random_build_snos2) {
                                                                    mysql_query("UPDATE `town` SET `".$grid."` = 'null' WHERE `colony_id` = '".$colony_id_defence['colony_id']."' ");
                                                                    mysql_query("DELETE FROM `build` WHERE `build_id` = '".$random_build_snos."' and `colony_id` = '".$colony_id_defence['colony_id']."' ");
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                            $alive_soldier_attak8 = $army_attaker['soldier8'];
                                            $dead_soldier_attack8 = 0;
                                        }else{
                                            $alive_soldier_attak8 = $army_attaker['soldier8'];
                                            $dead_soldier_attack8 = 0;
                                        }
                                    }
                                    if ($i == 9) {
                                        $alive_soldier_attak9 = $army_attaker['soldier9'];
                                        $dead_soldier_attack9 = 0;
                                    }
                                    if ($i == 10) {
                                        $alive_soldier_attak10 = $army_attaker['soldier10'];
                                        $dead_soldier_attack10 = 0;
                                    }
                                }
                                $Loss_army_polk = 0;
                                $dead_army_attaker = 0;
 
                            }else{
                                for ($i=1; $i <= 10; $i++) { 
                                    $alive_soldier_attak = round($attack*$army_attaker['soldier'.$i]);
                                    if ($i == 1) {
                                        $alive_soldier_attak1 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack1 = $alive_soldier_attak;
                                        $Loss_army_polk += $Loss_army_polk + $dead_soldier_attack1;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 2) {
                                        $alive_soldier_attak2 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack2 = $alive_soldier_attak;
                                        $Loss_army_polk = $Loss_army_polk + $dead_soldier_attack2;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 3) {
                                        $alive_soldier_attak3 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack3 = $alive_soldier_attak;
                                        $Loss_army_polk = $Loss_army_polk + $dead_soldier_attack3;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 4) {
                                        $alive_soldier_attak4 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack4 = $alive_soldier_attak;
                                        $Loss_army_polk = $Loss_army_polk + $dead_soldier_attack4;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 5) {
                                        $alive_soldier_attak5 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack5 = $alive_soldier_attak;
                                        $Loss_army_polk = $Loss_army_polk + $dead_soldier_attack5;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 6) {
                                        $alive_soldier_attak6 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack6 = $alive_soldier_attak;
                                        $Loss_army_polk = $Loss_army_polk + $dead_soldier_attack6;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 7) {
                                        $alive_soldier_attak7 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                        $dead_soldier_attack7 = $alive_soldier_attak;
                                        $Loss_army_polk = $Loss_army_polk + $dead_soldier_attack7;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 8) {
                                        if ($army_attaker['soldier8'] > 0) {
                                            if ($army_attaker['type_build_snos'] != 'no_build') {
 
 
                                                if ($army_attaker['type_build_snos'] == 'random') {
                                                    $random_build_snos = random_build($colony_id_defence['colony_id']);
                                                }else{
                                                    $random_build_snos = $army_attaker['type_build_snos'];
                                                    if ($colony_id_defence[$random_build_snos] == 0) {
                                                        $random_build_snos = random_build($colony_id_defence['colony_id']);
                                                    }
                                                }
 
 
                                                if ($random_build_snos != 'no_build') {
 
                                                    $oa = $summ_attak;
                                                    $oz = $summ_deff;
 
 
                                                    $x1 = pow(($oa/$oz), 1.5);
 
 
                                                    if ($x1 >= 1) {
                                                        $x1 = floor((1-(0.5/$x1)) * 100);
                                                    }else{
                                                        $x1 = floor(($x1 / 2) * 100);
                                                    }
 
 
 
                                                    $kat = $army_attaker['soldier8'];
 
 
                                                    $kat = floor(($kat * $x1) / 100); 
 
                                                    if ($army_attaker['type_build_snos'] != 'no_build' and $army_attaker['type_build_snos2'] != 'no_build') {
                                                        $kat = floor($kat / 2);
                                                    }
 
                                                    $lvl_build_destroi_kat = [2,2,2,3,4,6,8,10,12,14,17,20,23,27,31,35,39,43,48,53];
 
                                                    if ($colony_id_defence['kamenetes'] > 0) {
                                                        $lvl_kamenetes = mysql_fetch_assoc(mysql_query("SELECT * FROM `kamenetes` WHERE `id` = '".$colony_id_defence['kamenetes']."' LIMIT 1"));
                                                        foreach ($lvl_build_destroi_kat as &$value) {
                                                            $value = round($value * $lvl_kamenetes['lvl_deff']);
                                                        }
                                                    }
 
                                                    $lvl_build = $colony_id_defence[$random_build_snos];
 
                                                    $id = $lvl_build - 1;
                                                    $test = $lvl_build_destroi_kat[$id] - $kat;
 
 
                                                    $kol_snosy = 0;
 
                                                    if ($kat >= $lvl_build_destroi_kat[$id]){
                                                        $kol_snosy = 0;
                                                    }else{
                                                        if ($kat >= $lvl_build_destroi_kat[$id]){ 
                                                            $kol_snosy = 0;
                                                        }else{
                                                            for ($l = 0; $l <= $id; $l++) { 
                                                                if ($lvl_build_destroi_kat[$l] >= $test) {
                                                                    $kol_snosy = $l+1;
                                                                    break;
                                                                }
                                                            }
                                                        }
                                                    } 
 
 
                                                    $snos_build_riven = $lvl_build - $kol_snosy;
 
                                                    if ($snos_build_riven == $lvl_build) {
                                                        $snos_build_riven = $lvl_build;
                                                        $snos_build_ostatok = 0;
                                                    }else{
                                                        $snos_build_ostatok = $kol_snosy;
                                                    }
 
                                                    $ostatok_lvl = $colony_id_defence[$random_build_snos] - $snos_build_riven;
                                                    if ($snos_build_riven > 0) {
                                                        if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma5' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15' || $random_build_snos == 'ferma16' || $random_build_snos == 'ferma17' || $random_build_snos == 'ferma18') {
                                                                if($plemy_defender['type'] == 1 ) {
                                                                    if ($random_build_snos == 'ferma5' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 2 ) {
                                                                    if ($random_build_snos == 'ferma6' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma2' || $random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma5' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15' || $random_build_snos == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 3 ) {
                                                                    if ($random_build_snos == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma5' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 4 ) {
                                                                    if ($random_build_snos == 'ferma5' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16' || $random_build_snos == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 5 ) {
                                                                    if ($random_build_snos == 'ferma5' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma6' || $random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 6 ) {
                                                                    if ($random_build_snos == 'ferma5' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                            }else{
                                                                if ($random_build_snos == 'sklad2' || $random_build_snos == 'sklad4' || $random_build_snos == 'sklad5' || $random_build_snos == 'sklad6' || $random_build_snos == 'sklad6' || $random_build_snos == 'sklad7' || $random_build_snos == 'sklad8' || $random_build_snos == 'sklad9' || $random_build_snos == 'sklad10') {
                                                                    $table_snos = mysql_query("SELECT * FROM `sklad` ORDER BY `id` DESC");
                                                                }else{
                                                                    if ($random_build_snos == 'ambar2' || $random_build_snos == 'ambar3' || $random_build_snos == 'ambar4' || $random_build_snos == 'ambar5' || $random_build_snos == 'ambar6' || $random_build_snos == 'ambar7' || $random_build_snos == 'ambar8' || $random_build_snos == 'ambar9' || $random_build_snos == 'ambar10') {
                                                                        $table_snos = mysql_query("SELECT * FROM `ambar` ORDER BY `id` DESC");
                                                                    }else{
                                                                        if ($random_build_snos == 'tainik2' || $random_build_snos == 'tainik3' || $random_build_snos == 'tainik4' || $random_build_snos == 'tainik5' || $random_build_snos == 'tainik6' || $random_build_snos == 'tainik7' || $random_build_snos == 'tainik8' || $random_build_snos == 'tainik9' || $random_build_snos == 'tainik10' || $random_build_snos == 'tainik11' || $random_build_snos == 'tainik12' || $random_build_snos == 'tainik13' || $random_build_snos == 'tainik14' || $random_build_snos == 'tainik15' || $random_build_snos == 'tainik16' || $random_build_snos == 'tainik17' || $random_build_snos == 'tainik18') {
                                                                            $table_snos = mysql_query("SELECT * FROM `tainik` ORDER BY `id` DESC");
                                                                        }else{
                                                                            $table_snos = mysql_query("SELECT * FROM `".$random_build_snos."` ORDER BY `id` DESC");
                                                                        }
                                                                    }
                                                                }
 
                                                            }
 
                                                        $lvl_city = 0;
                                                        while($row1 = mysql_fetch_array($table_snos)){
                                                            if ($row1['id'] >= $ostatok_lvl & $row1['id'] <= $colony_id_defence[$random_build_snos]) {
                                                                $lvl_city += $row1['city_people'];
                                                            }
                                                        }
                                                        $people = $colony_id_defence['city_people'] - $lvl_city;
                                                        mysql_query("UPDATE `colony` SET `".$random_build_snos."` = '".$snos_build_ostatok."', `city_people` = '".$people."' WHERE `colony_id` = '".$colony_id_defence['colony_id']."' ");
 
                                                        $town_colony_deffence =  mysql_fetch_assoc(mysql_query("SELECT * FROM `town` WHERE `colony_id` = '".$colony_id_defence['colony_id']."' LIMIT 1"));
                                                        if ($snos_build_ostatok == 0 & $random_build_snos != 'ferma1' & $random_build_snos != 'ferma2' & $random_build_snos != 'ferma3' & $random_build_snos != 'ferma4' & $random_build_snos != 'ferma5' & $random_build_snos != 'ferma6' & $random_build_snos != 'ferma7'  & $random_build_snos != 'ferma8' & $random_build_snos != 'ferma9' & $random_build_snos != 'ferma10' & $random_build_snos != 'ferma11' & $random_build_snos != 'ferma12' & $random_build_snos != 'ferma13' & $random_build_snos != 'ferma14' & $random_build_snos != 'ferma15' & $random_build_snos != 'ferma16' & $random_build_snos != 'ferma17' & $random_build_snos != 'ferma18') {
                                                            for ($g = 1; $g <= 21; $g++) {  
                                                                $grid = 'grid'.$g;
                                                                if ($town_colony_deffence[$grid] == $random_build_snos) {
                                                                    mysql_query("UPDATE `town` SET `".$grid."` = 'null' WHERE `colony_id` = '".$colony_id_defence['colony_id']."' ");
                                                                    mysql_query("DELETE FROM `build` WHERE `build_id` = '".$random_build_snos."' and `colony_id` = '".$colony_id_defence['colony_id']."' ");
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
 
 
                                            $colony_id_defence = mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `colony_id` = '".$army_attaker['colony_id_deff']."' LIMIT 1"));
                                            //вибір другої атаки
                                            if ($army_attaker['type_build_snos2'] != 'no_build' and $army_attaker['soldier8'] >= 20) {
 
 
                                                if ($army_attaker['type_build_snos2'] == 'random') {
                                                    $random_build_snos2 = random_build($colony_id_defence['colony_id']);
                                                }else{
                                                    $random_build_snos2 = $army_attaker['type_build_snos2'];
                                                    if ($colony_id_defence[$random_build_snos2] == 0) {
                                                        $random_build_snos2 = random_build($colony_id_defence['colony_id']);
                                                    }
                                                }
 
                                                if ($random_build_snos2 != 'no_build' and $random_build_snos != $random_build_snos2) {
                                                    $oa = $summ_attak;
                                                    $oz = 1;
 
                                                    $x1 = pow(($oa/$oz), 1.5);
 
                                                    if ($x1 >= 1) {
                                                        $x1 = floor((1-(0.5/$x1)) * 100);
                                                    }else{
                                                        $x1 = floor(($x1 / 2) * 100);
                                                    }                                            
 
                                                    $kat = $army_attaker['soldier8'];
 
                                                    $kat = floor(($kat * $x1) / 100); 
 
                                                    if ($army_attaker['type_build_snos'] != 'no_build' and $army_attaker['type_build_snos2'] != 'no_build') {
                                                        $kat = floor($kat / 2);
                                                    }
 
                                                    $lvl_build_destroi_kat = [2,2,2,3,4,6,8,10,12,14,17,20,23,27,31,35,39,43,48,53];
 
                                                    if ($colony_id_defence['kamenetes'] > 0) {
                                                        $lvl_kamenetes = mysql_fetch_assoc(mysql_query("SELECT * FROM `kamenetes` WHERE `id` = '".$colony_id_defence['kamenetes']."' LIMIT 1"));
                                                        foreach ($lvl_build_destroi_kat as &$value) {
                                                            $value = round($value * $lvl_kamenetes['lvl_deff']);
                                                        }
                                                    }
 
                                                    $lvl_build = $colony_id_defence[$random_build_snos2];
 
                                                    $id = $lvl_build - 1;
                                                    $test = $lvl_build_destroi_kat[$id] - $kat;
 
                                                    $kol_snosy = 0;
 
                                                    if ($kat >= $lvl_build_destroi_kat[$id]){
                                                        $kol_snosy = 0;
                                                    }else{
                                                        if ($kat >= $lvl_build_destroi_kat[$id]){ 
                                                            $kol_snosy = 0;
                                                        }else{
                                                            for ($l = 0; $l <= $id; $l++) { 
                                                                if ($lvl_build_destroi_kat[$l] >= $test) {
                                                                    $kol_snosy = $l+1;
                                                                    break;
                                                                }
                                                            }
                                                        }
                                                    } 
 
 
                                                    $snos_build_riven2 = $lvl_build - $kol_snosy;
 
                                                    if ($snos_build_riven2 == $lvl_build) {
                                                        $snos_build_riven2 = $lvl_build;
                                                        $snos_build_ostatok2 = 0;
                                                    }else{
                                                        $snos_build_ostatok2 = $kol_snosy;
                                                    }
 
                                                    $ostatok_lvl = $colony_id_defence[$random_build_snos2] - $snos_build_riven2;
                                                    if ($snos_build_riven2 > 0) {
                                                        if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15' || $random_build_snos2 == 'ferma16' || $random_build_snos2 == 'ferma17' || $random_build_snos2 == 'ferma18') {
                                                                if($plemy_defender['type'] == 1 ) {
                                                                    if ($random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 2 ) {
                                                                    if ($random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15' || $random_build_snos2 == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 3 ) {
                                                                    if ($random_build_snos2 == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 4 ) {
                                                                    if ($random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16' || $random_build_snos2 == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 5 ) {
                                                                    if ($random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                                if($plemy_defender['type'] == 6 ) {
                                                                    if ($random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16') {
                                                                        $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma17') {
                                                                        $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                    }
                                                                    if ($random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                        $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                            }else{
                                                                if ($random_build_snos2 == 'sklad2' || $random_build_snos2 == 'sklad4' || $random_build_snos2 == 'sklad5' || $random_build_snos2 == 'sklad6' || $random_build_snos2 == 'sklad6' || $random_build_snos2 == 'sklad7' || $random_build_snos2 == 'sklad8' || $random_build_snos2 == 'sklad9' || $random_build_snos2 == 'sklad10') {
                                                                    $table_snos = mysql_query("SELECT * FROM `sklad` ORDER BY `id` DESC");
                                                                }else{
                                                                    if ($random_build_snos2 == 'ambar2' || $random_build_snos2 == 'ambar3' || $random_build_snos2 == 'ambar4' || $random_build_snos2 == 'ambar5' || $random_build_snos2 == 'ambar6' || $random_build_snos2 == 'ambar7' || $random_build_snos2 == 'ambar8' || $random_build_snos2 == 'ambar9' || $random_build_snos2 == 'ambar10') {
                                                                        $table_snos = mysql_query("SELECT * FROM `ambar` ORDER BY `id` DESC");
                                                                    }else{
                                                                        if ($random_build_snos2 == 'tainik2' || $random_build_snos2 == 'tainik3' || $random_build_snos2 == 'tainik4' || $random_build_snos2 == 'tainik5' || $random_build_snos2 == 'tainik6' || $random_build_snos2 == 'tainik7' || $random_build_snos2 == 'tainik8' || $random_build_snos2 == 'tainik9' || $random_build_snos2 == 'tainik10' || $random_build_snos2 == 'tainik11' || $random_build_snos2 == 'tainik12' || $random_build_snos2 == 'tainik13' || $random_build_snos2 == 'tainik14' || $random_build_snos2 == 'tainik15' || $random_build_snos2 == 'tainik16' || $random_build_snos2 == 'tainik17' || $random_build_snos2 == 'tainik18') {
                                                                            $table_snos = mysql_query("SELECT * FROM `tainik` ORDER BY `id` DESC");
                                                                        }else{
                                                                            $table_snos = mysql_query("SELECT * FROM `".$random_build_snos2."` ORDER BY `id` DESC");
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        $lvl_city = 0;
                                                        while($row1 = mysql_fetch_array($table_snos)){
                                                            if ($row1['id'] >= $ostatok_lvl & $row1['id'] <= $colony_id_defence[$random_build_snos2]) {
                                                                $lvl_city += $row1['city_people'];
                                                            }
                                                        }
                                                        $people = $colony_id_defence['city_people'] - $lvl_city;
                                                        mysql_query("UPDATE `colony` SET `".$random_build_snos2."` = '".$snos_build_ostatok2."', `city_people` = '".$people."' WHERE `colony_id` = '".$colony_id_defence['colony_id']."' ");
 
                                                        $town_colony_deffence =  mysql_fetch_assoc(mysql_query("SELECT * FROM `town` WHERE `colony_id` = '".$colony_id_defence['colony_id']."' LIMIT 1"));
                                                        if ($snos_build_ostatok1 == 0 & $random_build_snos2 != 'ferma1' & $random_build_snos2 != 'ferma2' & $random_build_snos2 != 'ferma3' & $random_build_snos2 != 'ferma4' & $random_build_snos2 != 'ferma5' & $random_build_snos2 != 'ferma6' & $random_build_snos2 != 'ferma7'  & $random_build_snos2 != 'ferma8' & $random_build_snos2 != 'ferma9' & $random_build_snos2 != 'ferma10' & $random_build_snos2 != 'ferma11' & $random_build_snos2 != 'ferma12' & $random_build_snos2 != 'ferma13' & $random_build_snos2 != 'ferma14' & $random_build_snos2 != 'ferma15' & $random_build_snos2 != 'ferma16' & $random_build_snos2 != 'ferma17' & $random_build_snos2 != 'ferma18') {
                                                            for ($g = 1; $g <= 21; $g++) {  
                                                                $grid = 'grid'.$g;
                                                                if ($town_colony_deffence[$grid] == $random_build_snos2) {
                                                                    mysql_query("UPDATE `town` SET `".$grid."` = 'null' WHERE `colony_id` = '".$colony_id_defence['colony_id']."' ");
                                                                    mysql_query("DELETE FROM `build` WHERE `build_id` = '".$random_build_snos."' and `colony_id` = '".$colony_id_defence['colony_id']."' ");
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
 
                                            $alive_soldier_attak8 = $army_attaker['soldier8'] - $alive_soldier_attak;
                                            $dead_soldier_attack8 = $alive_soldier_attak;
                                            $Loss_army_polk = $Loss_army_polk + $dead_soldier_attack8;
                                            $dead_army_attaker += $alive_soldier_attak;
                                        }else{
                                            $alive_soldier_attak8 = $army_attaker['soldier8'] - $alive_soldier_attak;
                                            $dead_soldier_attack8 = $alive_soldier_attak;
                                            $Loss_army_polk = $Loss_army_polk + $dead_soldier_attack8;
                                            $dead_army_attaker += $alive_soldier_attak;
                                        }
                                    }
                                    if ($i == 9) {
                                        $alive_soldier_attak9 = $army_attaker['soldier9'] - $alive_soldier_attak;
                                        $dead_soldier_attack9 = $alive_soldier_attak;
                                        $Loss_army_polk = $Loss_army_polk + $dead_soldier_attack9;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                    if ($i == 10) {
                                        $alive_soldier_attak10 = $army_attaker['soldier10'] - $alive_soldier_attak;
                                        $dead_soldier_attack10 = $alive_soldier_attak;
                                        $Loss_army_polk = $Loss_army_polk + $dead_soldier_attack10;
                                        $dead_army_attaker += $alive_soldier_attak;
                                    }
                                }
                            }
                            if ($plemy_attaker['plemy'] == 1) {
                                $units_type = 'units_rus';
                            }
                            if ($plemy_attaker['plemy'] == 2) {
                                $units_type = 'units_ua';
                            }
                            if ($plemy_attaker['plemy'] == 3) {
                                $units_type = 'units_pl';
                            }
                            $units_speed = 10;
                            if ($alive_soldier_attak1 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '1' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak1 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak2 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '2' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak2 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak3 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '3' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak3 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak4 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '4' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak4 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak5 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '5' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak5 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak6 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '6' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak6 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak7 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '7' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak7 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak8 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '8' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak8 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak9 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '9' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak9 * $units['can_get_ressours'];
                            }
                            if ($alive_soldier_attak10 != 0) {
                                $units = mysql_fetch_assoc(mysql_query("SELECT * FROM `".$units_type."` WHERE `id` = '10' LIMIT 1"));
                                if ($units_speed > $units['speed']) {
                                    $units_speed = $units['speed'];
                                }
                                $max_size += $alive_soldier_attak10 * $units['can_get_ressours'];
                            }
 
 
 
                            $arena_colony = mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `colony_id` = '".$army_attaker['colony_id']."' LIMIT 1"));
                            //$arena = mysql_fetch_assoc(mysql_query("SELECT * FROM `arena` WHERE `id` = '".$arena_colony['arena']."' LIMIT 1"));
                                //if ($arena['hz'] > 0) {
                                 //   $units_speed = $units_speed * $arena['hz'];
                               // }
                                $chek_bonus_polkan = mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$plemy_attaker['login']."' LIMIT 1")); 
                                if($chek_bonus_polkan['speed_polkan'] > 0 ) {
                                    $units_speed += $units_speed *  ($chek_bonus_polkan['speed_polkan'] / 100);
                             }
                                if ($user_army_bonus['bonus_10_speed'] == '+') {
                                    $units_speed += $units_speed * 0.1;
                                }
                            $time_m = time_move($plemy_attaker['x'],$plemy_attaker['y'],$plemy_defender['x'],$plemy_defender['y'],$units_speed);
 
 
                            ///////////////////////////////////////////////
                            //Вираховування скільки зміг награбувати
                            ///////////////////////////////////////////////
                            //максимально може нести
                            $all_vizme = $max_size;
 
                            //рахувати тайник
                            if ($colony_id_defence['derevo'] > $tainik) {
                                $d = $colony_id_defence['derevo'] - $tainik;
                            }else{
                                $d = 0;
                            }
                            if ($colony_id_defence['glina'] > $tainik) {
                                $g = $colony_id_defence['glina'] - $tainik;
                            }else{
                                $g = 0;
                            }
                            if ($colony_id_defence['jelezo'] > $tainik) {
                                $j = $colony_id_defence['jelezo'] - $tainik;
                            }else{
                                $j = 0;
                            }
                            if ($colony_id_defence['zerno'] > $tainik) {
                                $z = $colony_id_defence['zerno'] - $tainik;
                            }else{
                                $z = 0;
                            }
 
                            $all_ress_user = $d + $g + $j + $z;
                            if ($all_vizme >= $all_ress_user) {
 
                                $vzjav_derevo = $d;
                                $vzjav_glina = $g;
                                $vzjav_jelezo = $j;
                                $vzjav_zerno = $z;
                                $robberies_stats_week = $vzjav_derevo + $vzjav_glina + $vzjav_jelezo + $vzjav_zerno;
                                $ostatok_derevo = $colony_id_defence['derevo'] - $d;
                                $ostatok_glina = $colony_id_defence['glina'] - $g;
                                $ostatok_jeleza = $colony_id_defence['jelezo'] - $j;
                                $ostatok_zerno = $colony_id_defence['zerno'] - $z;
                                $d = 0;
                                $g = 0;
                                $j = 0;
                                $z = 0;
                                //занести в mysql атаки ресурси що вкрав
                                //Добавити в повернення атаки дерево глиу ресурси
                                //update ressours user in table colony
                            }else{
                                if ($all_vizme < $all_ress_user) {
                                    $derevo_i[0] = $d;
                                    $glina_i[1] = $g;
                                    $jelezo_i[2] = $j;
                                    $zerno_i[3] = $z;
 
                                    $one_unit_ress_vizme = floor($all_vizme / 4);
 
                                    $min1 = min($derevo_i[0],$glina_i[1],$jelezo_i[2],$zerno_i[3]);
 
                                    $i = 0;
                                    while($i < 1){
                                        if ($d == $min1) {
                                            //echo 'Дерево '.$d;
                                            if ($one_unit_ress_vizme <= $d) {
                                                $vzjav_derevo = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $d;
                                                $vzjav_derevo = $d;
                                                $vzjav = $d;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 3);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            $min2 = min($glina_i[1],$jelezo_i[2],$zerno_i[3]);
                                        }
                                        if ($g == $min1) {
                                            //echo 'Глина '.$g;
                                            if ($one_unit_ress_vizme <= $g) {
                                                $vzjav_glina = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $g;
                                                $vzjav_glina = $g;
                                                $vzjav = $g;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 3);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            $min2 = min($derevo_i[0],$jelezo_i[2],$zerno_i[3]);
                                        }
                                        if ($j == $min1) {
                                            //echo 'Железо '.$j;
                                            if ($one_unit_ress_vizme <= $j) {
                                                $vzjav_jelezo = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $j;
                                                $vzjav_jelezo = $j;
                                                $vzjav = $j;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 3);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            $min2 = min($derevo_i[0],$glina_i[1],$zerno_i[3]);
                                        }
                                        if ($z == $min1) {
                                            //echo 'Зерно '.$z;
                                            if ($one_unit_ress_vizme <= $z) {
                                                $vzjav_zerno = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $z;
                                                $vzjav_zerno = $z;
                                                $vzjav = $z;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 3);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            $min2 = min($derevo_i[0],$glina_i[1],$jelezo_i[2]);
                                        }
                                        $i++;
                                    }
 
                                    $i = 0;
                                    while($i < 1){
                                        if ($d == $min2) {
                                            //echo 'Дерево '.$d;
                                            if ($one_unit_ress_vizme <= $d) {
                                                $vzjav_derevo = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $d;
                                                $vzjav_derevo = $d;
                                                $vzjav2 = $d;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 2);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($g == $min1) {
                                                $min3 = min($jelezo_i[2],$zerno_i[3]);
                                            }
                                            if ($j == $min1) {
                                                $min3 = min($glina_i[1],$zerno_i[3]);
                                            }
                                            if ($z == $min1) {
                                                $min3 = min($glina_i[1],$jelezo_i[2]);
                                            }
                                        }
                                        if ($g == $min2) {
                                            //echo 'Глина '.$g;
                                            if ($one_unit_ress_vizme <= $g) {
                                                $vzjav_glina = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $g;
                                                $vzjav_glina = $g;
                                                $vzjav2 = $g;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 2);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($d == $min1) {
                                                $min3 = min($jelezo_i[2],$zerno_i[3]);
                                            }
                                            if ($j == $min1) {
                                                $min3 = min($derevo_i[0],$zerno_i[3]);
                                            }
                                            if ($z == $min1) {
                                                $min3 = min($derevo_i[0],$jelezo_i[2]);
                                            }
 
                                        }
                                        if ($j == $min2) {
                                            //echo 'Железо '.$j;
                                            if ($one_unit_ress_vizme <= $j) {
                                                $vzjav_jelezo = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $j;
                                                $vzjav_jelezo = $j;
                                                $vzjav2 = $j;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 2);
                                            }
                                            if ($d == $min1) {
                                                $min3 = min($glina_i[1],$zerno_i[3]);
                                            }
                                            if ($g == $min1) {
                                                $min3 = min($derevo_i[0],$zerno_i[3]);
                                            }
                                            if ($z == $min1) {
                                                $min3 = min($derevo_i[0],$glina_i[1]);
                                            }
                                        }
                                        if ($z == $min2) {
                                            //echo 'Зерно '.$z;
                                            if ($one_unit_ress_vizme <= $z) {
                                                $vzjav_zerno = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $z;
                                                $vzjav_zerno = $z;
                                                $vzjav2 = $z;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) / 2);
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($d == $min1) {
                                                $min3 = min($glina_i[1],$jelezo_i[2]);
                                            }
                                            if ($g == $min1) {
                                                $min3 = min($derevo_i[0],$jelezo_i[2]);
                                            }
                                            if ($j == $min1) {
                                                $min3 = min($derevo_i[0],$glina_i[1]);
                                            }
                                        }
                                        $i++;
                                    }
 
                                    $i = 0;
                                    while($i < 1){
                                        if ($d == $min3) {
                                            //echo 'Дерево '.$d;
                                            if ($one_unit_ress_vizme <= $d) {
                                                $vzjav_derevo = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $d;
                                                $vzjav_derevo = $d;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $vzjav2 - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($g == $min1) {
                                                $min4 = max($jelezo_i[2],$zerno_i[3]);
                                            }
                                            if ($j == $min1) {
                                                $min4 = max($glina_i[1],$zerno_i[3]);
                                            }
                                            if ($z == $min1) {
                                                $min4 = max($glina_i[1],$jelezo_i[2]);
                                            }
                                        }
                                        if ($g == $min3) {
                                            //echo 'Глина '.$g;
                                            if ($one_unit_ress_vizme <= $g) {
                                                $vzjav_glina = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $g;
                                                $vzjav_glina = $g;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $vzjav2 - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($d == $min1) {
                                                $min4 = max($jelezo_i[2],$zerno_i[3]);
                                            }
                                            if ($j == $min1) {
                                                $min4 = max($derevo_i[0],$zerno_i[3]);
                                            }
                                            if ($z == $min1) {
                                                $min4 = max($derevo_i[0],$jelezo_i[2]);
                                            }
 
                                        }
                                        if ($j == $min3) {
                                            //echo 'Железо '.$j;
                                            if ($one_unit_ress_vizme <= $j) {
                                                $vzjav_jelezo = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $j;
                                                $vzjav_jelezo = $j;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $vzjav2 - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($d == $min1) {
                                                $min4 = max($glina_i[1],$zerno_i[3]);
                                            }
                                            if ($g == $min1) {
                                                $min4 = max($derevo_i[0],$zerno_i[3]);
                                            }
                                            if ($z == $min1) {
                                                $min4 = max($derevo_i[0],$glina_i[1]);
                                            }
                                        }
                                        if ($z == $min3) {
                                            //echo 'Зерно '.$z;
                                            if ($one_unit_ress_vizme <= $z) {
                                                $vzjav_zerno = $one_unit_ress_vizme;
                                            }else{
                                                $ostatok_one_unit_vizme = $one_unit_ress_vizme - $z;
                                                $vzjav_zerno = $z;
                                                $one_unit_ress_vizme = floor(( ($all_vizme - $vzjav - $vzjav2 - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                            if ($d == $min1) {
                                                $min4 = max($glina_i[1],$jelezo_i[2]);
                                            }
                                            if ($g == $min1) {
                                                $min4 = max($derevo_i[0],$jelezo_i[2]);
                                            }
                                            if ($j == $min1) {
                                                $min4 = max($derevo_i[0],$glina_i[1]);
                                            }
                                        }
                                        $i++;
                                    }
 
                                    $i = 0;
                                    while($i < 1){
                                        if ($d == $min4) {
                                            //echo 'Дерево '.$d;
                                            if ($one_unit_ress_vizme <= $d) {
                                                $vzjav_derevo = $one_unit_ress_vizme;
                                            }else{
                                                //$ostatok_one_unit_vizme = $one_unit_ress_vizme - $d;
                                                $vzjav_derevo = $d;
                                                //$one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                        }
                                        if ($g == $min4) {
                                            //echo 'Глина '.$g;
                                            if ($one_unit_ress_vizme <= $g) {
                                                $vzjav_glina = $one_unit_ress_vizme;
                                            }else{
                                                //$ostatok_one_unit_vizme = $one_unit_ress_vizme - $g;
                                                $vzjav_glina = $g;
                                                //$one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ));
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                        }
                                        if ($j == $min4) {
                                            //echo 'Железо '.$j;
                                            if ($one_unit_ress_vizme <= $j) {
                                                $vzjav_jelezo = $one_unit_ress_vizme;
                                            }else{
                                                //$ostatok_one_unit_vizme = $one_unit_ress_vizme - $j;
                                                $vzjav_jelezo = $j;
                                                //$one_unit_ress_vizme = floor(( ($all_vizme - $one_unit_ress_vizme)  + $ostatok_one_unit_vizme ) );
                                                //echo 'zzzz '.$one_unit_ress_vizme;
                                            }
                                        }
                                        if ($z == $min4) {
                                            if ($one_unit_ress_vizme <= $z) {
                                                $vzjav_zerno = $one_unit_ress_vizme;
                                            }else{
                                                $vzjav_zerno = $z;
                                            }
                                        }
                                        $i++;
                                    }
                                    $ostatok_derevo = $d - $vzjav_derevo;
                                    $ostatok_glina = $g - $vzjav_glina;
                                    $ostatok_jeleza = $j - $vzjav_jelezo;
                                    $ostatok_zerno = $z - $vzjav_zerno;
                                    $robberies_stats_week = $vzjav_derevo + $vzjav_glina + $vzjav_jelezo + $vzjav_zerno;
                                }
                            }
 
 
 
 
 
                            //$rand_id_attack = rand(111,999999);
                            do {
                              $rand_id_attack = rand(111,9999999);
                              $result = mysql_query("SELECT * FROM `reports` WHERE `attack_id` = '".$rand_id_attack."' LIMIT 1");
                              $rand_atk = mysql_fetch_assoc($result);
                              if ($rand_atk['attack_id'] == $rand_id_attack) {
                                continue; // якщо знайдено збіг, продовжуйте цикл
                              } else {
                                break; // якщо збіг не знайдено, припиніть цикл
                              }
                            } while (true); // безмежний цикл, який треба припинити за допомогою break
                            mysql_query("INSERT INTO `reports`(`attack_id`,`user_attack`,`user_deff`,`colony_id_attack`,`colony_id_deff`,`plemy_attack`,`plemy_deff`,`off_1_unit`,`off_2_unit`,`off_3_unit`,`off_4_unit`,`off_5_unit`,`off_6_unit`,`off_7_unit`,`off_8_unit`,`off_9_unit`,`off_10_unit`,`off_1_result`,`off_2_result`,`off_3_result`,`off_4_result`,`off_5_result`,`off_6_result`,`off_7_result`,`off_8_result`,`off_9_result`,`off_10_result`,`time_attack`,`type_attack`,`max_size`,`derevo`,`glina`,`jelezo`,`zerno`,`lvl_build_destroi`,`lvl_build_ostatok`,`name_build_destroi`,`lvl_build_destroi2`,`lvl_build_ostatok2`,`name_build_destroi2`,`stena_start`,`stena_stop`) VALUES ('".$rand_id_attack."', '".$army_attaker['login']."', '".$colony_id_defence['login']."','".$army_attaker['colony_id']."','".$army_attaker['colony_id_deff']."','".$plemy_attaker['plemy']."','".$plemy_defender['plemy']."','".$army_attaker['soldier1']."','".$army_attaker['soldier2']."','".$army_attaker['soldier3']."','".$army_attaker['soldier4']."','".$army_attaker['soldier5']."','".$army_attaker['soldier6']."','".$army_attaker['soldier7']."','".$army_attaker['soldier8']."','".$army_attaker['soldier9']."','".$army_attaker['soldier10']."','".$dead_soldier_attack1."','".$dead_soldier_attack2."','".$dead_soldier_attack3."','".$dead_soldier_attack4."','".$dead_soldier_attack5."','".$dead_soldier_attack6."','".$dead_soldier_attack7."','".$dead_soldier_attack8."','".$dead_soldier_attack9."','".$dead_soldier_attack10."','".$army_attaker['last_time']."','".$army_attaker['type_attack']."','".$max_size."','".$vzjav_derevo."','".$vzjav_glina."','".$vzjav_jelezo."','".$vzjav_zerno."','".$snos_build_riven."','".$snos_build_ostatok."','".$random_build_snos."','".$snos_build_riven2."','".$snos_build_ostatok2."','".$random_build_snos2."','".$snos_stena_riven."','".$snos_stena_ostatok."') ");
 
 
                            $type_plemy = mysql_fetch_assoc(mysql_query("SELECT * FROM `map` WHERE `colony_id` = '".$army_attaker['colony_id_deff']."' LIMIT 1"));
                            if($type_plemy['plemy'] == 1 ) $type_plemy_atk = 'units_rus';
                            if($type_plemy['plemy'] == 2 ) $type_plemy_atk = 'units_ua';
                            if($type_plemy['plemy'] == 3 ) $type_plemy_atk = 'units_pl';
 
                            for ($i=1; $i <= 10; $i++) { 
                                $alive_soldier_deff = round($deff*$colony_id_defence['soldier'.$i]);
                                if ($i == 1) {
                                    $alive_soldier_deff1 = $colony_id_defence['soldier'.$i] * $alive_soldier_deff;
                                    $dead_soldier_def_1 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_1;
                                    $kill_army_stats_week += $colony_id_defence['soldier'.$i];
                                }
                                if ($i == 2) {
                                    $alive_soldier_deff2 = $colony_id_defence['soldier'.$i] * $alive_soldier_deff;
                                    $dead_soldier_def_2 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_2;
                                    $kill_army_stats_week += $colony_id_defence['soldier'.$i];
                                }
                                if ($i == 3) {
                                    $alive_soldier_deff3 = $colony_id_defence['soldier'.$i] * $alive_soldier_deff;
                                    $dead_soldier_def_3 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_3;
                                    $kill_army_stats_week += $colony_id_defence['soldier'.$i];
                                }
                                if ($i == 4) {
                                    $alive_soldier_deff4 = $colony_id_defence['soldier'.$i] * $alive_soldier_deff;
                                    $dead_soldier_def_4 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_4;
                                    $kill_army_stats_week += $colony_id_defence['soldier'.$i];
                                }
                                if ($i == 5) {
                                    $alive_soldier_deff5 = $colony_id_defence['soldier'.$i] * $alive_soldier_deff;
                                    $dead_soldier_def_5 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_5;
                                    $kill_army_stats_week += $colony_id_defence['soldier'.$i];
                                }
                                if ($i == 6) {
                                    $alive_soldier_deff6 = $colony_id_defence['soldier'.$i] * $alive_soldier_deff;
                                    $dead_soldier_def_6 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_6;
                                    $kill_army_stats_week += $colony_id_defence['soldier'.$i];
                                }
                                if ($i == 7) {
                                    $alive_soldier_deff7 = $colony_id_defence['soldier'.$i] * $alive_soldier_deff;
                                    $dead_soldier_def_7 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_7;
                                    $kill_army_stats_week += $colony_id_defence['soldier'.$i];
                                }
                                if ($i == 8) {
                                    $alive_soldier_deff8 = $colony_id_defence['soldier'.$i] * $alive_soldier_deff;
                                    $dead_soldier_def_8 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_8;
                                    $kill_army_stats_week += $colony_id_defence['soldier'.$i];
                                }
                                if ($i == 9) {
                                    $alive_soldier_deff9 = $colony_id_defence['soldier'.$i] * $alive_soldier_deff;
                                    $dead_soldier_def_9 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_9;
                                    $kill_army_stats_week += $colony_id_defence['soldier'.$i];
                                }
                                if ($i == 10) {
                                    $alive_soldier_deff10 = $colony_id_defence['soldier'.$i] * $alive_soldier_deff;
                                    $dead_soldier_def_10 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_10;
                                    $kill_army_stats_week += $colony_id_defence['soldier'.$i];
                                }
 
                            }
 
                             mysql_query("UPDATE `colony` SET 
                                        `soldier1` = '".$alive_soldier_deff1."', 
                                        `soldier2` = '".$alive_soldier_deff2."', 
                                        `soldier3` = '".$alive_soldier_deff3."', 
                                        `soldier4` = '".$alive_soldier_deff4."', 
                                        `soldier5` = '".$alive_soldier_deff5."', 
                                        `soldier6` = '".$alive_soldier_deff6."', 
                                        `soldier7` = '".$alive_soldier_deff7."', 
                                        `soldier8` = '".$alive_soldier_deff8."', 
                                        `soldier9` = '".$alive_soldier_deff9."', 
                                        `soldier10` = '".$alive_soldier_deff10."',
                                        `derevo` = '".$ostatok_derevo."',
                                        `glina` = '".$ostatok_glina."',
                                        `jelezo` = '".$ostatok_jeleza."',
                                        `zerno` = '".$ostatok_zerno."'
                                        WHERE 
                                        `colony_id` = '".$army_attaker['colony_id_deff']."' ");
 
                             if ($type_plemy['plemy'] == 1) {
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_ru_1` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_ru_2` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_ru_3` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_ru_4` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_ru_5` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_ru_6` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_ru_7` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_ru_8` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_ru_9` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_ru_10` = '".$colony_id_defence['soldier10']."',
                                        `deff_unit_podkrep_ru_1_res` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_ru_2_res` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_ru_3_res` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_ru_4_res` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_ru_5_res` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_ru_6_res` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_ru_7_res` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_ru_8_res` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_ru_9_res` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_ru_10_res` = '".$colony_id_defence['soldier10']."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                             }
                             if ($type_plemy['plemy'] == 2) {
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_ua_1` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_ua_2` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_ua_3` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_ua_4` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_ua_5` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_ua_6` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_ua_7` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_ua_8` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_ua_9` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_ua_10` = '".$colony_id_defence['soldier10']."',
                                        `deff_unit_podkrep_ua_1_res` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_ua_2_res` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_ua_3_res` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_ua_4_res` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_ua_5_res` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_ua_6_res` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_ua_7_res` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_ua_8_res` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_ua_9_res` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_ua_10_res` = '".$colony_id_defence['soldier10']."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                             }
                             if ($type_plemy['plemy'] == 3) {
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_pl_1` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_pl_2` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_pl_3` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_pl_4` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_pl_5` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_pl_6` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_pl_7` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_pl_8` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_pl_9` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_pl_10` = '".$colony_id_defence['soldier10']."',
                                        `deff_unit_podkrep_pl_1_res` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_pl_2_res` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_pl_3_res` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_pl_4_res` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_pl_5_res` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_pl_6_res` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_pl_7_res` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_pl_8_res` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_pl_9_res` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_pl_10_res` = '".$colony_id_defence['soldier10']."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                             }
 
 
                            $res1 = mysql_query("SELECT * FROM `podkrep` WHERE `colony_id_deff` = '".$army_attaker['colony_id_deff']."' ");                       
                            while($row = mysql_fetch_array($res1)) {
                                for ($i = 1; $i <= 10; $i++) {
                                    $alive_soldier_deff_podkrep = round($deff*$row['soldier'.$i]);
 
                                    if ($i == 1) {
                                        $alive_soldier_deff_podkrep1 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep1 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep1;
                                        $kill_army_stats_week += $row['soldier'.$i];
                                    }
                                    if ($i == 2) {
                                        $alive_soldier_deff_podkrep2 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep2 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep2;
                                        $kill_army_stats_week += $row['soldier'.$i];
                                    }
                                    if ($i == 3) {
                                        $alive_soldier_deff_podkrep3 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep3 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep3;
                                        $kill_army_stats_week += $row['soldier'.$i];
                                    }
                                    if ($i == 4) {
                                        $alive_soldier_deff_podkrep4 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep4 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep4;
                                        $kill_army_stats_week += $row['soldier'.$i];
                                    }
                                    if ($i == 5) {
                                        $alive_soldier_deff_podkrep5 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep5 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep5;
                                        $kill_army_stats_week += $row['soldier'.$i];
                                    }
                                    if ($i == 6) {
                                        $alive_soldier_deff_podkrep6 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep6 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep6;
                                        $kill_army_stats_week += $row['soldier'.$i];
                                    }
                                    if ($i == 7) {
                                        $alive_soldier_deff_podkrep7 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep7 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep7;
                                        $kill_army_stats_week += $row['soldier'.$i];
                                    }
                                    if ($i == 8) {
                                        $alive_soldier_deff_podkrep8 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep8 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep8;
                                        $kill_army_stats_week += $row['soldier'.$i];
                                    }
                                    if ($i == 9) {
                                        $alive_soldier_deff_podkrep9 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep9 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep9;
                                        $kill_army_stats_week += $row['soldier'.$i];
                                    }
                                    if ($i == 10) {
                                        $alive_soldier_deff_podkrep10 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep10 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep10;
                                        $kill_army_stats_week += $row['soldier'.$i];
                                    }
                                }
                                $podkrep_all = mysql_fetch_assoc(mysql_query("SELECT * FROM `reports` WHERE `attack_id` = '".$rand_id_attack."' LIMIT 1"));
 
                                do {
                                  $rand_id_attack22 = rand(111,9999999);
                                  $result22 = mysql_query("SELECT * FROM `reports` WHERE `attack_id` = '".$rand_id_attack22."' LIMIT 1");
                                  $rand_atk22 = mysql_fetch_assoc($result22);
                                  if ($rand_atk22['attack_id'] == $rand_id_attack22) {
                                    continue; // якщо знайдено збіг, продовжуйте цикл
                                  } else {
                                    break; // якщо збіг не знайдено, припиніть цикл
                                  }
                                } while (true);
 
                                podkrep_out($rand_id_attack22,$type_plemy['login'],$row['colony_id_send'],$row['colony_id_deff'],time(),$row['soldier1'],$row['soldier2'],$row['soldier3'],$row['soldier4'],$row['soldier5'],$row['soldier6'],$row['soldier7'],$row['soldier8'],$row['soldier9'],$row['soldier10'],$row['soldier1'],$row['soldier2'],$row['soldier3'],$row['soldier4'],$row['soldier5'],$row['soldier6'],$row['soldier7'],$row['soldier8'],$row['soldier9'],$row['soldier10'],$row['login']);
 
 
                                if ($row['plemy'] == 1) {
                                    $deff_ru_1 = $podkrep_all['deff_unit_podkrep_ru_1'] + $row['soldier1'];
                                    $deff_ru_2 = $podkrep_all['deff_unit_podkrep_ru_2'] + $row['soldier2'];
                                    $deff_ru_3 = $podkrep_all['deff_unit_podkrep_ru_3'] + $row['soldier3'];
                                    $deff_ru_4 = $podkrep_all['deff_unit_podkrep_ru_4'] + $row['soldier4'];
                                    $deff_ru_5 = $podkrep_all['deff_unit_podkrep_ru_5'] + $row['soldier5'];
                                    $deff_ru_6 = $podkrep_all['deff_unit_podkrep_ru_6'] + $row['soldier6'];
                                    $deff_ru_7 = $podkrep_all['deff_unit_podkrep_ru_7'] + $row['soldier7'];
                                    $deff_ru_8 = $podkrep_all['deff_unit_podkrep_ru_8'] + $row['soldier8'];
                                    $deff_ru_9 = $podkrep_all['deff_unit_podkrep_ru_9'] + $row['soldier9'];
                                    $deff_ru_10 = $podkrep_all['deff_unit_podkrep_ru_10'] + $row['soldier10'];
                                    $dead_podkrep1 = $podkrep_all['deff_unit_podkrep_ru_1_res'] + $dead_podkrep1;
                                    $dead_podkrep2 = $podkrep_all['deff_unit_podkrep_ru_2_res'] + $dead_podkrep2;
                                    $dead_podkrep3 = $podkrep_all['deff_unit_podkrep_ru_3_res'] + $dead_podkrep3;
                                    $dead_podkrep4 = $podkrep_all['deff_unit_podkrep_ru_4_res'] + $dead_podkrep4;
                                    $dead_podkrep5 = $podkrep_all['deff_unit_podkrep_ru_5_res'] + $dead_podkrep5;
                                    $dead_podkrep6 = $podkrep_all['deff_unit_podkrep_ru_6_res'] + $dead_podkrep6;
                                    $dead_podkrep7 = $podkrep_all['deff_unit_podkrep_ru_7_res'] + $dead_podkrep7;
                                    $dead_podkrep8 = $podkrep_all['deff_unit_podkrep_ru_8_res'] + $dead_podkrep8;
                                    $dead_podkrep9 = $podkrep_all['deff_unit_podkrep_ru_9_res'] + $dead_podkrep9;
                                    $dead_podkrep10 = $podkrep_all['deff_unit_podkrep_ru_10_res'] + $dead_podkrep10;
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_ru_1` = '".$deff_ru_1."', 
                                        `deff_unit_podkrep_ru_2` = '".$deff_ru_2."', 
                                        `deff_unit_podkrep_ru_3` = '".$deff_ru_3."', 
                                        `deff_unit_podkrep_ru_4` = '".$deff_ru_4."', 
                                        `deff_unit_podkrep_ru_5` = '".$deff_ru_5."', 
                                        `deff_unit_podkrep_ru_6` = '".$deff_ru_6."', 
                                        `deff_unit_podkrep_ru_7` = '".$deff_ru_7."', 
                                        `deff_unit_podkrep_ru_8` = '".$deff_ru_8."', 
                                        `deff_unit_podkrep_ru_9` = '".$deff_ru_9."', 
                                        `deff_unit_podkrep_ru_10` = '".$deff_ru_10."',
                                        `deff_unit_podkrep_ru_1_res` = '".$deff_ru_1."', 
                                        `deff_unit_podkrep_ru_2_res` = '".$deff_ru_2."', 
                                        `deff_unit_podkrep_ru_3_res` = '".$deff_ru_3."', 
                                        `deff_unit_podkrep_ru_4_res` = '".$deff_ru_4."', 
                                        `deff_unit_podkrep_ru_5_res` = '".$deff_ru_5."', 
                                        `deff_unit_podkrep_ru_6_res` = '".$deff_ru_6."', 
                                        `deff_unit_podkrep_ru_7_res` = '".$deff_ru_7."', 
                                        `deff_unit_podkrep_ru_8_res` = '".$deff_ru_8."', 
                                        `deff_unit_podkrep_ru_9_res` = '".$deff_ru_9."', 
                                        `deff_unit_podkrep_ru_10_res` = '".$deff_ru_10."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                                 mysql_query("DELETE FROM `podkrep` WHERE `id` = '".$row['id']."' ");
                                }
                                if ($row['plemy'] == 2) {
                                    $deff_ua_1 = $podkrep_all['deff_unit_podkrep_ua_1'] + $row['soldier1'];
                                    $deff_ua_2 = $podkrep_all['deff_unit_podkrep_ua_2'] + $row['soldier2'];
                                    $deff_ua_3 = $podkrep_all['deff_unit_podkrep_ua_3'] + $row['soldier3'];
                                    $deff_ua_4 = $podkrep_all['deff_unit_podkrep_ua_4'] + $row['soldier4'];
                                    $deff_ua_5 = $podkrep_all['deff_unit_podkrep_ua_5'] + $row['soldier5'];
                                    $deff_ua_6 = $podkrep_all['deff_unit_podkrep_ua_6'] + $row['soldier6'];
                                    $deff_ua_7 = $podkrep_all['deff_unit_podkrep_ua_7'] + $row['soldier7'];
                                    $deff_ua_8 = $podkrep_all['deff_unit_podkrep_ua_8'] + $row['soldier8'];
                                    $deff_ua_9 = $podkrep_all['deff_unit_podkrep_ua_9'] + $row['soldier9'];
                                    $deff_ua_10 = $podkrep_all['deff_unit_podkrep_ua_10'] + $row['soldier10'];
                                    $dead_podkrep1 = $podkrep_all['deff_unit_podkrep_ua_1_res'] + $dead_podkrep1;
                                    $dead_podkrep2 = $podkrep_all['deff_unit_podkrep_ua_2_res'] + $dead_podkrep2;
                                    $dead_podkrep3 = $podkrep_all['deff_unit_podkrep_ua_3_res'] + $dead_podkrep3;
                                    $dead_podkrep4 = $podkrep_all['deff_unit_podkrep_ua_4_res'] + $dead_podkrep4;
                                    $dead_podkrep5 = $podkrep_all['deff_unit_podkrep_ua_5_res'] + $dead_podkrep5;
                                    $dead_podkrep6 = $podkrep_all['deff_unit_podkrep_ua_6_res'] + $dead_podkrep6;
                                    $dead_podkrep7 = $podkrep_all['deff_unit_podkrep_ua_7_res'] + $dead_podkrep7;
                                    $dead_podkrep8 = $podkrep_all['deff_unit_podkrep_ua_8_res'] + $dead_podkrep8;
                                    $dead_podkrep9 = $podkrep_all['deff_unit_podkrep_ua_9_res'] + $dead_podkrep9;
                                    $dead_podkrep10 = $podkrep_all['deff_unit_podkrep_ua_10_res'] + $dead_podkrep10;
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_ua_1` = '".$deff_ua_1."', 
                                        `deff_unit_podkrep_ua_2` = '".$deff_ua_2."', 
                                        `deff_unit_podkrep_ua_3` = '".$deff_ua_3."', 
                                        `deff_unit_podkrep_ua_4` = '".$deff_ua_4."', 
                                        `deff_unit_podkrep_ua_5` = '".$deff_ua_5."', 
                                        `deff_unit_podkrep_ua_6` = '".$deff_ua_6."', 
                                        `deff_unit_podkrep_ua_7` = '".$deff_ua_7."', 
                                        `deff_unit_podkrep_ua_8` = '".$deff_ua_8."', 
                                        `deff_unit_podkrep_ua_9` = '".$deff_ua_9."', 
                                        `deff_unit_podkrep_ua_10` = '".$deff_ua_10."',
                                        `deff_unit_podkrep_ua_1_res` = '".$deff_ua_1."', 
                                        `deff_unit_podkrep_ua_2_res` = '".$deff_ua_2."', 
                                        `deff_unit_podkrep_ua_3_res` = '".$deff_ua_3."', 
                                        `deff_unit_podkrep_ua_4_res` = '".$deff_ua_4."', 
                                        `deff_unit_podkrep_ua_5_res` = '".$deff_ua_5."', 
                                        `deff_unit_podkrep_ua_6_res` = '".$deff_ua_6."', 
                                        `deff_unit_podkrep_ua_7_res` = '".$deff_ua_7."', 
                                        `deff_unit_podkrep_ua_8_res` = '".$deff_ua_8."', 
                                        `deff_unit_podkrep_ua_9_res` = '".$deff_ua_9."', 
                                        `deff_unit_podkrep_ua_10_res` = '".$deff_ua_10."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                                 mysql_query("DELETE FROM `podkrep` WHERE `id` = '".$row['id']."' ");
                                }
                                if ($row['plemy'] == 3) {
                                    $deff_pl_1 = $podkrep_all['deff_unit_podkrep_pl_1'] + $row['soldier1'];
                                    $deff_pl_2 = $podkrep_all['deff_unit_podkrep_pl_2'] + $row['soldier2'];
                                    $deff_pl_3 = $podkrep_all['deff_unit_podkrep_pl_3'] + $row['soldier3'];
                                    $deff_pl_4 = $podkrep_all['deff_unit_podkrep_pl_4'] + $row['soldier4'];
                                    $deff_pl_5 = $podkrep_all['deff_unit_podkrep_pl_5'] + $row['soldier5'];
                                    $deff_pl_6 = $podkrep_all['deff_unit_podkrep_pl_6'] + $row['soldier6'];
                                    $deff_pl_7 = $podkrep_all['deff_unit_podkrep_pl_7'] + $row['soldier7'];
                                    $deff_pl_8 = $podkrep_all['deff_unit_podkrep_pl_8'] + $row['soldier8'];
                                    $deff_pl_9 = $podkrep_all['deff_unit_podkrep_pl_9'] + $row['soldier9'];
                                    $deff_pl_10 = $podkrep_all['deff_unit_podkrep_pl_10'] + $row['soldier10'];
                                    $dead_podkrep1 = $podkrep_all['deff_unit_podkrep_pl_1_res'] + $dead_podkrep1;
                                    $dead_podkrep2 = $podkrep_all['deff_unit_podkrep_pl_2_res'] + $dead_podkrep2;
                                    $dead_podkrep3 = $podkrep_all['deff_unit_podkrep_pl_3_res'] + $dead_podkrep3;
                                    $dead_podkrep4 = $podkrep_all['deff_unit_podkrep_pl_4_res'] + $dead_podkrep4;
                                    $dead_podkrep5 = $podkrep_all['deff_unit_podkrep_pl_5_res'] + $dead_podkrep5;
                                    $dead_podkrep6 = $podkrep_all['deff_unit_podkrep_pl_6_res'] + $dead_podkrep6;
                                    $dead_podkrep7 = $podkrep_all['deff_unit_podkrep_pl_7_res'] + $dead_podkrep7;
                                    $dead_podkrep8 = $podkrep_all['deff_unit_podkrep_pl_8_res'] + $dead_podkrep8;
                                    $dead_podkrep9 = $podkrep_all['deff_unit_podkrep_pl_9_res'] + $dead_podkrep9;
                                    $dead_podkrep10 = $podkrep_all['deff_unit_podkrep_pl_10_res'] + $dead_podkrep10;
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_pl_1` = '".$deff_pl_1."', 
                                        `deff_unit_podkrep_pl_2` = '".$deff_pl_2."', 
                                        `deff_unit_podkrep_pl_3` = '".$deff_pl_3."', 
                                        `deff_unit_podkrep_pl_4` = '".$deff_pl_4."', 
                                        `deff_unit_podkrep_pl_5` = '".$deff_pl_5."', 
                                        `deff_unit_podkrep_pl_6` = '".$deff_pl_6."', 
                                        `deff_unit_podkrep_pl_7` = '".$deff_pl_7."', 
                                        `deff_unit_podkrep_pl_8` = '".$deff_pl_8."', 
                                        `deff_unit_podkrep_pl_9` = '".$deff_pl_9."', 
                                        `deff_unit_podkrep_pl_10` = '".$deff_pl_10."',
                                        `deff_unit_podkrep_pl_1_res` = '".$deff_pl_1."', 
                                        `deff_unit_podkrep_pl_2_res` = '".$deff_pl_2."', 
                                        `deff_unit_podkrep_pl_3_res` = '".$deff_pl_3."', 
                                        `deff_unit_podkrep_pl_4_res` = '".$deff_pl_4."', 
                                        `deff_unit_podkrep_pl_5_res` = '".$deff_pl_5."', 
                                        `deff_unit_podkrep_pl_6_res` = '".$deff_pl_6."', 
                                        `deff_unit_podkrep_pl_7_res` = '".$deff_pl_7."', 
                                        `deff_unit_podkrep_pl_8_res` = '".$deff_pl_8."', 
                                        `deff_unit_podkrep_pl_9_res` = '".$deff_pl_9."', 
                                        `deff_unit_podkrep_pl_10_res` = '".$deff_pl_10."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                                }  
                                mysql_query("DELETE FROM `podkrep` WHERE `id` = '".$row['id']."'");   
                            } 
 
 
                            if ($army_attaker['soldier1'] >= 11 or $army_attaker['soldier2'] >= 11 or $army_attaker['soldier3'] >= 11 or $army_attaker['soldier4'] >= 11 or $army_attaker['soldier5'] >= 11 or $army_attaker['soldier6'] >= 11 or $army_attaker['soldier7'] >= 11 or $army_attaker['soldier8'] >= 11 or $army_attaker['soldier9'] >= 11 or $army_attaker['soldier10'] >= 11) {
 
 
                                $us_polkovodec =  mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$army_attaker['login']."' LIMIT 1"));
                                $war_all = $us_polkovodec['war_all'] + 1;
                                $war_winner = $us_polkovodec['war_winner'] + 1;
                                $Kills_army = $us_polkovodec['Kills_army'] + $kill_army_stats_week;
                                $Loss_army = $us_polkovodec['Loss_army'] + $dead_army_attaker;
                                mysql_query("UPDATE `users` SET `war_all` = '".$war_all."', `war_winner` = '".$war_winner."', `Kills_army` = '".$Kills_army."', `Loss_army` = '".$Loss_army."' WHERE `login` = '".$army_attaker['login']."' ");
 
 
                                $us_polkovodec_deff =  mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$colony_id_defence['login']."' LIMIT 1"));
                                $war_all_deff = $us_polkovodec_deff['war_all'] + 1;
                                $war_loss_deff = $us_polkovodec_deff['war_loss'] + 1;
                                $Kills_army_deff = $us_polkovodec_deff['Kills_army'] + $dead_army_attaker;
                                $Loss_army_deff = $us_polkovodec_deff['Loss_army'] + $kill_army_stats_week;
                                mysql_query("UPDATE `users` SET `war_all` = '".$war_all_deff."', `war_loss` = '".$war_loss_deff."', `Kills_army` = '".$Kills_army_deff."', `Loss_army` = '".$Loss_army_deff."' WHERE `login` = '".$us_polkovodec_deff['login']."' ");
 
                            }
 
                            if ($dead_army_attaker > 0 and $army_attaker['login'] != $colony_id_defence['login']) {
                                dead_army_attaker($colony_id_defence['login'], $dead_army_attaker);
                            }
 
 
                            if ($kill_army_stats_week > 0 and $army_attaker['login'] != $colony_id_defence['login']) {
                                dead_army_deffer($army_attaker['login'], $kill_army_stats_week);
                            }
 
 
                            if ($robberies_stats_week > 0 and $army_attaker['login'] != $colony_id_defence['login']) {
                                robberies_attaker($army_attaker['login'],$colony_id_defence['login'], $robberies_stats_week);
                            }
 
 
 
 
 
                            if ($alive_soldier_attak9 > 0) {
                                $zahvat = mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `colony_id` = '".$colony_id_defence['colony_id']."' LIMIT 1"));
                                if ($zahvat['rezidencia'] == 0 and $zahvat['dvorec'] == 0 and $zahvat['city'] == '-') {
                                    $kol_zahvat = mysql_fetch_assoc(mysql_query("SELECT * FROM `rezidencia_nev_colony` WHERE `colony_id` = '".$army_attaker['colony_id']."' LIMIT 1"));
                                    $drorec_or_rez = mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `colony_id` = '".$army_attaker['colony_id']."' LIMIT 1"));
 
 
                                    $kol_pos = 0;
                                    if ($drorec_or_rez['rezidencia'] > 0) {
                                        if ($kol_zahvat['colony_1'] == 0) {
                                            $kol_pos = $kol_pos +1;
                                        }else{
                                            if ($kol_zahvat['colony_2'] == 0) {
                                                $kol_pos = $kol_pos +1;
                                            }
                                        }
                                    }
                                    if ($drorec_or_rez['dvorec'] > 0) {
                                        if ($kol_zahvat['colony_1'] == 0) {
                                            $kol_pos = $kol_pos +1;
                                        }else{
                                            if ($kol_zahvat['colony_2'] == 0) {
                                                $kol_pos = $kol_pos +1;
                                            }else{
                                                if ($kol_zahvat['colony_3'] == 0) {
                                                    $kol_pos = $kol_pos +1;
                                                }
                                            }
                                        }
                                    }
 
 
 
 
                                    if ($kol_pos > 0) {
 
 
 
                                        $loyalty = $alive_soldier_attak9 * 20;
                                        $loyalty_ostatok = $zahvat['loyalty'] - $loyalty;
                                        if ($loyalty_ostatok > 0) {
                                            mysql_query("UPDATE `colony` SET `loyalty` = '".$loyalty_ostatok."' WHERE `colony_id` = '".$zahvat['colony_id']."' ");
                                            mysql_query("UPDATE `reports` SET `loyalty` = '".$loyalty_ostatok."' WHERE `attack_id` = '".$rand_id_attack."' ");
                                        }
                                        if ($loyalty_ostatok <= 0) {
 
                                            mysql_query("UPDATE `rezidencia_nev_colony` SET `colony_1` = '0' WHERE `colony_1` = '".$army_attaker['colony_id_deff']."' ");
 
                                            mysql_query("UPDATE `rezidencia_nev_colony` SET `colony_2` = '0' WHERE `colony_2` = '".$army_attaker['colony_id_deff']."' ");
 
                                            mysql_query("UPDATE `rezidencia_nev_colony` SET `colony_3` = '0' WHERE `colony_3` = '".$army_attaker['colony_id_deff']."' ");
 
                                            mysql_query("UPDATE `colony` SET `loyalty` = '0' WHERE `colony_id` = '".$zahvat['colony_id']."' ");
                                            mysql_query("DELETE FROM `akademija_build` WHERE `colony_id` = '".$zahvat['colony_id']."' ");
                                            mysql_query("DELETE FROM `akademija_research` WHERE `colony_id` = '".$zahvat['colony_id']."' ");
                                            mysql_query("INSERT INTO `akademija_research` (`colony_id`) VALUES ('".$zahvat['colony_id']."')");
                                            mysql_query("DELETE FROM `build` WHERE `colony_id` = '".$zahvat['colony_id']."' ");
 
                                            mysql_query("DELETE FROM `build_army` WHERE `colony_id` = '".$zahvat['colony_id']."' ");
 
                                            mysql_query("UPDATE `colony` SET `login` = '".$army_attaker['login']."' WHERE `colony_id` = '".$zahvat['colony_id']."' ");
 
                                            mysql_query("DELETE FROM `kyznja_dospehov_research` WHERE `colony_id` = '".$zahvat['colony_id']."' ");
 
                                            mysql_query("DELETE FROM `kyznja_oruzhiya_research` WHERE `colony_id` = '".$zahvat['colony_id']."' ");
 
                                            mysql_query("INSERT INTO `kyznja_oruzhiya_research` (`colony_id`) VALUES ('".$zahvat['colony_id']."')");
 
                                            mysql_query("INSERT INTO `kyznja_dospehov_research` (`colony_id`) VALUES ('".$zahvat['colony_id']."')");
 
                                            mysql_query("UPDATE `map` SET `login` = '".$army_attaker['login']."', `plemy` = '".$plemy_attaker['plemy']."' WHERE `colony_id` = '".$zahvat['colony_id']."' ");
 
 
                                            mysql_query("DELETE FROM `podkrep` WHERE `colony_id_deff` = '".$zahvat['colony_id']."' ");
 
                                            mysql_query("DELETE FROM `podkrep` WHERE `colony_id_send` = '".$zahvat['colony_id']."' ");
 
 
                                            mysql_query("DELETE FROM `ratysha_loyalty_up` WHERE `colony_id` = '".$zahvat['colony_id']."' ");
 
                                            mysql_query("DELETE FROM `rezidencia_nev_colony` WHERE `colony_id` = '".$zahvat['colony_id']."' ");
 
                                            mysql_query("DELETE FROM `rinok_sell` WHERE `colony_id_sell` = '".$zahvat['colony_id']."' ");
 
                                            mysql_query("DELETE FROM `send_army` WHERE `colony_id` = '".$zahvat['colony_id']."' ");
 
 
 
                                            $zahvat1 = mysql_fetch_assoc(mysql_query("SELECT * FROM `town` WHERE `colony_id` = '".$colony_id_defence['colony_id']."' LIMIT 1"));
 
                                            for ($i = 1; $i <= 21; $i++) { 
                                                if ($zahvat1['grid'.$i] != 'null') {
                                                    if ($zahvat1['grid'.$i] == 'masterskaja' or $zahvat1['grid'.$i] == 'akademija' or $zahvat1['grid'.$i] == 'arena' or $zahvat1['grid'.$i] == 'kyznja_oruzhiya' or $zahvat1['grid'.$i] == 'kyznja_dospehov' or $zahvat1['grid'.$i] == 'kazarma' or $zahvat1['grid'.$i] == 'konyshnja' or $zahvat1['grid'.$i] == 'big_kazarma' or $zahvat1['grid'.$i] == 'big_konyshnja') {
                                                        $yes_null = 'grid'.$i;
                                                        mysql_query("UPDATE `town` SET `".$yes_null."` = 'null' WHERE `colony_id` = '".$zahvat1['colony_id']."' ");
                                                    }
                                                }
                                            }
                                            mysql_query("UPDATE `colony` SET `masterskaja` = '0', `akademija` = '0', `arena` = '0', `kyznja_oruzhiya` = '0', `kyznja_dospehov` = '0', `kazarma` = '0', `konyshnja` = '0', `big_kazarma` = '0', `big_konyshnja` = '0' WHERE `colony_id` = '".$zahvat1['colony_id']."' ");
 
                                            mysql_query("UPDATE `town` SET `login` = '".$army_attaker['login']."' WHERE `colony_id` = '".$zahvat['colony_id']."' ");
 
                                            $alive_soldier_attak9 = $alive_soldier_attak9 - 1;
 
                                            if ($alive_soldier_attak9 < 0) {
                                                $alive_soldier_attak9 = 0;
                                            }
                                            $us_attacker = mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$us_polkovodec['login']."' LIMIT 1"));
 
                                            $zahvat_city = $us_attacker['zahvat_city'] + 1;
                                            mysql_query("UPDATE `users` SET `zahvat_city` = '".$zahvat_city."' WHERE `login` = '".$us_polkovodec['login']."' ");
 
                                            $active_colony = mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `colony_id` = '".$zahvat['colony_id']."' LIMIT 1"));
                                            if ($active_colony['active'] == '+') {
                                                $active_colony2 = mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `login` = '".$zahvat['login']."' AND `active` = '-' LIMIT 1"));
                                                mysql_query("UPDATE `colony` SET `active` = '+' WHERE `colony_id` = '".$active_colony2['colony_id']."' ");
                                                mysql_query("UPDATE `colony` SET `active` = '-' WHERE `colony_id` = '".$active_colony['colony_id']."' ");
 
                                            }
 
 
 
                                            if ($drorec_or_rez['rezidencia'] > 0) {
                                                if ($kol_zahvat['colony_1'] == 0) {
                                                    mysql_query("UPDATE `rezidencia_nev_colony` SET `colony_1` = '".$zahvat['colony_id']."' WHERE `colony_id` = '".$army_attaker['colony_id']."' ");
                                                }else{
                                                    if ($kol_zahvat['colony_2'] == 0) {
                                                       mysql_query("UPDATE `rezidencia_nev_colony` SET `colony_2` = '".$zahvat['colony_id']."' WHERE `colony_id` = '".$army_attaker['colony_id']."' "); 
                                                    }
                                                }
                                            }else{
                                                if ($drorec_or_rez['dvorec'] > 0) {
                                                    if ($kol_zahvat['colony_1'] == 0) {
                                                        mysql_query("UPDATE `rezidencia_nev_colony` SET `colony_1` = '".$zahvat['colony_id']."' WHERE `colony_id` = '".$army_attaker['colony_id']."' ");
                                                    }else{
                                                        if ($kol_zahvat['colony_2'] == 0) {
                                                            mysql_query("UPDATE `rezidencia_nev_colony` SET `colony_2` = '".$zahvat['colony_id']."' WHERE `colony_id` = '".$army_attaker['colony_id']."' ");
                                                        }else{
                                                            if ($kol_zahvat['colony_3'] == 0) {
                                                                mysql_query("UPDATE `rezidencia_nev_colony` SET `colony_3` = '".$zahvat['colony_id']."' WHERE `colony_id` = '".$army_attaker['colony_id']."' ");
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
 
                                }
                            }
 
                            //поселення == 0 то видалити його
                            $city_0 = mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `colony_id` = '".$army_attaker['colony_id_deff']."' LIMIT 1"));
 
 
                            if ($city_0['city_people'] <= 0 and $city_0['city'] == '-' and $alive_soldier_attak8 > 0 and $city_0['colony_id'] != '30' and $city_0['colony_id'] != '31' and $city_0['colony_id'] != '32' and $city_0['colony_id'] != '33' and $city_0['colony_id'] != '34' and $city_0['colony_id'] != '35' and $city_0['colony_id'] != '36' and $city_0['colony_id'] != '37' and $city_0['colony_id'] != '38' and $city_0['colony_id'] != '39' and $city_0['colony_id'] != '40') {
 
 
                                mysql_query("UPDATE `rezidencia_nev_colony` SET `colony_1` = '0' WHERE `colony_1` = '".$army_attaker['colony_id_deff']."' ");
                                mysql_query("UPDATE `rezidencia_nev_colony` SET `colony_2` = '0' WHERE `colony_2` = '".$army_attaker['colony_id_deff']."' ");
                                mysql_query("UPDATE `rezidencia_nev_colony` SET `colony_3` = '0' WHERE `colony_3` = '".$army_attaker['colony_id_deff']."' ");
 
                                mysql_query("DELETE FROM `akademija_build` WHERE `colony_id` = '".$city_0['colony_id']."' ");
                                mysql_query("DELETE FROM `akademija_research` WHERE `colony_id` = '".$city_0['colony_id']."' ");
                                mysql_query("DELETE FROM `build` WHERE `colony_id` = '".$city_0['colony_id']."' ");
 
                                mysql_query("DELETE FROM `build_army` WHERE `colony_id` = '".$city_0['colony_id']."' ");
 
                                mysql_query("DELETE FROM `colony` WHERE `id` = '".$city_0['id']."' ");
 
                                mysql_query("DELETE FROM `kyznja_dospehov_research` WHERE `colony_id` = '".$city_0['colony_id']."' ");
                                mysql_query("DELETE FROM `kyznja_oruzhiya_research` WHERE `colony_id` = '".$city_0['colony_id']."' ");
 
                                mysql_query("UPDATE `map` SET `colony_id` = '0', `plemy` = '0' WHERE `colony_id` = '".$city_0['colony_id']."' ");
                                mysql_query("DELETE FROM `ratysha_loyalty_up` WHERE `colony_id` = '".$city_0['colony_id']."' ");
 
                                mysql_query("DELETE FROM `podkrep` WHERE `colony_id_deff` = '".$city_0['colony_id']."' ");
 
                                mysql_query("DELETE FROM `podkrep` WHERE `colony_id_send` = '".$city_0['colony_id']."' ");
 
                                mysql_query("DELETE FROM `rezidencia_nev_colony` WHERE `colony_id` = '".$city_0['colony_id']."' ");
                                mysql_query("DELETE FROM `rinok_sell` WHERE `colony_id_sell` = '".$city_0['colony_id']."' ");
 
                                $send_aemy_city_0 = mysql_query("SELECT * FROM `send_army` WHERE `colony_id` = '".$city_0['colony_id']."' ORDER BY id ASC ");
                                while ($row = mysql_fetch_array($send_aemy_city_0)) {             
                                    if ($row['colony_id'] == $city_0['colony_id']) {
                                        mysql_query("DELETE FROM `send_army` WHERE `id` = '".$row['id']."' ");
                                    }
                                }
                                mysql_query("DELETE FROM `send_army` WHERE `colony_id` = '".$city_0['colony_id']."' ");
 
                                mysql_query("DELETE FROM `town` WHERE `colony_id` = '".$city_0['colony_id']."' ");
 
                                $us_attacker = mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$us_polkovodec['login']."' LIMIT 1"));
                                $number_destroi = $us_attacker['city_destroi'] + 1;
                                mysql_query("UPDATE `users` SET `city_destroi` = '".$number_destroi."' WHERE `login` = '".$us_polkovodec['login']."' ");
 
                            }
 
                            if ($alive_soldier_attak1 > 0 or $alive_soldier_attak2 > 0 or $alive_soldier_attak3 > 0 or $alive_soldier_attak4 > 0 or $alive_soldier_attak5 > 0 or $alive_soldier_attak6 > 0 or $alive_soldier_attak7 > 0 or $alive_soldier_attak8 > 0 or $alive_soldier_attak9 > 0 or $alive_soldier_attak10 > 0) {
                                mysql_query("INSERT INTO `send_army`(`login`, `type_attack`, `last_time`, `x`,`y`, `colony_id`, `colony_id_deff`, `soldier1`, `soldier2`, `soldier3`, `soldier4`, `soldier5`, `soldier6`, `soldier7`, `soldier8`, `soldier9`, `soldier10`,`derevo`,`glina`,`jelezo`,`zerno`) VALUES ('".$army_attaker['login']."', '4', '".$time_m."', '".$plemy_defender['x']."', '".$plemy_defender['y']."', '".$army_attaker['colony_id']."', '".$army_attaker['colony_id_deff']."', '".$alive_soldier_attak1."', '".$alive_soldier_attak2."', '".$alive_soldier_attak3."', '".$alive_soldier_attak4."', '".$alive_soldier_attak5."', '".$alive_soldier_attak6."', '".$alive_soldier_attak7."', '".$alive_soldier_attak8."', '".$alive_soldier_attak9."', '".$alive_soldier_attak10."','".$vzjav_derevo."','".$vzjav_glina."','".$vzjav_jelezo."','".$vzjav_zerno."') ");
                            }
 
 
                        }else{
                            //winner deff
                            $x = 100 * pow(($summ_attak / $summ_deff),$k);
                            $deff = $x / (100 + $x);
                            $attack = 0;
 
 
                            for ($i=1; $i <= 10; $i++) { 
                                $alive_soldier_attak = round($attack*$army_attaker['soldier'.$i]);
                                if ($i == 1) {
                                    $alive_soldier_attak1 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack1 = $alive_soldier_attak;
                                    $Loss_army_polk = $Loss_army_polk + $alive_soldier_attak1;
                                    $dead_army_attaker = $dead_army_attaker + $army_attaker['soldier'.$i];
                                }
                                if ($i == 2) {
                                    $alive_soldier_attak2 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack2 = $alive_soldier_attak;
                                    $Loss_army_polk = $Loss_army_polk + $alive_soldier_attak2;
                                    $dead_army_attaker = $dead_army_attaker + $army_attaker['soldier'.$i];
                                }
                                if ($i == 3) {
                                    $alive_soldier_attak3 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack3 = $alive_soldier_attak;
                                    $Loss_army_polk = $Loss_army_polk + $alive_soldier_attak3;
                                    $dead_army_attaker = $dead_army_attaker + $army_attaker['soldier'.$i];
                                }
                                if ($i == 4) {
                                    $alive_soldier_attak4 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack4 = $alive_soldier_attak;
                                    $Loss_army_polk = $Loss_army_polk + $alive_soldier_attak4;
                                    $dead_army_attaker = $dead_army_attaker + $army_attaker['soldier'.$i];
                                }
                                if ($i == 5) {
                                    $alive_soldier_attak5 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack5 = $alive_soldier_attak;
                                    $Loss_army_polk = $Loss_army_polk + $alive_soldier_attak5;
                                    $dead_army_attaker = $dead_army_attaker + $army_attaker['soldier'.$i];
                                }
                                if ($i == 6) {
                                    $alive_soldier_attak6 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack6 = $alive_soldier_attak;
                                    $Loss_army_polk = $Loss_army_polk + $alive_soldier_attak6;
                                    $dead_army_attaker = $dead_army_attaker + $army_attaker['soldier'.$i];
                                }
                                if ($i == 7) {
                                    $alive_soldier_attak7 = $army_attaker['soldier'.$i] - $alive_soldier_attak;
                                    $dead_soldier_attack7 = $alive_soldier_attak;
                                    $Loss_army_polk = $Loss_army_polk + $alive_soldier_attak7;
                                    $dead_army_attaker = $dead_army_attaker + $army_attaker['soldier'.$i];
                                }
                                if ($i == 8) {
                                    if ($army_attaker['soldier8'] > 0) {
                                        if ($army_attaker['type_build_snos'] != 'no_build') {
 
                                            if ($army_attaker['type_build_snos'] == 'random') {
                                                $random_build_snos = random_build($colony_id_defence['colony_id']);
                                            }else{
                                                $random_build_snos = $army_attaker['type_build_snos'];
                                                if ($colony_id_defence[$random_build_snos] == 0) {
                                                    $random_build_snos = random_build($colony_id_defence['colony_id']);
                                                }
                                            }
 
                                            if ($random_build_snos != 'no_build') {
 
                                                $oa = $summ_attak;
                                                $oz = $summ_deff;
 
 
                                                $x1 = pow(($oa/$oz), 1.5);
 
 
                                                if ($x1 >= 1) {
                                                    $x1 = floor((1-(0.5/$x1)) * 100);
                                                }else{
                                                    $x1 = floor(($x1 / 2) * 100);
                                                }
 
 
 
                                                $kat = $army_attaker['soldier8'];
 
 
                                                $kat = floor(($kat * $x1) / 100); 
 
                                                if ($army_attaker['type_build_snos'] != 'no_build' and $army_attaker['type_build_snos2'] != 'no_build') {
                                                    $kat = floor($kat / 2);
                                                }
 
                                                $lvl_build_destroi_kat = [2,2,2,3,4,6,8,10,12,14,17,20,23,27,31,35,39,43,48,53];
 
                                                if ($colony_id_defence['kamenetes'] > 0) {
                                                    $lvl_kamenetes = mysql_fetch_assoc(mysql_query("SELECT * FROM `kamenetes` WHERE `id` = '".$colony_id_defence['kamenetes']."' LIMIT 1"));
                                                    foreach ($lvl_build_destroi_kat as &$value) {
                                                        $value = round($value * $lvl_kamenetes['lvl_deff']);
                                                    }
                                                }
 
                                                $lvl_build = $colony_id_defence[$random_build_snos];
 
                                                $id = $lvl_build - 1;
                                                $test = $lvl_build_destroi_kat[$id] - $kat;
 
 
                                                $kol_snosy = 0;
 
                                                if ($kat >= $lvl_build_destroi_kat[$id]){
                                                    $kol_snosy = 0;
                                                }else{
                                                    if ($kat >= $lvl_build_destroi_kat[$id]){ 
                                                        $kol_snosy = 0;
                                                    }else{
                                                        for ($l = 0; $l <= $id; $l++) { 
                                                            if ($lvl_build_destroi_kat[$l] >= $test) {
                                                                $kol_snosy = $l+1;
                                                                break;
                                                            }
                                                        }
                                                    }
                                                } 
 
 
                                                $snos_build_riven = $lvl_build - $kol_snosy;
 
                                                if ($snos_build_riven == $lvl_build) {
                                                    $snos_build_riven = $lvl_build;
                                                    $snos_build_ostatok = 0;
                                                }else{
                                                    $snos_build_ostatok = $kol_snosy;
                                                }
 
                                                $ostatok_lvl = $colony_id_defence[$random_build_snos] - $snos_build_riven;
                                                if ($snos_build_riven > 0) {
                                                    if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma5' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15' || $random_build_snos == 'ferma16' || $random_build_snos == 'ferma17' || $random_build_snos == 'ferma18') {
                                                            if($plemy_defender['type'] == 1 ) {
                                                                if ($random_build_snos == 'ferma5' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16') {
                                                                $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma17') {
                                                                    $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                    $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                    $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                }
                                                            }
                                                            if($plemy_defender['type'] == 2 ) {
                                                                if ($random_build_snos == 'ferma6' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10') {
                                                                    $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                    $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma2' || $random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma5' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15' || $random_build_snos == 'ferma17') {
                                                                    $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                }
                                                            }
                                                            if($plemy_defender['type'] == 3 ) {
                                                                if ($random_build_snos == 'ferma16') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma17') {
                                                                    $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma18') {
                                                                    $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma5' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                    $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                }
                                                            }
                                                            if($plemy_defender['type'] == 4 ) {
                                                                if ($random_build_snos == 'ferma5' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16' || $random_build_snos == 'ferma17') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10') {
                                                                    $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                    $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                    $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                }
                                                            }
                                                            if($plemy_defender['type'] == 5 ) {
                                                                if ($random_build_snos == 'ferma5' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma6' || $random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma17') {
                                                                    $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                    $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                    $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                }
                                                            }
                                                            if($plemy_defender['type'] == 6 ) {
                                                                if ($random_build_snos == 'ferma5' || $random_build_snos == 'ferma11' || $random_build_snos == 'ferma16') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma8' || $random_build_snos == 'ferma9' || $random_build_snos == 'ferma10' || $random_build_snos == 'ferma17') {
                                                                    $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma1' || $random_build_snos == 'ferma2' || $random_build_snos == 'ferma6' || $random_build_snos == 'ferma7' || $random_build_snos == 'ferma18') {
                                                                    $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos == 'ferma3' || $random_build_snos == 'ferma4' || $random_build_snos == 'ferma12' || $random_build_snos == 'ferma13' || $random_build_snos == 'ferma14' || $random_build_snos == 'ferma15') {
                                                                    $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                }
                                                            }
                                                        }else{
                                                            if ($random_build_snos == 'sklad2' || $random_build_snos == 'sklad4' || $random_build_snos == 'sklad5' || $random_build_snos == 'sklad6' || $random_build_snos == 'sklad6' || $random_build_snos == 'sklad7' || $random_build_snos == 'sklad8' || $random_build_snos == 'sklad9' || $random_build_snos == 'sklad10') {
                                                                $table_snos = mysql_query("SELECT * FROM `sklad` ORDER BY `id` DESC");
                                                            }else{
                                                                if ($random_build_snos == 'ambar2' || $random_build_snos == 'ambar3' || $random_build_snos == 'ambar4' || $random_build_snos == 'ambar5' || $random_build_snos == 'ambar6' || $random_build_snos == 'ambar7' || $random_build_snos == 'ambar8' || $random_build_snos == 'ambar9' || $random_build_snos == 'ambar10') {
                                                                    $table_snos = mysql_query("SELECT * FROM `ambar` ORDER BY `id` DESC");
                                                                }else{
                                                                    if ($random_build_snos == 'tainik2' || $random_build_snos == 'tainik3' || $random_build_snos == 'tainik4' || $random_build_snos == 'tainik5' || $random_build_snos == 'tainik6' || $random_build_snos == 'tainik7' || $random_build_snos == 'tainik8' || $random_build_snos == 'tainik9' || $random_build_snos == 'tainik10' || $random_build_snos == 'tainik11' || $random_build_snos == 'tainik12' || $random_build_snos == 'tainik13' || $random_build_snos == 'tainik14' || $random_build_snos == 'tainik15' || $random_build_snos == 'tainik16' || $random_build_snos == 'tainik17' || $random_build_snos == 'tainik18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `tainik` ORDER BY `id` DESC");
                                                                    }else{
                                                                        $table_snos = mysql_query("SELECT * FROM `".$random_build_snos."` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                            }
 
                                                        }
 
                                                    $lvl_city = 0;
                                                    while($row1 = mysql_fetch_array($table_snos)){
                                                        if ($row1['id'] >= $ostatok_lvl & $row1['id'] <= $colony_id_defence[$random_build_snos]) {
                                                            $lvl_city += $row1['city_people'];
                                                        }
                                                    }
                                                    $people = $colony_id_defence['city_people'] - $lvl_city;
                                                    mysql_query("UPDATE `colony` SET `".$random_build_snos."` = '".$snos_build_ostatok."', `city_people` = '".$people."' WHERE `colony_id` = '".$colony_id_defence['colony_id']."' ");
 
                                                    $town_colony_deffence =  mysql_fetch_assoc(mysql_query("SELECT * FROM `town` WHERE `colony_id` = '".$colony_id_defence['colony_id']."' LIMIT 1"));
                                                    if ($snos_build_ostatok == 0 & $random_build_snos != 'ferma1' & $random_build_snos != 'ferma2' & $random_build_snos != 'ferma3' & $random_build_snos != 'ferma4' & $random_build_snos != 'ferma5' & $random_build_snos != 'ferma6' & $random_build_snos != 'ferma7'  & $random_build_snos != 'ferma8' & $random_build_snos != 'ferma9' & $random_build_snos != 'ferma10' & $random_build_snos != 'ferma11' & $random_build_snos != 'ferma12' & $random_build_snos != 'ferma13' & $random_build_snos != 'ferma14' & $random_build_snos != 'ferma15' & $random_build_snos != 'ferma16' & $random_build_snos != 'ferma17' & $random_build_snos != 'ferma18') {
                                                        for ($g = 1; $g <= 21; $g++) {  
                                                            $grid = 'grid'.$g;
                                                            if ($town_colony_deffence[$grid] == $random_build_snos) {
                                                                mysql_query("UPDATE `town` SET `".$grid."` = 'null' WHERE `colony_id` = '".$colony_id_defence['colony_id']."' ");
                                                                mysql_query("DELETE FROM `build` WHERE `build_id` = '".$random_build_snos."' and `colony_id` = '".$colony_id_defence['colony_id']."' ");
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
 
 
                                        $colony_id_defence = mysql_fetch_assoc(mysql_query("SELECT * FROM `colony` WHERE `colony_id` = '".$army_attaker['colony_id_deff']."' LIMIT 1"));
                                        //вибір другої атаки
                                        if ($army_attaker['type_build_snos2'] != 'no_build' and $army_attaker['soldier8'] >= 20) {
 
 
 
                                            if ($army_attaker['type_build_snos2'] == 'random') {
                                                $random_build_snos2 = random_build($colony_id_defence['colony_id']);
                                            }else{
                                                $random_build_snos2 = $army_attaker['type_build_snos2'];
                                                if ($colony_id_defence[$random_build_snos2] == 0) {
                                                    $random_build_snos2 = random_build($colony_id_defence['colony_id']);
                                                }
                                            }
 
 
                                            if ($random_build_snos2 != 'no_build' and $random_build_snos != $random_build_snos2) {
 
                                                $oa = $summ_attak;
                                                $oz = $summ_deff;
 
 
                                                $x1 = pow(($oa/$oz), 1.5);
 
 
                                                if ($x1 >= 1) {
                                                    $x1 = floor((1-(0.5/$x1)) * 100);
                                                }else{
                                                    $x1 = floor(($x1 / 2) * 100);
                                                }
 
 
 
                                                $kat = $army_attaker['soldier8'];
 
 
                                                $kat = floor(($kat * $x1) / 100); 
 
                                                if ($army_attaker['type_build_snos'] != 'no_build' and $army_attaker['type_build_snos2'] != 'no_build') {
                                                    $kat = floor($kat / 2);
                                                }
 
                                                $lvl_build_destroi_kat = [2,2,2,3,4,6,8,10,12,14,17,20,23,27,31,35,39,43,48,53];
 
                                                if ($colony_id_defence['kamenetes'] > 0) {
                                                    $lvl_kamenetes = mysql_fetch_assoc(mysql_query("SELECT * FROM `kamenetes` WHERE `id` = '".$colony_id_defence['kamenetes']."' LIMIT 1"));
                                                    foreach ($lvl_build_destroi_kat as &$value) {
                                                        $value = round($value * $lvl_kamenetes['lvl_deff']);
                                                    }
                                                }
 
                                                $lvl_build = $colony_id_defence[$random_build_snos2];
 
                                                $id = $lvl_build - 1;
                                                $test = $lvl_build_destroi_kat[$id] - $kat;
 
 
                                                $kol_snosy = 0;
 
                                                if ($kat >= $lvl_build_destroi_kat[$id]){
                                                    $kol_snosy = 0;
                                                }else{
                                                    if ($kat >= $lvl_build_destroi_kat[$id]){ 
                                                        $kol_snosy = 0;
                                                    }else{
                                                        for ($l = 0; $l <= $id; $l++) { 
                                                            if ($lvl_build_destroi_kat[$l] >= $test) {
                                                                $kol_snosy = $l+1;
                                                                break;
                                                            }
                                                        }
                                                    }
                                                } 
 
 
                                                $snos_build_riven2 = $lvl_build - $kol_snosy;
 
                                                if ($snos_build_riven2 == $lvl_build) {
                                                    $snos_build_riven2 = $lvl_build;
                                                    $snos_build_ostatok2 = 0;
                                                }else{
                                                    $snos_build_ostatok2 = $kol_snosy;
                                                }
 
                                                $ostatok_lvl = $colony_id_defence[$random_build_snos2] - $snos_build_riven2;
                                                if ($snos_build_riven2 > 0) {
                                                    if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15' || $random_build_snos2 == 'ferma16' || $random_build_snos2 == 'ferma17' || $random_build_snos2 == 'ferma18') {
                                                            if($plemy_defender['type'] == 1 ) {
                                                                if ($random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16') {
                                                                $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma17') {
                                                                    $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                    $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                    $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                }
                                                            }
                                                            if($plemy_defender['type'] == 2 ) {
                                                                if ($random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10') {
                                                                    $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                    $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15' || $random_build_snos2 == 'ferma17') {
                                                                    $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                }
                                                            }
                                                            if($plemy_defender['type'] == 3 ) {
                                                                if ($random_build_snos2 == 'ferma16') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma17') {
                                                                    $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma18') {
                                                                    $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                    $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                }
                                                            }
                                                            if($plemy_defender['type'] == 4 ) {
                                                                if ($random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16' || $random_build_snos2 == 'ferma17') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10') {
                                                                    $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                    $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                    $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                }
                                                            }
                                                            if($plemy_defender['type'] == 5 ) {
                                                                if ($random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma17') {
                                                                    $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                    $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                    $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                }
                                                            }
                                                            if($plemy_defender['type'] == 6 ) {
                                                                if ($random_build_snos2 == 'ferma5' || $random_build_snos2 == 'ferma11' || $random_build_snos2 == 'ferma16') {
                                                                    $table_snos = mysql_query("SELECT * FROM `derevo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma8' || $random_build_snos2 == 'ferma9' || $random_build_snos2 == 'ferma10' || $random_build_snos2 == 'ferma17') {
                                                                    $table_snos = mysql_query("SELECT * FROM `glina` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma1' || $random_build_snos2 == 'ferma2' || $random_build_snos2 == 'ferma6' || $random_build_snos2 == 'ferma7' || $random_build_snos2 == 'ferma18') {
                                                                    $table_snos = mysql_query("SELECT * FROM `jelezo` ORDER BY `id` DESC");
                                                                }
                                                                if ($random_build_snos2 == 'ferma3' || $random_build_snos2 == 'ferma4' || $random_build_snos2 == 'ferma12' || $random_build_snos2 == 'ferma13' || $random_build_snos2 == 'ferma14' || $random_build_snos2 == 'ferma15') {
                                                                    $table_snos = mysql_query("SELECT * FROM `zerno` ORDER BY `id` DESC");
                                                                }
                                                            }
                                                        }else{
                                                            if ($random_build_snos2 == 'sklad2' || $random_build_snos2 == 'sklad4' || $random_build_snos2 == 'sklad5' || $random_build_snos2 == 'sklad6' || $random_build_snos2 == 'sklad6' || $random_build_snos2 == 'sklad7' || $random_build_snos2 == 'sklad8' || $random_build_snos2 == 'sklad9' || $random_build_snos2 == 'sklad10') {
                                                                $table_snos = mysql_query("SELECT * FROM `sklad` ORDER BY `id` DESC");
                                                            }else{
                                                                if ($random_build_snos2 == 'ambar2' || $random_build_snos2 == 'ambar3' || $random_build_snos2 == 'ambar4' || $random_build_snos2 == 'ambar5' || $random_build_snos2 == 'ambar6' || $random_build_snos2 == 'ambar7' || $random_build_snos2 == 'ambar8' || $random_build_snos2 == 'ambar9' || $random_build_snos2 == 'ambar10') {
                                                                    $table_snos = mysql_query("SELECT * FROM `ambar` ORDER BY `id` DESC");
                                                                }else{
                                                                    if ($random_build_snos2 == 'tainik2' || $random_build_snos2 == 'tainik3' || $random_build_snos2 == 'tainik4' || $random_build_snos2 == 'tainik5' || $random_build_snos2 == 'tainik6' || $random_build_snos2 == 'tainik7' || $random_build_snos2 == 'tainik8' || $random_build_snos2 == 'tainik9' || $random_build_snos2 == 'tainik10' || $random_build_snos2 == 'tainik11' || $random_build_snos2 == 'tainik12' || $random_build_snos2 == 'tainik13' || $random_build_snos2 == 'tainik14' || $random_build_snos2 == 'tainik15' || $random_build_snos2 == 'tainik16' || $random_build_snos2 == 'tainik17' || $random_build_snos2 == 'tainik18') {
                                                                        $table_snos = mysql_query("SELECT * FROM `tainik` ORDER BY `id` DESC");
                                                                    }else{
                                                                        $table_snos = mysql_query("SELECT * FROM `".$random_build_snos2."` ORDER BY `id` DESC");
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    $lvl_city = 0;
                                                    while($row1 = mysql_fetch_array($table_snos)){
                                                        if ($row1['id'] >= $ostatok_lvl & $row1['id'] <= $colony_id_defence[$random_build_snos2]) {
                                                            $lvl_city += $row1['city_people'];
                                                        }
                                                    }
                                                    $people = $colony_id_defence['city_people'] - $lvl_city;
                                                    mysql_query("UPDATE `colony` SET `".$random_build_snos2."` = '".$snos_build_ostatok2."', `city_people` = '".$people."' WHERE `colony_id` = '".$colony_id_defence['colony_id']."' ");
 
                                                    $town_colony_deffence =  mysql_fetch_assoc(mysql_query("SELECT * FROM `town` WHERE `colony_id` = '".$colony_id_defence['colony_id']."' LIMIT 1"));
                                                    if ($snos_build_ostatok1 == 0 & $random_build_snos2 != 'ferma1' & $random_build_snos2 != 'ferma2' & $random_build_snos2 != 'ferma3' & $random_build_snos2 != 'ferma4' & $random_build_snos2 != 'ferma5' & $random_build_snos2 != 'ferma6' & $random_build_snos2 != 'ferma7'  & $random_build_snos2 != 'ferma8' & $random_build_snos2 != 'ferma9' & $random_build_snos2 != 'ferma10' & $random_build_snos2 != 'ferma11' & $random_build_snos2 != 'ferma12' & $random_build_snos2 != 'ferma13' & $random_build_snos2 != 'ferma14' & $random_build_snos2 != 'ferma15' & $random_build_snos2 != 'ferma16' & $random_build_snos2 != 'ferma17' & $random_build_snos2 != 'ferma18') {
                                                        for ($g = 1; $g <= 21; $g++) {  
                                                            $grid = 'grid'.$g;
                                                            if ($town_colony_deffence[$grid] == $random_build_snos2) {
                                                                mysql_query("UPDATE `town` SET `".$grid."` = 'null' WHERE `colony_id` = '".$colony_id_defence['colony_id']."' ");
                                                                mysql_query("DELETE FROM `build` WHERE `build_id` = '".$random_build_snos."' and `colony_id` = '".$colony_id_defence['colony_id']."' ");
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        $alive_soldier_attak8 = $army_attaker['soldier8'] - $alive_soldier_attak;
                                        $dead_soldier_attack8 = $alive_soldier_attak;
                                        $Loss_army_polk = $Loss_army_polk + $alive_soldier_attak8;
                                        $dead_army_attaker = $dead_army_attaker + $army_attaker['soldier8'];
                                    }else{
                                        $alive_soldier_attak8 = $army_attaker['soldier8'] - $alive_soldier_attak;
                                        $dead_soldier_attack8 = $alive_soldier_attak;
                                        $Loss_army_polk = $Loss_army_polk + $alive_soldier_attak8;
                                        $dead_army_attaker = $dead_army_attaker + $army_attaker['soldier8'];
                                    }
 
                                }
                                if ($i == 9) {
                                    $alive_soldier_attak9 = $army_attaker['soldier9'] - $alive_soldier_attak;
                                    $dead_soldier_attack9 = $alive_soldier_attak;
                                    $Loss_army_polk = $Loss_army_polk + $alive_soldier_attak9;
                                    $dead_army_attaker = $dead_army_attaker + $army_attaker['soldier9'];
                                }
                                if ($i == 10) {
                                    $alive_soldier_attak10 = $army_attaker['soldier10'] - $alive_soldier_attak;
                                    $dead_soldier_attack10 = $alive_soldier_attak;
                                    $Loss_army_polk = $Loss_army_polk + $alive_soldier_attak10;
                                    $dead_army_attaker = $dead_army_attaker + $army_attaker['soldier10'];
                                }
                            }
 
                            if ($plemy_attaker['plemy'] == 1) {
                                $units_type = 'units_rus';
                            }
                            if ($plemy_attaker['plemy'] == 2) {
                                $units_type = 'units_ua';
                            }
                            if ($plemy_attaker['plemy'] == 3) {
                                $units_type = 'units_pl';
                            }
 
                            //$rand_id_attack = rand(111,999999);
                            do {
                              $rand_id_attack = rand(111,9999999);
                              $result = mysql_query("SELECT * FROM `reports` WHERE `attack_id` = '".$rand_id_attack."' LIMIT 1");
                              $rand_atk = mysql_fetch_assoc($result);
                              if ($rand_atk['attack_id'] == $rand_id_attack) {
                                continue; // якщо знайдено збіг, продовжуйте цикл
                              } else {
                                break; // якщо збіг не знайдено, припиніть цикл
                              }
                            } while (true); // безмежний цикл, який треба припинити за допомогою break
                            mysql_query("INSERT INTO `reports`(`attack_id`,`user_attack`,`user_deff`,`colony_id_attack`,`colony_id_deff`,`plemy_attack`,`plemy_deff`,`off_1_unit`,`off_2_unit`,`off_3_unit`,`off_4_unit`,`off_5_unit`,`off_6_unit`,`off_7_unit`,`off_8_unit`,`off_9_unit`,`off_10_unit`,`off_1_result`,`off_2_result`,`off_3_result`,`off_4_result`,`off_5_result`,`off_6_result`,`off_7_result`,`off_8_result`,`off_9_result`,`off_10_result`,`time_attack`,`type_attack`,`lvl_build_destroi`,`lvl_build_ostatok`,`name_build_destroi`,`lvl_build_destroi2`,`lvl_build_ostatok2`,`name_build_destroi2`,`stena_start`,`stena_stop`) VALUES ('".$rand_id_attack."', '".$army_attaker['login']."', '".$colony_id_defence['login']."','".$army_attaker['colony_id']."','".$army_attaker['colony_id_deff']."','".$plemy_attaker['plemy']."','".$plemy_defender['plemy']."','".$army_attaker['soldier1']."','".$army_attaker['soldier2']."','".$army_attaker['soldier3']."','".$army_attaker['soldier4']."','".$army_attaker['soldier5']."','".$army_attaker['soldier6']."','".$army_attaker['soldier7']."','".$army_attaker['soldier8']."','".$army_attaker['soldier9']."','".$army_attaker['soldier10']."','".$army_attaker['soldier1']."','".$army_attaker['soldier2']."','".$army_attaker['soldier3']."','".$army_attaker['soldier4']."','".$army_attaker['soldier5']."','".$army_attaker['soldier6']."','".$army_attaker['soldier7']."','".$army_attaker['soldier8']."','".$army_attaker['soldier9']."','".$army_attaker['soldier10']."','".$army_attaker['last_time']."','".$army_attaker['type_attack']."','".$snos_build_riven."','".$snos_build_ostatok."','".$random_build_snos."','".$snos_build_riven2."','".$snos_build_ostatok2."','".$random_build_snos2."','".$snos_stena_riven."','".$snos_stena_ostatok."') ");
 
 
 
 
 
                            $type_plemy = mysql_fetch_assoc(mysql_query("SELECT * FROM `map` WHERE `colony_id` = '".$army_attaker['colony_id_deff']."' LIMIT 1"));
                            if($type_plemy['plemy'] == 1 ) $type_plemy_atk = 'units_rus';
                            if($type_plemy['plemy'] == 2 ) $type_plemy_atk = 'units_ua';
                            if($type_plemy['plemy'] == 3 ) $type_plemy_atk = 'units_pl';
 
                            for ($i=1; $i <= 10; $i++) { 
                                $alive_soldier_deff = round($deff*$colony_id_defence['soldier'.$i]);
                                if ($i == 1) {
                                    $alive_soldier_deff1 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_1 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_1;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 2) {
                                    $alive_soldier_deff2 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_2 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_2;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 3) {
                                    $alive_soldier_deff3 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_3 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_3;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 4) {
                                    $alive_soldier_deff4 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_4 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_4;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 5) {
                                    $alive_soldier_deff5 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_5 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_5;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 6) {
                                    $alive_soldier_deff6 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_6 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_6;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 7) {
                                    $alive_soldier_deff7 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_7 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_7;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 8) {
                                    $alive_soldier_deff8 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_8 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_8;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 9) {
                                    $alive_soldier_deff9 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_9 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_9;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
                                if ($i == 10) {
                                    $alive_soldier_deff10 = $colony_id_defence['soldier'.$i] - $alive_soldier_deff;
                                    $dead_soldier_def_10 = $alive_soldier_deff;
                                    $kill_army_polk = $kill_army_polk + $dead_soldier_def_10;
                                    $kill_army_stats_week += $alive_soldier_deff;
                                }
 
                            }
                             mysql_query("UPDATE `colony` SET 
                                        `soldier1` = '".$alive_soldier_deff1."', 
                                        `soldier2` = '".$alive_soldier_deff2."', 
                                        `soldier3` = '".$alive_soldier_deff3."', 
                                        `soldier4` = '".$alive_soldier_deff4."', 
                                        `soldier5` = '".$alive_soldier_deff5."', 
                                        `soldier6` = '".$alive_soldier_deff6."', 
                                        `soldier7` = '".$alive_soldier_deff7."', 
                                        `soldier8` = '".$alive_soldier_deff8."', 
                                        `soldier9` = '".$alive_soldier_deff9."', 
                                        `soldier10` = '".$alive_soldier_deff10."' 
                                        WHERE 
                                        `colony_id` = '".$army_attaker['colony_id_deff']."' ");
 
                             if ($type_plemy['plemy'] == 1) {
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_ru_1` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_ru_2` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_ru_3` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_ru_4` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_ru_5` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_ru_6` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_ru_7` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_ru_8` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_ru_9` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_ru_10` = '".$colony_id_defence['soldier10']."',
                                        `deff_unit_podkrep_ru_1_res` = '".$dead_soldier_def_1."', 
                                        `deff_unit_podkrep_ru_2_res` = '".$dead_soldier_def_2."', 
                                        `deff_unit_podkrep_ru_3_res` = '".$dead_soldier_def_3."', 
                                        `deff_unit_podkrep_ru_4_res` = '".$dead_soldier_def_4."', 
                                        `deff_unit_podkrep_ru_5_res` = '".$dead_soldier_def_5."', 
                                        `deff_unit_podkrep_ru_6_res` = '".$dead_soldier_def_6."', 
                                        `deff_unit_podkrep_ru_7_res` = '".$dead_soldier_def_7."', 
                                        `deff_unit_podkrep_ru_8_res` = '".$dead_soldier_def_8."', 
                                        `deff_unit_podkrep_ru_9_res` = '".$dead_soldier_def_9."', 
                                        `deff_unit_podkrep_ru_10_res` = '".$dead_soldier_def_10."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                             }
                             if ($type_plemy['plemy'] == 2) {
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_ua_1` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_ua_2` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_ua_3` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_ua_4` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_ua_5` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_ua_6` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_ua_7` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_ua_8` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_ua_9` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_ua_10` = '".$colony_id_defence['soldier10']."',
                                        `deff_unit_podkrep_ua_1_res` = '".$dead_soldier_def_1."', 
                                        `deff_unit_podkrep_ua_2_res` = '".$dead_soldier_def_2."', 
                                        `deff_unit_podkrep_ua_3_res` = '".$dead_soldier_def_3."', 
                                        `deff_unit_podkrep_ua_4_res` = '".$dead_soldier_def_4."', 
                                        `deff_unit_podkrep_ua_5_res` = '".$dead_soldier_def_5."', 
                                        `deff_unit_podkrep_ua_6_res` = '".$dead_soldier_def_6."', 
                                        `deff_unit_podkrep_ua_7_res` = '".$dead_soldier_def_7."', 
                                        `deff_unit_podkrep_ua_8_res` = '".$dead_soldier_def_8."', 
                                        `deff_unit_podkrep_ua_9_res` = '".$dead_soldier_def_9."', 
                                        `deff_unit_podkrep_ua_10_res` = '".$dead_soldier_def_10."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                             }
                             if ($type_plemy['plemy'] == 3) {
                                 mysql_query("UPDATE `reports` SET 
                                        `deff_unit_podkrep_pl_1` = '".$colony_id_defence['soldier1']."', 
                                        `deff_unit_podkrep_pl_2` = '".$colony_id_defence['soldier2']."', 
                                        `deff_unit_podkrep_pl_3` = '".$colony_id_defence['soldier3']."', 
                                        `deff_unit_podkrep_pl_4` = '".$colony_id_defence['soldier4']."', 
                                        `deff_unit_podkrep_pl_5` = '".$colony_id_defence['soldier5']."', 
                                        `deff_unit_podkrep_pl_6` = '".$colony_id_defence['soldier6']."', 
                                        `deff_unit_podkrep_pl_7` = '".$colony_id_defence['soldier7']."', 
                                        `deff_unit_podkrep_pl_8` = '".$colony_id_defence['soldier8']."', 
                                        `deff_unit_podkrep_pl_9` = '".$colony_id_defence['soldier9']."', 
                                        `deff_unit_podkrep_pl_10` = '".$colony_id_defence['soldier10']."',
                                        `deff_unit_podkrep_pl_1_res` = '".$dead_soldier_def_1."', 
                                        `deff_unit_podkrep_pl_2_res` = '".$dead_soldier_def_2."', 
                                        `deff_unit_podkrep_pl_3_res` = '".$dead_soldier_def_3."', 
                                        `deff_unit_podkrep_pl_4_res` = '".$dead_soldier_def_4."', 
                                        `deff_unit_podkrep_pl_5_res` = '".$dead_soldier_def_5."', 
                                        `deff_unit_podkrep_pl_6_res` = '".$dead_soldier_def_6."', 
                                        `deff_unit_podkrep_pl_7_res` = '".$dead_soldier_def_7."', 
                                        `deff_unit_podkrep_pl_8_res` = '".$dead_soldier_def_8."', 
                                        `deff_unit_podkrep_pl_9_res` = '".$dead_soldier_def_9."', 
                                        `deff_unit_podkrep_pl_10_res` = '".$dead_soldier_def_10."'  
                                        WHERE 
                                        `attack_id` = '".$rand_id_attack."' ");
                             }
 
 
                            $res1 = mysql_query("SELECT * FROM `podkrep` WHERE `colony_id_deff` = '".$army_attaker['colony_id_deff']."' ");                       
                            while($row = mysql_fetch_array($res1)) {
                                for ($i = 1; $i <= 10; $i++) {
                                    $alive_soldier_deff_podkrep = round($deff*$row['soldier'.$i]);
 
                                    if ($i == 1) {
                                        $alive_soldier_deff_podkrep1 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep1 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep1;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 2) {
                                        $alive_soldier_deff_podkrep2 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep2 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep2;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 3) {
                                        $alive_soldier_deff_podkrep3 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep3 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep3;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 4) {
                                        $alive_soldier_deff_podkrep4 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep4 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep4;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 5) {
                                        $alive_soldier_deff_podkrep5 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep5 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep5;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 6) {
                                        $alive_soldier_deff_podkrep6 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep6 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep6;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 7) {
                                        $alive_soldier_deff_podkrep7 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep7 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep7;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 8) {
                                        $alive_soldier_deff_podkrep8 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep8 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep8;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 9) {
                                        $alive_soldier_deff_podkrep9 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep9 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep9;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                    if ($i == 10) {
                                        $alive_soldier_deff_podkrep10 = $row['soldier'.$i] - $alive_soldier_deff_podkrep;
                                        $dead_podkrep10 = $alive_soldier_deff_podkrep;
                                        $kill_army_polk = $kill_army_polk + $dead_podkrep10;
                                        $kill_army_stats_week += $alive_soldier_deff_podkrep;
                                    }
                                }
                                $podkrep_all = mysql_fetch_assoc(mysql_query("SELECT * FROM `reports` WHERE `attack_id` = '".$rand_id_attack."' LIMIT 1"));
 
 
 
                                do {
                                  $rand_id_attack22 = rand(111,9999999);
                                  $result22 = mysql_query("SELECT * FROM `reports` WHERE `attack_id` = '".$rand_id_attack22."' LIMIT 1");
                                  $rand_atk22 = mysql_fetch_assoc($result22);
                                  if ($rand_atk22['attack_id'] == $rand_id_attack22) {
                                    continue; // якщо знайдено збіг, продовжуйте цикл
                                  } else {
                                    break; // якщо збіг не знайдено, припиніть цикл
                                  }
                                } while (true);
 
                                podkrep_out($rand_id_attack22,$type_plemy['login'],$row['colony_id_send'],$row['colony_id_deff'],time(),$row['soldier1'],$row['soldier2'],$row['soldier3'],$row['soldier4'],$row['soldier5'],$row['soldier6'],$row['soldier7'],$row['soldier8'],$row['soldier9'],$row['soldier10'],$dead_podkrep1,$dead_podkrep2,$dead_podkrep3,$dead_podkrep4,$dead_podkrep5,$dead_podkrep6,$dead_podkrep7,$dead_podkrep8,$dead_podkrep9,$dead_podkrep10,$row['login']);
 
                                    mysql_query("UPDATE `podkrep` SET 
                                        `soldier1` = '".$alive_soldier_deff_podkrep1."', 
                                        `soldier2` = '".$alive_soldier_deff_podkrep2."', 
                                        `soldier3` = '".$alive_soldier_deff_podkrep3."', 
                                        `soldier4` = '".$alive_soldier_deff_podkrep4."', 
                                        `soldier5` = '".$alive_soldier_deff_podkrep5."', 
                                        `soldier6` = '".$alive_soldier_deff_podkrep6."', 
                                        `soldier7` = '".$alive_soldier_deff_podkrep7."', 
                                        `soldier8` = '".$alive_soldier_deff_podkrep8."', 
                                        `soldier9` = '".$alive_soldier_deff_podkrep9."', 
                                        `soldier10` = '".$alive_soldier_deff_podkrep10."' 
                                        WHERE 
                                        `id` = '".$row['id']."' ");
 
                                    if ($row['plemy'] == 1) {
                                        $deff_ru_1 = $podkrep_all['deff_unit_podkrep_ru_1'] + $row['soldier1'];
                                        $deff_ru_2 = $podkrep_all['deff_unit_podkrep_ru_2'] + $row['soldier2'];
                                        $deff_ru_3 = $podkrep_all['deff_unit_podkrep_ru_3'] + $row['soldier3'];
                                        $deff_ru_4 = $podkrep_all['deff_unit_podkrep_ru_4'] + $row['soldier4'];
                                        $deff_ru_5 = $podkrep_all['deff_unit_podkrep_ru_5'] + $row['soldier5'];
                                        $deff_ru_6 = $podkrep_all['deff_unit_podkrep_ru_6'] + $row['soldier6'];
                                        $deff_ru_7 = $podkrep_all['deff_unit_podkrep_ru_7'] + $row['soldier7'];
                                        $deff_ru_8 = $podkrep_all['deff_unit_podkrep_ru_8'] + $row['soldier8'];
                                        $deff_ru_9 = $podkrep_all['deff_unit_podkrep_ru_9'] + $row['soldier9'];
                                        $deff_ru_10 = $podkrep_all['deff_unit_podkrep_ru_10'] + $row['soldier10'];
                                        $dead_podkrep1 = $podkrep_all['deff_unit_podkrep_ru_1_res'] + $dead_podkrep1;
                                        $dead_podkrep2 = $podkrep_all['deff_unit_podkrep_ru_2_res'] + $dead_podkrep2;
                                        $dead_podkrep3 = $podkrep_all['deff_unit_podkrep_ru_3_res'] + $dead_podkrep3;
                                        $dead_podkrep4 = $podkrep_all['deff_unit_podkrep_ru_4_res'] + $dead_podkrep4;
                                        $dead_podkrep5 = $podkrep_all['deff_unit_podkrep_ru_5_res'] + $dead_podkrep5;
                                        $dead_podkrep6 = $podkrep_all['deff_unit_podkrep_ru_6_res'] + $dead_podkrep6;
                                        $dead_podkrep7 = $podkrep_all['deff_unit_podkrep_ru_7_res'] + $dead_podkrep7;
                                        $dead_podkrep8 = $podkrep_all['deff_unit_podkrep_ru_8_res'] + $dead_podkrep8;
                                        $dead_podkrep9 = $podkrep_all['deff_unit_podkrep_ru_9_res'] + $dead_podkrep9;
                                        $dead_podkrep10 = $podkrep_all['deff_unit_podkrep_ru_10_res'] + $dead_podkrep10;
                                     mysql_query("UPDATE `reports` SET 
                                            `deff_unit_podkrep_ru_1` = '".$deff_ru_1."', 
                                            `deff_unit_podkrep_ru_2` = '".$deff_ru_2."', 
                                            `deff_unit_podkrep_ru_3` = '".$deff_ru_3."', 
                                            `deff_unit_podkrep_ru_4` = '".$deff_ru_4."', 
                                            `deff_unit_podkrep_ru_5` = '".$deff_ru_5."', 
                                            `deff_unit_podkrep_ru_6` = '".$deff_ru_6."', 
                                            `deff_unit_podkrep_ru_7` = '".$deff_ru_7."', 
                                            `deff_unit_podkrep_ru_8` = '".$deff_ru_8."', 
                                            `deff_unit_podkrep_ru_9` = '".$deff_ru_9."', 
                                            `deff_unit_podkrep_ru_10` = '".$deff_ru_10."',
                                            `deff_unit_podkrep_ru_1_res` = '".$dead_podkrep1."', 
                                            `deff_unit_podkrep_ru_2_res` = '".$dead_podkrep2."', 
                                            `deff_unit_podkrep_ru_3_res` = '".$dead_podkrep3."', 
                                            `deff_unit_podkrep_ru_4_res` = '".$dead_podkrep4."', 
                                            `deff_unit_podkrep_ru_5_res` = '".$dead_podkrep5."', 
                                            `deff_unit_podkrep_ru_6_res` = '".$dead_podkrep6."', 
                                            `deff_unit_podkrep_ru_7_res` = '".$dead_podkrep7."', 
                                            `deff_unit_podkrep_ru_8_res` = '".$dead_podkrep8."', 
                                            `deff_unit_podkrep_ru_9_res` = '".$dead_podkrep9."', 
                                            `deff_unit_podkrep_ru_10_res` = '".$dead_podkrep10."'  
                                            WHERE 
                                            `attack_id` = '".$rand_id_attack."' ");
                                    }
                                    if ($row['plemy'] == 2) {
                                        $deff_ua_1 = $podkrep_all['deff_unit_podkrep_ua_1'] + $row['soldier1'];
                                        $deff_ua_2 = $podkrep_all['deff_unit_podkrep_ua_2'] + $row['soldier2'];
                                        $deff_ua_3 = $podkrep_all['deff_unit_podkrep_ua_3'] + $row['soldier3'];
                                        $deff_ua_4 = $podkrep_all['deff_unit_podkrep_ua_4'] + $row['soldier4'];
                                        $deff_ua_5 = $podkrep_all['deff_unit_podkrep_ua_5'] + $row['soldier5'];
                                        $deff_ua_6 = $podkrep_all['deff_unit_podkrep_ua_6'] + $row['soldier6'];
                                        $deff_ua_7 = $podkrep_all['deff_unit_podkrep_ua_7'] + $row['soldier7'];
                                        $deff_ua_8 = $podkrep_all['deff_unit_podkrep_ua_8'] + $row['soldier8'];
                                        $deff_ua_9 = $podkrep_all['deff_unit_podkrep_ua_9'] + $row['soldier9'];
                                        $deff_ua_10 = $podkrep_all['deff_unit_podkrep_ua_10'] + $row['soldier10'];
                                        $dead_podkrep1 = $podkrep_all['deff_unit_podkrep_ua_1_res'] + $dead_podkrep1;
                                        $dead_podkrep2 = $podkrep_all['deff_unit_podkrep_ua_2_res'] + $dead_podkrep2;
                                        $dead_podkrep3 = $podkrep_all['deff_unit_podkrep_ua_3_res'] + $dead_podkrep3;
                                        $dead_podkrep4 = $podkrep_all['deff_unit_podkrep_ua_4_res'] + $dead_podkrep4;
                                        $dead_podkrep5 = $podkrep_all['deff_unit_podkrep_ua_5_res'] + $dead_podkrep5;
                                        $dead_podkrep6 = $podkrep_all['deff_unit_podkrep_ua_6_res'] + $dead_podkrep6;
                                        $dead_podkrep7 = $podkrep_all['deff_unit_podkrep_ua_7_res'] + $dead_podkrep7;
                                        $dead_podkrep8 = $podkrep_all['deff_unit_podkrep_ua_8_res'] + $dead_podkrep8;
                                        $dead_podkrep9 = $podkrep_all['deff_unit_podkrep_ua_9_res'] + $dead_podkrep9;
                                        $dead_podkrep10 = $podkrep_all['deff_unit_podkrep_ua_10_res'] + $dead_podkrep10;
                                     mysql_query("UPDATE `reports` SET 
                                            `deff_unit_podkrep_ua_1` = '".$deff_ua_1."', 
                                            `deff_unit_podkrep_ua_2` = '".$deff_ua_2."', 
                                            `deff_unit_podkrep_ua_3` = '".$deff_ua_3."', 
                                            `deff_unit_podkrep_ua_4` = '".$deff_ua_4."', 
                                            `deff_unit_podkrep_ua_5` = '".$deff_ua_5."', 
                                            `deff_unit_podkrep_ua_6` = '".$deff_ua_6."', 
                                            `deff_unit_podkrep_ua_7` = '".$deff_ua_7."', 
                                            `deff_unit_podkrep_ua_8` = '".$deff_ua_8."', 
                                            `deff_unit_podkrep_ua_9` = '".$deff_ua_9."', 
                                            `deff_unit_podkrep_ua_10` = '".$deff_ua_10."',
                                            `deff_unit_podkrep_ua_1_res` = '".$dead_podkrep1."', 
                                            `deff_unit_podkrep_ua_2_res` = '".$dead_podkrep2."', 
                                            `deff_unit_podkrep_ua_3_res` = '".$dead_podkrep3."', 
                                            `deff_unit_podkrep_ua_4_res` = '".$dead_podkrep4."', 
                                            `deff_unit_podkrep_ua_5_res` = '".$dead_podkrep5."', 
                                            `deff_unit_podkrep_ua_6_res` = '".$dead_podkrep6."', 
                                            `deff_unit_podkrep_ua_7_res` = '".$dead_podkrep7."', 
                                            `deff_unit_podkrep_ua_8_res` = '".$dead_podkrep8."', 
                                            `deff_unit_podkrep_ua_9_res` = '".$dead_podkrep9."', 
                                            `deff_unit_podkrep_ua_10_res` = '".$dead_podkrep10."'  
                                            WHERE 
                                            `attack_id` = '".$rand_id_attack."' ");
                                    }
                                    if ($row['plemy'] == 3) {
                                        $deff_pl_1 = $podkrep_all['deff_unit_podkrep_pl_1'] + $row['soldier1'];
                                        $deff_pl_2 = $podkrep_all['deff_unit_podkrep_pl_2'] + $row['soldier2'];
                                        $deff_pl_3 = $podkrep_all['deff_unit_podkrep_pl_3'] + $row['soldier3'];
                                        $deff_pl_4 = $podkrep_all['deff_unit_podkrep_pl_4'] + $row['soldier4'];
                                        $deff_pl_5 = $podkrep_all['deff_unit_podkrep_pl_5'] + $row['soldier5'];
                                        $deff_pl_6 = $podkrep_all['deff_unit_podkrep_pl_6'] + $row['soldier6'];
                                        $deff_pl_7 = $podkrep_all['deff_unit_podkrep_pl_7'] + $row['soldier7'];
                                        $deff_pl_8 = $podkrep_all['deff_unit_podkrep_pl_8'] + $row['soldier8'];
                                        $deff_pl_9 = $podkrep_all['deff_unit_podkrep_pl_9'] + $row['soldier9'];
                                        $deff_pl_10 = $podkrep_all['deff_unit_podkrep_pl_10'] + $row['soldier10'];
                                        $dead_podkrep1 = $podkrep_all['deff_unit_podkrep_pl_1_res'] + $dead_podkrep1;
                                        $dead_podkrep2 = $podkrep_all['deff_unit_podkrep_pl_2_res'] + $dead_podkrep2;
                                        $dead_podkrep3 = $podkrep_all['deff_unit_podkrep_pl_3_res'] + $dead_podkrep3;
                                        $dead_podkrep4 = $podkrep_all['deff_unit_podkrep_pl_4_res'] + $dead_podkrep4;
                                        $dead_podkrep5 = $podkrep_all['deff_unit_podkrep_pl_5_res'] + $dead_podkrep5;
                                        $dead_podkrep6 = $podkrep_all['deff_unit_podkrep_pl_6_res'] + $dead_podkrep6;
                                        $dead_podkrep7 = $podkrep_all['deff_unit_podkrep_pl_7_res'] + $dead_podkrep7;
                                        $dead_podkrep8 = $podkrep_all['deff_unit_podkrep_pl_8_res'] + $dead_podkrep8;
                                        $dead_podkrep9 = $podkrep_all['deff_unit_podkrep_pl_9_res'] + $dead_podkrep9;
                                        $dead_podkrep10 = $podkrep_all['deff_unit_podkrep_pl_10_res'] + $dead_podkrep10;
                                     mysql_query("UPDATE `reports` SET 
                                            `deff_unit_podkrep_pl_1` = '".$deff_pl_1."', 
                                            `deff_unit_podkrep_pl_2` = '".$deff_pl_2."', 
                                            `deff_unit_podkrep_pl_3` = '".$deff_pl_3."', 
                                            `deff_unit_podkrep_pl_4` = '".$deff_pl_4."', 
                                            `deff_unit_podkrep_pl_5` = '".$deff_pl_5."', 
                                            `deff_unit_podkrep_pl_6` = '".$deff_pl_6."', 
                                            `deff_unit_podkrep_pl_7` = '".$deff_pl_7."', 
                                            `deff_unit_podkrep_pl_8` = '".$deff_pl_8."', 
                                            `deff_unit_podkrep_pl_9` = '".$deff_pl_9."', 
                                            `deff_unit_podkrep_pl_10` = '".$deff_pl_10."',
                                            `deff_unit_podkrep_pl_1_res` = '".$dead_podkrep1."', 
                                            `deff_unit_podkrep_pl_2_res` = '".$dead_podkrep2."', 
                                            `deff_unit_podkrep_pl_3_res` = '".$dead_podkrep3."', 
                                            `deff_unit_podkrep_pl_4_res` = '".$dead_podkrep4."', 
                                            `deff_unit_podkrep_pl_5_res` = '".$dead_podkrep5."', 
                                            `deff_unit_podkrep_pl_6_res` = '".$dead_podkrep6."', 
                                            `deff_unit_podkrep_pl_7_res` = '".$dead_podkrep7."', 
                                            `deff_unit_podkrep_pl_8_res` = '".$dead_podkrep8."', 
                                            `deff_unit_podkrep_pl_9_res` = '".$dead_podkrep9."', 
                                            `deff_unit_podkrep_pl_10_res` = '".$dead_podkrep10."'  
                                            WHERE 
                                            `attack_id` = '".$rand_id_attack."' ");
                                    }
 
 
 
                                if ($alive_soldier_deff_podkrep1 > 0 || $alive_soldier_deff_podkrep2 > 0 || $alive_soldier_deff_podkrep3 > 0 || $alive_soldier_deff_podkrep4 > 0 || $alive_soldier_deff_podkrep5 > 0 || $alive_soldier_deff_podkrep6 > 0 || $alive_soldier_deff_podkrep7 > 0 || $alive_soldier_deff_podkrep8 > 0 || $alive_soldier_deff_podkrep9 > 0 || $alive_soldier_deff_podkrep10 > 0) {
                                }else{
                                    mysql_query("DELETE FROM `podkrep` WHERE `id` = '".$row['id']."' ");
                                }
                            }
 
 
                            if ($army_attaker['soldier1'] >= 11 or $army_attaker['soldier2'] >= 11 or $army_attaker['soldier3'] >= 11 or $army_attaker['soldier4'] >= 11 or $army_attaker['soldier5'] >= 11 or $army_attaker['soldier6'] >= 11 or $army_attaker['soldier7'] >= 11 or $army_attaker['soldier8'] >= 11 or $army_attaker['soldier9'] >= 11 or $army_attaker['soldier10'] >= 11) {
 
                                $us_polkovodec =  mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$army_attaker['login']."' LIMIT 1"));
                                $war_loss = $us_polkovodec['war_loss'] + 1;
                                $war_all = $us_polkovodec['war_all'] + 1;
                                $Kills_army = $us_polkovodec['Kills_army'] + $kill_army_stats_week;
                                $Loss_army = $us_polkovodec['Loss_army'] + $dead_army_attaker;
                                mysql_query("UPDATE `users` SET 
                                            `war_all` = '".$war_all."',
                                            `war_loss` = '".$war_loss."',
                                            `Kills_army` = '".$Kills_army."',
                                            `Loss_army` = '".$Loss_army."'
                                            WHERE 
                                            `login` = '".$army_attaker['login']."' ");
 
 
 
                                $us_polkovodec_deff =  mysql_fetch_assoc(mysql_query("SELECT * FROM `users` WHERE `login` = '".$colony_id_defence['login']."' LIMIT 1"));
                                $war_all_deff = $us_polkovodec_deff['war_all'] + 1;
                                $war_winner_deff = $us_polkovodec_deff['war_winner'] + 1;
                                $Kills_army_deff = $us_polkovodec_deff['Kills_army'] + $dead_army_attaker;
                                $Loss_army_deff = $us_polkovodec_deff['Loss_army'] + $kill_army_stats_week;
                                mysql_query("UPDATE `users` SET `war_all` = '".$war_all_deff."', `war_winner` = '".$war_winner_deff."', `Kills_army` = '".$Kills_army_deff."', `Loss_army` = '".$Loss_army_deff."' WHERE `login` = '".$us_polkovodec_deff['login']."' ");
                            }
 
                            if ($dead_army_attaker > 0 and $army_attaker['login'] != $colony_id_defence['login']) {
                                dead_army_attaker($colony_id_defence['login'], $dead_army_attaker);
                            }
 
 
                            if ($kill_army_stats_week > 0 and $army_attaker['login'] != $colony_id_defence['login']) {
                                dead_army_deffer($army_attaker['login'], $kill_army_stats_week);
                            }
 
 
                            if ($robberies_stats_week > 0 and $army_attaker['login'] != $colony_id_defence['login']) {
                                robberies_attaker($army_attaker['login'],$colony_id_defence['login'], $robberies_stats_week);
                            }
                        }
                    }
                }else{
 
                    $time_m = time() + ($army_attaker['last_time'] - $army_attaker['start_time']);
                    $plemy_defender = mysql_fetch_assoc(mysql_query("SELECT * FROM `map` WHERE `colony_id` = '".$army_attaker['colony_id_deff']."' LIMIT 1"));
                    mysql_query("INSERT INTO `send_army`(`login`, `type_attack`, `last_time`, `x`,`y`, `colony_id`, `colony_id_deff`, `soldier1`, `soldier2`, `soldier3`, `soldier4`, `soldier5`, `soldier6`, `soldier7`, `soldier8`, `soldier9`, `soldier10`,`derevo`,`glina`,`jelezo`,`zerno`) VALUES ('".$army_attaker['login']."', '4', '".$time_m."', '".$army_attaker['x']."', '".$army_attaker['y']."', '".$army_attaker['colony_id']."', '".$army_attaker['colony_id_deff']."', '".$army_attaker['soldier1']."', '".$army_attaker['soldier2']."', '".$army_attaker['soldier3']."', '".$army_attaker['soldier4']."', '".$army_attaker['soldier5']."', '".$army_attaker['soldier6']."', '".$army_attaker['soldier7']."', '".$army_attaker['soldier8']."', '".$army_attaker['soldier9']."', '".$army_attaker['soldier10']."','0','0','0','0') ");
                    mysql_query("DELETE FROM `send_army` WHERE `id` = '".$row['id']."' ");
                }
            }
        }
    }
}
